import { e as e$1, p as p$1, K as l$4, N as l$7 } from './JSONSupport-9346590f.js';
import { k as l$2, r as r$4, t as t$4, f as e$5, q as c$6 } from './Message-70b34921.js';
import { y as y$5, n as n$3 } from './subclass-fe5fcf78.js';
import { y as y$4, e, m as g, t as t$1, v as v$3, n as g$4, f as f$1, l as l$8, _ as _$3, j as e$a } from './viewUtils-2452231e.js';
import { s as f, t as o$4, a5 as n$7, m as p$2 } from './SceneView-f849f26b.js';
import { u as u$4 } from './Handles-af859b7b.js';
import { E as En, n as nn, Z as Zn, R as Rn, y as yn, P as Pn, w as wn } from './projection-c73dd3c4.js';
import { e as O$1, p, a as G$2, b as R$1, I, J, v as v$4, N, E as E$1 } from './unitUtils-b17203be.js';
import { n, z as z$2, a as o$1, u as u$3, d, D as x$2, h as r, j as j$3, _ as _$1, q as q$2, E as v$2, c as c$2, g as b$3, i as t$3, M as e$3, y as y$7, a8 as h$6 } from './mathUtils-a477cc74.js';
import { r as r$2 } from './earcut-d81146f9.js';
import { r as r$1, d as d$1, a as a$1, y as y$6, o as o$2, l as l$3, _ as _$2, m as m$1, L } from './vec2-513a0296.js';
import { n as n$2, t as t$2, e as e$2 } from './vec2f64-3fb878b3.js';
import { n as n$1, a as r$3, e as e$4 } from './DefaultMaterial_COLOR_GAMMA-7c4a23ef.js';
import { k as k$3, S as S$1 } from './SpatialReference-843b1520.js';
import { j as j$2, z as z$3, m as m$2 } from './Polyline-ccd8fb47.js';
import { geodesicArea as q$1 } from './geometryEngine-b7f060c5.js';
import { am as _, an as b$2, ao as g$1 } from './DefaultUI-99d89841.js';
import { n as n$4 } from './Loadable-d16b3d7d.js';
import { d as d$2, j as j$5 } from './watchUtils-06a91cc9.js';
import { a as a$2, j as j$4 } from './vec4-8546ad05.js';
import { b as b$4 } from './Point-ee7951c3.js';
import { a as u$6 } from './intl-21ab9759.js';
import { y as y$8, r as r$8, c as c$5 } from './mat4-8eb66d33.js';
import { e as e$9 } from './vec33-d394808f.js';
import { c as c$4, m as m$3 } from './LineVisualElement-5e33774f.js';
import { n as n$5, t as t$5, L as a$3, ap as r$5, j as e$6, a as r$6, b as e$8, c as t$6, d as n$6, o as o$3, h as t$7, Y as t$8, a2 as a$4, a5 as c$3, as as a$5, at as l$6, f as t$9, a6 as a$6, b9 as h$5, aj as t$a, ab as d$3, u as u$5 } from './objectResourceUtils-59d1d140.js';
import { e as e$7, g as g$2, l as l$5, r as r$7 } from './FramebufferObject-238df962.js';
import { g as g$3 } from './locale-b874fc68.js';
import { d as d$4 } from './LayerView-0b9de845.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function y$3(o,s){const i=s.center;o$1(i,0,0,0);for(let t=0;t<o.length;++t)u$3(i,i,o[t]);d(i,i,1/o.length);let f=0;for(let t=0;t<o.length;++t)f=Math.max(f,x$2(i,o[t]));s.radius=Math.sqrt(f);}function M$2(t,e){if(t.length<3)throw new Error("need at least 3 points to fit a plane");_(t[0],t[1],t[2],e);}function b$1(t,e){return z$2(t,e)+t[3]}function z$1(t,e,n){const r={distance:null};return y$4(r,[t[0],t[1]],[e[0],e[1]],n),r.distance}function k$2(t,e,n){const r=e[0]-t[0],o=e[1]-t[1],s=n[0]-t[0],i=n[1]-t[1];return .5*Math.abs(r*i-o*s)}function q(t,e,n,r){const o=G$1;return En(t,r,R)&&En(e,r,S)&&En(n,r,U$1)?(o.setPoint(0,0,R),o.setPoint(0,1,S),o.setPoint(0,2,U$1),Math.abs(q$1(o,"square-meters"))):0}function x$1(n,r$1=null,s=!0){const a=1e-6,c=(t,e)=>{if(0===e[0]&&0===e[1]&&0===e[2])return !1;for(let n=0;n<t.length;++n)if(z$2(e,t[n])<-a)return !1;return !0};if(0===n.length)return !1;if(1===n.length)return r$1&&r(r$1,n[0]),!0;o$1(W,0,0,0);for(let t=0;t<n.length;++t)u$3(W,W,n[t]);if(j$3(W,W),c(n,W))return r$1&&r(r$1,W),!0;if(!s)return !1;for(let t=0;t<n.length;++t)for(let e=0;e<n.length;++e)if(t!==e&&(_$1(W,n[t],n[e]),j$3(W,W),c(n,W)))return r$1&&r(r$1,W),!0;return !1}const R=n(),S=n(),U$1=n(),G$1=new j$2({rings:[[R,S,U$1]],spatialReference:k$3.WGS84}),W=n();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class k$1{constructor(e,t){this.positionsWorldCoords=[],this.positionsRenderCoords=[],this.positionsProjectedWorldCoords=[],this.positionsFittedRenderCoords=[],this.positionsGeographic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.areaCentroidWorldCoords=n(),this.areaCentroidRenderCoords=n(),this.geodesicAreaCentroidRenderCoords=n(),this._length=0,this._centroidRenderCoords=n(),this._planeWorldCoords=n$1(),this._worldUp=n(),this._worldTangent=n(),this._frame=[n(),n(),n()],this._pathVersion=-1,this._validMeasurement=!1,this._tempU=n(),this._tempV=n(),this._tempVec3=n(),this._tempSphere={center:n(),radius:0},this._sceneView=e,this.unitNormalizer=t;}update(e$1,s,i,o){const r=this.unitNormalizer,h=this._sceneView.renderSpatialReference,a=this.unitNormalizer.spatialReference;if(this._pathVersion===e$1.version&&this._validMeasurement===i)return;this._pathVersion=e$1.version,this._validMeasurement=i;const d=e$1.numVertices;this._resize(d);const g=O$1(s.spatialReference),l=nn(s.spatialReference,g)&&Zn(s.spatialReference),p=this.positionsGeographic,c=this.positionsWorldCoords,m=this.positionsRenderCoords,_=this.positionsSpherical;e$1.forEachVertexPosition(((e,t)=>{Rn(e,c[t],a),Rn(e,m[t],h),l&&(yn(e,p[t]),Rn(e,_[t],g),j$3(_[t],_[t]));}));const u=this._updatePathLengths(i);if(this.pathLength=this._length>1?new e(r.normalizeDistance(u),"meters"):null,l){const e$1=this._updateGeodesicPathLengths(i,a);this.geodesicPathLength=this._length>1?new e(e$1,"meters"):null;}else this.geodesicPathLength=null;if(!i)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),void this.geodesicIntersectingSegments.clear();this._updateArea(s,r,h,a,o),l&&this._updateGeodesicArea(s);}getData(){return {positionsWorldCoords:this.positionsWorldCoords,positionsRenderCoords:this.positionsRenderCoords,positionsProjectedWorldCoords:this.positionsProjectedWorldCoords,positionsFittedRenderCoords:this.positionsFittedRenderCoords,positionsGeographic:this.positionsGeographic,positionsSpherical:this.positionsSpherical,positionsStereographic:this.positionsStereographic,pathSegmentLengths:this.pathSegmentLengths,geodesicPathSegmentLengths:this.geodesicPathSegmentLengths,perimeterSegmentLengths:this.perimeterSegmentLengths,intersectingSegments:this.intersectingSegments,geodesicIntersectingSegments:this.geodesicIntersectingSegments,triangleIndices:this.triangleIndices,geodesicTriangleIndices:this.geodesicTriangleIndices,areaCentroidWorldCoords:this.areaCentroidWorldCoords,areaCentroidRenderCoords:this.areaCentroidRenderCoords,geodesicAreaCentroidRenderCoords:this.geodesicAreaCentroidRenderCoords,fittingMode:this.fittingMode,area:this.area,geodesicArea:this.geodesicArea,pathLength:this.pathLength,geodesicPathLength:this.geodesicPathLength,perimeterLength:this.perimeterLength,unitNormalizer:this.unitNormalizer}}_resize(e){for(e<this._length&&(this.positionsWorldCoords.length=e,this.positionsRenderCoords.length=e,this.positionsProjectedWorldCoords.length=e,this.positionsFittedRenderCoords.length=e,this.positionsGeographic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorldCoords.push(n()),this.positionsRenderCoords.push(n()),this.positionsProjectedWorldCoords.push(n$2()),this.positionsFittedRenderCoords.push(n()),this.positionsGeographic.push(n()),this.positionsSpherical.push(n()),this.positionsStereographic.push(n$2()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length;}_updatePathLengths(e){const t=this.positionsWorldCoords,s=this.pathSegmentLengths;let i=0;for(let o=0;o<this._length;++o){const r=s[o]=q$2(t[o],t[(o+1)%this._length]);(o<this._length-1||e)&&(i+=r);}return i}_updateGeodesicPathLengths(e,t){const s=this.positionsGeographic,i=this.geodesicPathSegmentLengths;let o=0;for(let r=0;r<this._length;++r){const n=i[r]=z$1(s[r],s[(r+1)%this._length],t);(r<this._length-1||e)&&(o+=n);}return o}_updateArea(e$1,s,o,r$2,n){const h=e$1.renderCoordsHelper,_=this.positionsWorldCoords,u=this.positionsRenderCoords,f=this.positionsProjectedWorldCoords,C=this.positionsFittedRenderCoords,S=this._planeWorldCoords,L=this._centroidRenderCoords;g(u,L),h.worldUpAtPosition(L,this._worldUp),h.worldBasisAtPosition(L,0,this._worldTangent),Pn(L,this._worldUp,o,this._worldUp,r$2),Pn(L,this._worldTangent,o,this._worldTangent,r$2),_.length>2&&M$2(_,S),this.fittingMode=this._selectFittingMode(S,_,this._worldUp,n);let P=0;if("horizontal"===this.fittingMode){let e=-1/0;u.forEach(((t,s)=>{const i=h.getAltitude(u[s]);i>e&&(e=i,P=s);}));}const j=_[P];let A=S,W=this._worldTangent;"horizontal"===this.fittingMode?A=this._worldUp:"vertical"===this.fittingMode&&(A=this._tempVec3,W=this._worldUp,b$2(S,this._worldUp,A)),r(this._frame[2],A),b$2(W,A,this._frame[0]),_$1(this._frame[1],this._frame[0],this._frame[2]),v$2(this._frame[1],this._frame[1]);const v=this._tempVec3,U=this._tempU,G=this._tempV;for(let t=0;t<this._length;++t){const e=f[t],s=C[t];c$2(v,_[t],j),r$1(e,z$2(this._frame[0],v),z$2(this._frame[1],v)),d(U,this._frame[0],e[0]),d(G,this._frame[1],e[1]),u$3(v,U,G),u$3(v,v,j),wn(v,r$2,s,o);}this.perimeterLength=this._length>0?new e(s.normalizeDistance(this._updatePerimeterLengths()),"meters"):null,g(C,this.areaCentroidRenderCoords),wn(this.areaCentroidRenderCoords,o,this.areaCentroidWorldCoords,r$2),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?new e(s.normalizeArea(this._computeArea()),"square-meters"):null;}_updateGeodesicArea(e$1){const s=e$1.renderCoordsHelper,o=this.positionsSpherical,r=this.positionsStereographic,n=this._tempVec3,h=x$1(o,n);if(!h)return void(this.geodesicArea=null);const a=this._tempU,d$1=this._tempV;g$1(n,a,d$1);for(let t=0;t<this._length;++t){const e=z$2(o[t],a),s=z$2(o[t],d$1),h=z$2(o[t],n);r$1(r[t],e/h,s/h);}d(n,n,p(e$1.spatialReference).radius),s.toRenderCoords(n,O$1(e$1.spatialReference),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=h&&0===this.geodesicIntersectingSegments.size?new e(this._computeGeodesicArea(),"square-meters"):null;}_updatePerimeterLengths(){const e=this.positionsProjectedWorldCoords,t=this.perimeterSegmentLengths;let s=0;for(let i=0;i<this._length;++i){s+=t[i]=d$1(e[i],e[(i+1)%this._length]);}return s}_updateIntersectingSegments(){const e=this.positionsProjectedWorldCoords,t=this.intersectingSegments;t.clear();for(let s=0;s<this._length;++s)for(let i=s+2;i<this._length;++i){if((i+1)%this._length===s)continue;const o=e[s],r=e[(s+1)%this._length],n=e[i],h=e[(i+1)%this._length];z$3(o,r,n,h)&&(t.add(s),t.add(i));}}_computeArea(){const e=this.positionsProjectedWorldCoords,t=x(e,2),i=this.triangleIndices=new Uint32Array(r$2(t,[],2));let o=0;for(let s=0;s<i.length;s+=3)o+=k$2(e[i[s]],e[i[s+1]],e[i[s+2]]);return o}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let s=0;s<this._length;++s)for(let i=s+2;i<this._length;++i){if((i+1)%this._length===s)continue;const o=e[s],r=e[(s+1)%this._length],n=e[i],h=e[(i+1)%this._length];z$3(o,r,n,h)&&(t.add(s),t.add(i));}}_computeGeodesicArea(){const e=this.positionsGeographic,t=x(this.positionsStereographic,2),i=this.geodesicTriangleIndices=new Uint32Array(r$2(t,[],2));let o=0;for(let s=0;s<i.length;s+=3)o+=q(e[i[s]],e[i[s+1]],e[i[s+2]],k$3.WGS84);return o}_selectFittingMode(t,s,i,o){const r=s.map((e=>Math.abs(b$1(t,e)))).reduce(((e,t)=>Math.max(e,t)),0);y$3(s,this._tempSphere);const n=r/(2*this._tempSphere.radius),h=n<o.maxRelativeErrorCoplanar,a=n<o.maxRelativeErrorAlmostCoplanar;let d="horizontal";if(h)d="oblique";else if(a){d=Math.abs(z$2(i,t))>Math.cos(b$3(o.verticalAngleThreshold))?"horizontal":"vertical";}return d}}function x(e,t){const s=new Float64Array(e.length*t);for(let i=0;i<e.length;++i){const o=e[i];for(let e=0;e<t;++e)s[i*t+e]=o[e];}return s}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
let h$4=class extends p$1{constructor(e){super(e),this._handles=new u$4;}initialize(){const e=this.view.spatialReference,t=O$1(e),r=t===G$2?R$1:t,s=!e||nn(e,r)?r:e,a=new t$1(s);this._measurementDataManager=new k$1(this.view,a),this._handles.add(this.layerViewData.path.on("change",(()=>this._update()))),this._update();}destroy(){this._handles=l$2(this._handles);}_update(){const e=this.layerViewData,t={maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80};this._measurementDataManager.update(e.path,this.view,e.validMeasurement,t);const r=this._measurementDataManager.getData();this._set("measurementData",r),e.measurementData=r;}};e$1([y$5({constructOnly:!0})],h$4.prototype,"view",void 0),e$1([y$5({constructOnly:!0})],h$4.prototype,"analysis",void 0),e$1([y$5({readOnly:!0})],h$4.prototype,"measurementData",void 0),e$1([y$5({constructOnly:!0})],h$4.prototype,"layerViewData",void 0),h$4=e$1([n$3("esri.views.3d.layers.analysis.AreaMeasurement.AreaMeasurementController")],h$4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const w=n$2();class M$1{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this._unnormalizationInfo=B(e,t);}tag(e){return e}createNew(){return this.tag(n$2())}fromPoint(e){return this.tag(t$2(e.x,e.y))}fromArray(e){return this.tag(t$2(e[0],e[1]))}toArray(e){return [e[0],e[1]]}clone(e){return this.tag(e$2(e))}copy(t,r){return a$1(r,t)}toPoint(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}createPoint(e){return new b$4({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new b$4({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){return {x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}lerp(e,r,a,n){return y$6(n,e,r,a)}addDelta(e,t,r){e[0]+=t,e[1]+=r;}scale(e,t,i,o){const u=o$2(w,e,t),h=l$3(w,i,_$2(i,u));m$1(e,e,h,o-1);}rotate(e,t,r){L(e,e,t,r);}pointToArray(e){return [e.x,e.y]}getZ(e,t){return t}hasZ(){return !1}getM(e,t){return t}hasM(){return !1}unnormalize(e){j$1(e,this._unnormalizationInfo);}fromXYZ(e){return this.tag(t$2(e[0],e[1]))}toXYZ(e,t=0){return t$3(e[0],e[1],t)}distance(e,t){return d$1(e,t)}}class P$1{constructor(e,t,r){this.valueType=e,this.spatialReference=t,this._unnormalizationInfo=B(t,r);}distance(e,t){return 0===this.valueType?q$2(e,t):d$1(e,t)}tag(e){return e}createNew(){return this.tag(n())}fromPoint(e){return this.tag(t$3(e.x,e.y,0===this.valueType?e.z:e.m))}fromArray(e){return this.tag(t$3(e[0],e[1],e[2]||0))}toArray(e){return [e[0],e[1],e[2]]}clone(e){return this.tag(e$3(e))}copy(e,t){return r(t,e)}toPoint(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}createPoint(e){return new b$4({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new b$4({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){const t=0===this.valueType,r=1===this.valueType;return {x:e[0],y:e[1],z:t?e[2]:void 0,m:r?e[2]:void 0,hasZ:t,hasM:r,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,r,a){return y$7(a,e,t,r)}addDelta(e,t,r,a){e[0]+=t,e[1]+=r,0===this.valueType&&(e[2]+=a);}scale(e,t,i,o){const u=o$2(w,e,t),h=l$3(w,i,_$2(i,u));m$1(e,e,h,o-1);}rotate(e,t,r){L(e,e,t,r);}pointToArray(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}getZ(e,t){return 0===this.valueType?e[2]:t}hasZ(){return 0===this.valueType}getM(e,t){return 1===this.valueType?e[2]:t}hasM(){return 1===this.valueType}unnormalize(e){j$1(e,this._unnormalizationInfo);}fromXYZ(e,t=0,r=0){return this.tag(t$3(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:r))}toXYZ(e,t=0){return this.tag(t$3(e[0],e[1],0===this.valueType?e[2]:t))}}class X{constructor(e,t){this.spatialReference=e,this._unnormalizationInfo=B(e,t);}distance(e,t){return q$2(e,t)}tag(e){return e}createNew(){return this.tag(n$1())}fromPoint(e){return this.tag(r$3(e.x,e.y,e.z,e.m))}fromArray(e){return this.tag(r$3(e[0],e[1],e[2]||0,e[3]||0))}toArray(e){return [e[0],e[1],e[2],e[3]]}clone(e){return this.tag(e$4(e))}copy(e,t){return a$2(t,e)}toPoint(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}createPoint(e){return new b$4({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createPointFromArray(e){return new b$4({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createDehydratedPoint(e){return {x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,r,a){return j$4(a,e,t,r)}addDelta(e,t,r,a){e[0]+=t,e[1]+=r,e[2]+=a;}scale(e,t,i,o){const u=o$2(w,e,t),h=l$3(w,i,_$2(i,u));m$1(e,e,h,o-1);}rotate(e,t,r){L(e,e,t,r);}pointToArray(e){return [e.x,e.y,e.z,e.m]}getZ(e){return e[2]}hasZ(){return !0}getM(e){return e[3]}hasM(){return !0}unnormalize(e){j$1(e,this._unnormalizationInfo);}fromXYZ(e,t=0,r=0){return this.tag(r$3(e[0],e[1],e.length>2?e[2]:t,r))}toXYZ(e){return t$3(e[0],e[1],e[2])}}function A(e,t,r,a){return e&&t?new X(r,a):t?new P$1(1,r,a):e?new P$1(0,r,a):new M$1(r,a)}function j$1(e,t){if(!t.supported)return;let r=1/0,a=-1/0;const n=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let s=e.pos[0];for(;s<t.lowerBoundX;)s+=n;for(;s>t.upperBoundX;)s-=n;r=Math.min(r,s),a=Math.max(a,s),e.pos[0]=s;}));const s=a-r;n-s<s&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=n);}));}function B(e,t){const r=S$1(e);return "global"===t&&r?{supported:!0,lowerBoundX:r.valid[0],upperBoundX:r.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class h$3{constructor(t){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=t;}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions();}}class c$1{constructor(t,e,s){this.type="edge",this.component=t,this.left=e,this.right=s,e.right=this,s.left=this;}}class l$1{constructor(t){this.vertices=[],this.edges=[],this.data=t;}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices);}updateVertexIndex(t,e){if(0===this.vertices.length)return;const s=this.vertices[0];let r=null,i=t,n=e;do{r=i,r.index=n++,i=r.right?r.right.right:null;}while(null!=i&&i!==s);r.left&&r!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(r),this.vertices.length-1);}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].left}swapVertices(t,e){const s=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=s;}iterateVertices(t){if(0===this.vertices.length)return;const e=this.vertices[0];let r=e;do{t(r,r.index),r=r$4(r.right)?r.right.right:null;}while(r!==e&&null!=r)}}class a extends n$4{constructor(t){super(),this.coordinateHelper=t,this.undoStack=[],this.redoStack=[],this.components=[];}apply(t,e=1){return 0!==e&&!t$4(this.lastOperation)&&this.lastOperation.accumulate(t)||(t.apply(),this.undoStack.push(t),this.redoStack=[]),t}undo(){if(this.undoStack.length>0){const t=this.undoStack.pop();return t.undo(),this.redoStack.push(t),t}return null}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();return t.apply(),this.undoStack.push(t),t}return null}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((s,r)=>{const i=[];let n=s.vertices.find((t=>null==t.left));const o=n;do{i.push(e(n.pos)),n=n.right?n.right.right:null;}while(n&&n!==o);t.push(i);})),new m$2({paths:t,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}toPolygon(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((r,i)=>{const n=[],o=r.vertices[0];let h=o;const c=h;do{n.push(e(h.pos)),h=r$4(h.right)?h.right.right:null;}while(h&&h!==c);r.isClosed()&&n.push(e(o.pos)),t.push(n);})),new j$2({rings:t,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,s){const r=A(e.hasZ,e.hasM,e.spatialReference,s),i=new a(r);switch(e.type){case"polygon":{const s=e.rings;for(let e=0;e<s.length;++e){const n=s[e],o=new l$1(i),a=n.length>2&&l$4(n[0],n[n.length-1]),p=a?n.length-1:n.length;for(let t=0;t<p;++t){const e=r.fromArray(n[t]),s=new h$3(o);o.vertices.push(s),s.pos=e,s.index=t;}const u=o.vertices.length-1;for(let t=0;t<u;++t){const e=o.vertices[t],s=o.vertices[t+1],r=new c$1(o,e,s);o.edges.push(r);}if(a){const t=new c$1(o,o.vertices[o.vertices.length-1],o.vertices[0]);o.edges.push(t);}i.components.push(o);}}break;case"polyline":for(const t of e.paths){const e=new l$1(i),s=t.length;for(let i=0;i<s;++i){const s=r.fromArray(t[i]),n=new h$3(e);e.vertices.push(n),n.pos=s,n.index=i;}const n=e.vertices.length-1;for(let t=0;t<n;++t){const s=e.vertices[t],r=e.vertices[t+1],i=new c$1(e,s,r);e.edges.push(i);}i.components.push(e);}break;case"point":{const t=new l$1(i),s=new h$3(t);s.index=0,s.pos=i.coordinateHelper.fromPoint(e),t.vertices.push(s),i.components.push(t);}}return i}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class h$2{constructor(e,t,i){this.editGeometry=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null;}apply(){let h="redo";t$4(this.addedVertex)&&(h="apply",this.addedVertex=new h$3(this.component));const d=this.component.getLastVertex();if(t$4(d))this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else {let i=null;d.right&&(this.originalEdge=d.right,i=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,t$4(this.left)&&(this.left=new c$1(this.component,d,this.addedVertex)),this.component.edges.push(this.left),d.right=this.left,r$4(this.originalEdge)&&r$4(i)&&(t$4(this.right)&&(this.right=new c$1(this.component,this.addedVertex,i)),this.component.edges.push(this.right),i.left=this.right),this.component.updateVertexIndex(this.addedVertex,d.index+1);}const n={addedVertices:[this.addedVertex],operation:h};this.editGeometry.emit("change",n);}undo(){if(t$4(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),r$4(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),r$4(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),r$4(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),r$4(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const i={removedVertices:[this.addedVertex],operation:"undo"};this.editGeometry.emit("change",i);}accumulate(){return !1}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class i$2{constructor(t,e,i){this.editGeometry=t,this.vertex=e,this.pos=i;}apply(){const e=t$4(this.originalPosition);e&&(this.originalPosition=this.vertex.pos),this._apply(e?"apply":"redo");}undo(){this.vertex.pos=e$5(this.originalPosition);const t={updatedVertices:[this.vertex],operation:"undo"};this.editGeometry.emit("change",t);}accumulate(t){return t instanceof i$2&&t.vertex===this.vertex&&(this.pos=t.pos,this._apply("apply"),!0)}_apply(t){this.vertex.pos=this.pos,this.editGeometry.components.forEach((t=>t.unnormalizeVertexPositions()));const e={updatedVertices:[this.vertex],operation:t};this.editGeometry.emit("change",e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class i$1{constructor(e,t){this.editGeometry=e,this.component=t,this.createdEdge=null;}apply(){let i="redo";if(t$4(this.createdEdge)){i="apply";const s=this.component.getFirstVertex(),o=this.component.getLastVertex();if(this.component.isClosed()||this.component.vertices.length<3||t$4(s)||t$4(o))return;this.createdEdge=new c$1(this.component,o,s);}this.createdEdge.left.right=this.createdEdge,this.createdEdge.right.left=this.createdEdge,this.component.edges.push(this.createdEdge);const s={operation:i};this.editGeometry.emit("change",s);}undo(){if(t$4(this.createdEdge))return;this.component.edges.splice(this.component.edges.indexOf(this.createdEdge),1),this.createdEdge.left.right=null,this.createdEdge.right.left=null;const t={operation:"undo"};this.editGeometry.emit("change",t);}accumulate(){return !1}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
let y$2=class extends n$4.EventedAccessor{constructor(e={}){super(e),this._handles=new u$4,this._version=0,this._internalGeometryChange=!1;}set areaMeasurement(e){this._set("areaMeasurement",e),r$4(e)&&r$4(this.view)&&this._initialize(e,this.view);}set view(e){this._set("view",e),r$4(e)&&r$4(this.areaMeasurement)&&this._initialize(this.areaMeasurement,e);}get initialized(){return r$4(this.areaMeasurement)&&r$4(this.view)}get version(){return this._version}get isValidPolygon(){return this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].isClosed()}_initialize(e,t){this._handles.removeAll(),this._handles.add(d$2(e,"geometry",(()=>this._updateEditGeometryFromModelGeometry(e,t)),!0)),this._makeDirty(!0);}_makeDirty(e=!1){this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),e&&this.notifyChange("numVertices");}_updateEditGeometryFromModelGeometry(e,t){this._version++,this._internalGeometryChange||(this._handles.remove("EditGeometry"),this._editGeometry=r$4(e.geometry)?a.fromGeometry(e.geometry,t.viewingMode):new a(A(!0,!1,t.spatialReference,t.viewingMode)),this._makeDirty(!0),this.emit("change",{type:"change"}),this._handles.add(this._editGeometry.on("change",(t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.toPolygon():null,this._internalGeometryChange=!1;})),"EditGeometry"));}get vertices(){const e=[];return this.forEachVertex((t=>{e.push(t);})),e}get numVertices(){return this.initialized&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}get lastPoint(){if(this.initialized&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getLastVertex();if(r$4(e))return this._editGeometry.coordinateHelper.createPoint(e.pos)}return null}getVertex(e){if(!this.initialized||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.right.right;}while(i!==t&&null!=i);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.createPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.createPoint(this.getVertex(e).pos)}forEachVertex(e){this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e);}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex(((i,r)=>{t.toPoint(i.pos,u$2),e(u$2,r);}));}clear(){r$4(this.areaMeasurement)&&(this.areaMeasurement.geometry=null);}add(e){if(!this.initialized)return null;0===this._editGeometry.components.length&&this._editGeometry.components.push(new l$1(this._editGeometry));const t=new h$2(this._editGeometry,this._editGeometry.components[0],this._editGeometry.coordinateHelper.fromPoint(e));return this._editGeometry.apply(t),this.emit("change",{type:"change"}),t}close(){if(!this.initialized)return null;if(0===this._editGeometry.components.length)return null;const e=this._editGeometry.components[0],t=new i$1(this._editGeometry,e);return this._editGeometry.apply(t),this.emit("change",{type:"change"}),t}ensureContains(e,t=""){let i=!1;if(this._editGeometry.components.forEach((t=>{t.iterateVertices((t=>{t===e&&(i=!0);}));})),!i)throw new Error(`vertex doesnt exist ${t}`);return i}setVertexPosition(e,t){if(!this.initialized)return null;const i=new i$2(this._editGeometry,e,this._editGeometry.coordinateHelper.fromPoint(t));return this._editGeometry.apply(i),this.emit("change",{type:"change"}),i}equals(e){if(this.numVertices!==e.numVertices)return !1;let t=!0;return this.forEachVertexPosition(((i,r)=>{const o=e.getVertexPositionAsPointFromIndex(r);i.equals(o)||(t=!1);})),!!t}};e$1([y$5({value:null})],y$2.prototype,"areaMeasurement",null),e$1([y$5({value:null})],y$2.prototype,"view",null),e$1([y$5()],y$2.prototype,"isValidPolygon",null),e$1([y$5()],y$2.prototype,"numVertices",null),y$2=e$1([n$3("esri.views.3d.interactive.graphics.AreaMeasurement3D.AreaMeasurement3DPathHelper")],y$2);const u$2=new b$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
let i=class extends p$1{constructor(){super(...arguments),this.measurementData=null,this.unitNormalizer=new t$1,this.path=new y$2,this.lastDraggedVertex=null;}destroy(){this.measurementData=null,this.path=l$2(this.path);}get validMeasurement(){return this.path.isValidPolygon}};e$1([y$5()],i.prototype,"measurementData",void 0),e$1([y$5()],i.prototype,"validMeasurement",null),e$1([y$5()],i.prototype,"unitNormalizer",void 0),e$1([y$5()],i.prototype,"path",void 0),e$1([y$5()],i.prototype,"lastDraggedVertex",void 0),e$1([y$5()],i.prototype,"cursorPoint",void 0),i=e$1([n$3("esri.views.3d.layers.analysis.AreaMeasurement3D.AreaMeasurementLayerViewData")],i);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var b;!function(u){function l(o,i){const s=i.center;o$1(s,0,0,0);for(let e=0;e<o.length;++e)u$3(s,s,o[e]);d(s,s,1/o.length);let a=0;for(let e=0;e<o.length;++e)a=Math.max(a,x$2(s,o[e]));i.radius=Math.sqrt(a);}function p(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");_(e[0],e[1],e[2],t);}function b(e,t){return z$2(e,t)+e[3]}function G(e,t,n){return Rn(e,y$1,n)&&Rn(t,M,n)?q$2(y$1,M):0}function S(e,t){if(!yn(e,y$1)||!yn(t,M))return 0;const n={distance:null};return y$4(n,[y$1[0],y$1[1]],[M[0],M[1]]),n.distance}function w(e,t,n){const r={distance:null};return y$4(r,[e[0],e[1]],[t[0],t[1]],n),r.distance}function z(e,t,n){const r=t[0]-e[0],o=t[1]-e[1],i=n[0]-e[0],s=n[1]-e[1];return .5*Math.abs(r*s-o*i)}function L(e,t,n,r){const o=v$1;return En(e,r,y$1)&&En(t,r,M)&&En(n,r,P)?(o.setPoint(0,0,y$1),o.setPoint(0,1,M),o.setPoint(0,2,P),Math.abs(q$1(o,"square-meters"))):0}function k(t,n,r){Math.abs(t[0])>Math.abs(t[1])?o$1(n,0,1,0):o$1(n,1,0,0),_$1(r,t,n),j$3(n,n),_$1(n,r,t),j$3(r,r);}function q(n,r$1=null,i=!0){const u=1e-6,c=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return !1;for(let n=0;n<e.length;++n)if(z$2(t,e[n])<-u)return !1;return !0};if(0===n.length)return !1;if(1===n.length)return r$1&&r(r$1,n[0]),!0;o$1(E,0,0,0);for(let e=0;e<n.length;++e)u$3(E,E,n[e]);if(j$3(E,E),c(n,E))return r$1&&r(r$1,E),!0;if(!i)return !1;for(let e=0;e<n.length;++e)for(let t=0;t<n.length;++t)if(e!==t&&(_$1(E,n[e],n[t]),j$3(E,E),c(n,E)))return r$1&&r(r$1,E),!0;return !1}function x(e,t){if(e===t)return !0;if(e.size!==t.size)return !1;for(let n=0;n<e.size;++n)if(!t.has(e[n]))return !1;return !0}u.boundingSphere=l,u.bestFitPlane=p,u.planePointDistance=b,u.segmentLengthEuclidean=G,u.segmentLengthGeodesic=S,u.segmentLengthGeodesicVector=w,u.triangleAreaEuclidean=z,u.triangleAreaGeodesic=L,u.tangentFrame=k,u.fitHemisphere=q,u.compareSets=x;}(b||(b={}));const y$1=n(),M=n(),P=n(),v$1=new j$2({rings:[[y$1,M,P]],spatialReference:k$3.WGS84}),E=n();var G=b;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function o(o){const t=new n$5;return t.extensions.add("GL_OES_standard_derivatives"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.varyings.add("vUV","vec2"),o.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(t$5`
    void main(void) {
      vUV = uv0;
      ${o.multipassTerrainEnabled?"depth = (view * vec4(position, 1.0)).z;":""}
      gl_Position = proj * view * vec4(position, 1.0);
    }
  `),o.multipassTerrainEnabled&&(t.fragment.include(a$3),t.include(r$5,o)),t.fragment.uniforms.add("size","vec2").add("color1","vec4").add("color2","vec4"),t.fragment.include(e$6),t.fragment.code.add(t$5`
    void main() {
      ${o.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec2 uvScaled = vUV / (2.0 * size);

      vec2 uv = fract(uvScaled - 0.25);
      vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);
      float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));
      float t = mix(abs(ab.x + ab.y), 0.5, fade);

      gl_FragColor = mix(color2, color1, t);
      ${o.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
  `),t}var t=Object.freeze({__proto__:null,build:o});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class y extends t$6{initializeProgram(r){const e=y.shader.get(),t=this.configuration,o=e.build({OITEnabled:0===t.transparencyPassType,multipassTerrainEnabled:t.multipassTerrainEnabled,cullAboveGround:t.cullAboveGround});return new n$6(r.rctx,o,o$3)}bindPass(r,o){t$7(this.program,o.camera.projectionMatrix),this.program.setUniform2fv("size",r.size),this.program.setUniform4fv("color1",r.color1),this.program.setUniform4fv("color2",r.color2),o.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",o.camera.nearFar),this.program.setUniform2fv("inverseViewport",o.inverseViewport),t$8(this.program,o));}bindDraw(r){a$4(this.program,r);}setPipelineState(r){const e=this.configuration,t=3===r,o=2===r;return g$2({blending:e.transparent?t?v:c$3(r):null,depthTest:{func:a$5(r)},depthWrite:t?e.writeDepth&&l$5:l$6(r),colorWrite:r$7,polygonOffset:t||o?e.polygonOffset&&T:{factor:-1,units:-25}})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}y.shader=new t$9(t,(()=>import('./CheckerBoard.glsl-5e5f28f4.js')));const T={factor:0,units:-25},v=e$7(770,1,771,771);class j extends e$8{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1;}}e$1([r$6()],j.prototype,"transparent",void 0),e$1([r$6()],j.prototype,"writeDepth",void 0),e$1([r$6()],j.prototype,"polygonOffset",void 0),e$1([r$6({count:4})],j.prototype,"transparencyPassType",void 0),e$1([r$6()],j.prototype,"multipassTerrainEnabled",void 0),e$1([r$6()],j.prototype,"cullAboveGround",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class u$1 extends a$6{constructor(e){super(e,c),this.techniqueConfig=new j;}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e){return this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.transparencyPassType=e?e.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!e&&e.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!e&&e.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,s,a,o){return h$5(e,t,i,s,a,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output?new h$1(e):void 0}createBufferWriter(){return new f(o$4)}}class h$1 extends t$a{constructor(e){super(e),this.updateParameters();}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(y,this._material.getTechniqueConfig(e),this._technique);}beginSlot(e){let t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e);}bind(e){this._technique.bindPass(this._material.getPassParameters(),e);}}const c={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,writeDepth:!0,polygonOffset:!1,...d$3};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class l extends c$4{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=4,this._geometry=null,this._size=[1,1],this._color1=[1,.5,0,.5],this._color2=[1,1,1,.5],this.applyProps(e);}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial());}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged();}get size(){return this._size}set size(e){this._size=e,this.updateMaterial();}get color1(){return this._color1}set color1(e){this._color1=e,this.updateMaterial();}get color2(){return this._color2}set color2(e){this._color2=e,this.updateMaterial();}updateMaterial(){r$4(this._checkerBoardMaterial)&&this._checkerBoardMaterial.setParameterValues({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded});}createExternalResources(){this._checkerBoardMaterial=new u$1({size:this._size,color1:this._color1,color2:this._color2,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:4});}destroyExternalResources(){this._checkerBoardMaterial=null;}forEachExternalMaterial(r){r$4(this._checkerBoardMaterial)&&r(this._checkerBoardMaterial);}createGeometries(e){if(t$4(this._geometry)||t$4(this._checkerBoardMaterial))return;const i=h;y$8(i,this.transform);const a=this._geometry,l=[],d=n();a.position.forEach((e=>{c$2(d,e,i),l.push(d[0],d[1],d[2]);}));const n$1=[];a.uv.forEach((e=>{n$1.push(e[0],e[1]);}));const u=new u$5([["position",{size:3,data:l,exclusive:!0}],["uv0",{size:2,data:n$1,exclusive:!0}]],[["position",a.triangleIndices],["uv0",a.triangleIndices]]);e.addGeometry(u,this._checkerBoardMaterial);}geometryChanged(){this.recreateGeometry();}}const h=n();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
let U=class extends p$1{constructor(e){super(e),this._handles=new u$4,this._params={...z},this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._measurementArea=null,this._areaLabel=null,this._pathLengthLabel=null,this._cursorSegmentLengthLabel=null,this._perimeterLengthLabel=null,this._pathSegments=[],this._perimeterSegments=[],this._cursorSegment=null,this._origin=n(),this._originTransform=e$9(),this._cursorPositionRenderSpace=n(),this.messages=null,this.viewData=k,this.areaLabel=null,this.perimeterLengthLabel=null,this.mode="auto",this.geodesicMeasurementDistanceThreshold=1e5;}get visible(){return this.layerView.visible&&!this.layerView.suspended}get testData(){return {labels:{area:this._areaLabel,pathLength:this._pathLengthLabel,cursorSegmentLength:this._cursorSegmentLengthLabel,perimeterLength:this._perimeterLengthLabel}}}initialize(){const e=this.view;this._path=new m$3({view:e,attached:!0,width:this._params.pathLineWidth,color:this._params.pathLineColor,polygonOffset:!0,renderOccluded:4}),this._intersectedPath=new m$3({view:e,attached:!0,width:this._params.pathLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4}),this._perimeter=new m$3({view:e,attached:!0,width:this._params.perimeterLineWidth,color:this._params.perimeterLineColor,polygonOffset:!0,renderOccluded:4}),this._intersectedPerimeter=new m$3({view:e,attached:!0,width:this._params.perimeterLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0,renderOccluded:4}),this._projectionLines=new m$3({view:e,attached:!0,width:this._params.projectionLineWidth,color:this._params.projectionLineColor,stipplePattern:n$7(this._params.projectionLineStippleSize),stippleIntegerRepeats:!1,polygonOffset:!0,renderOccluded:4}),this._measurementArea=new l({view:e,attached:!0,color1:this._params.areaColor1,color2:this._params.areaColor2}),this._areaLabel=new v$3({view:this.view,attached:!0,fontSize:16}),this._pathLengthLabel=new v$3({view:e,attached:!0,fontSize:12}),this._cursorSegmentLengthLabel=new v$3({view:e,attached:!0,fontSize:12}),this._perimeterLengthLabel=new v$3({view:e,attached:!0,fontSize:12});const t=this.layerView,i=t.layerViewData;this._handles.add([l$7((()=>[this.mode,this.visible,t.unit,i.measurementData,i.cursorPoint]),(()=>this._update())),l$7((()=>{var t;return null==(t=e.state)?void 0:t.camera}),(()=>this._updateLabels())),g$3((async()=>this._updateMessageBundle()))]),this._updateMessageBundle();}destroy(){this._measurementArea.destroy(),this._measurementArea=null,this._path.destroy(),this._path=null,this._intersectedPath.destroy(),this._intersectedPath=null,this._perimeter.destroy(),this._perimeter=null,this._intersectedPerimeter.destroy(),this._intersectedPerimeter=null,this._areaLabel.destroy(),this._areaLabel=null,this._pathLengthLabel.destroy(),this._pathLengthLabel=null,this._cursorSegmentLengthLabel.destroy(),this._cursorSegmentLengthLabel=null,this._perimeterLengthLabel.destroy(),this._perimeterLengthLabel=null,this.set("view",null);}async whenMessages(){await j$5(this,"messages");}_update(){if(this.destroyed)return;const e=this.layerView.layerViewData.measurementData;t$4(e)||(this._updateViewData(e,this.layerView.layerViewData.path,this.layerView.layerViewData.cursorPoint),this._updateOrigin(),this._updatePathSegments(),this._updatePerimeterSegments(),this._updateArea(),this._updateProjectionLines(),this._updateLabels());}_updateViewData(e$1,t,i){const r=t.isValidPolygon,a=t.lastPoint,l=r$4(a)&&r$4(i)?new e(G.segmentLengthGeodesic(a,i),"meters"):null,m=r$4(a)&&r$4(i)?new e(e$1.unitNormalizer.normalizeDistance(G.segmentLengthEuclidean(a,i,e$1.unitNormalizer.spatialReference)),"meters"):null;let c;if("auto"===this.mode){c="euclidean";(e$1.geodesicPathLength?e$1.geodesicPathLength.value:0)+(!r&&r$4(l)?l.value:0)>this.geodesicMeasurementDistanceThreshold&&(c="geodesic");}else c=this.mode;null==e$1.geodesicPathLength&&(c="euclidean");const d="geodesic"===c,u=d?e$1.geodesicArea:e$1.area;let p=1;if(u){const t=this._toPreferredAreaUnit(u,this.layerView.unit);p=h$6(Math.sqrt(t.value)/Math.sqrt(300)),p*=Math.sqrt(I(1,t.unit,"square-meters")),p/=e$1.unitNormalizer.normalizeDistance(1);}const g={validMeasurement:r,path:t,pathVersion:t.version,cursorPoint:i,measurementData:e$1,mode:c,positionsGeographic:e$1.positionsGeographic,positionsRenderCoords:e$1.positionsRenderCoords,positionsProjected:e$1.positionsProjectedWorldCoords,positionsFittedRenderCoords:e$1.positionsFittedRenderCoords,intersectingSegments:d?e$1.geodesicIntersectingSegments:e$1.intersectingSegments,triangleIndices:d?e$1.geodesicTriangleIndices:e$1.triangleIndices,fittingMode:e$1.fittingMode,areaCentroid:d?e$1.geodesicAreaCentroidRenderCoords:e$1.areaCentroidRenderCoords,pathLengthLabelSegmentIndex:r?0:t.numVertices-2,perimeterLengthLabelSegmentIndex:0,checkerSize:p,geodesicCursorSegmentLength:l,cursorSegmentLength:m};this._set("viewData",g);}_updateOrigin(){const e=this.viewData;g$4(e.positionsRenderCoords,this._origin),r$8(this._originTransform),c$5(this._originTransform,this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform;}_createSegments(e){const t=this.viewData,i=t.path,s=this.view.renderCoordsHelper.spatialReference,r=t.mode,n=[],a=[],o=[],l=t.validMeasurement?i.numVertices:i.numVertices-1;for(let h=0;h<l;++h){const l=t[e][h],m=t[e][(h+1)%i.numVertices];let c=null;switch(r){case"euclidean":c=new _$3(l,m);break;case"geodesic":c=new f$1(l,m,s);}t.intersectingSegments.has(h)?o.push(c):a.push(c),n.push(c);}return {all:n,nonIntersecting:a,intersecting:o}}_updatePathSegments(){const e=this.visible,t=this.viewData,i=this._createSegments("positionsRenderCoords"),s=t.path,r=!s.isValidPolygon,a=t.cursorPoint,o=this.view.renderCoordsHelper,l=o.spatialReference,h=t.mode;if(this._cursorSegment=null,s.numVertices>0&&r&&r$4(a)){if(o.toRenderCoords(a,this._cursorPositionRenderSpace)){const e=t.positionsRenderCoords[s.numVertices-1],r=this._cursorPositionRenderSpace;let n=null;switch(h){case"euclidean":n=new _$3(e,r);break;case"geodesic":n=new f$1(e,r,l);}i.nonIntersecting.push(n),this._cursorSegment=n;}}this._path.setGeometryFromSegments(i.nonIntersecting,this._origin),this._path.visible=e,this._intersectedPath.setGeometryFromSegments(i.intersecting,this._origin),this._intersectedPath.visible=e,this._pathSegments=i.all;}_updatePerimeterSegments(){const e=this.visible&&"euclidean"===this.viewData.mode,t=this._createSegments("positionsFittedRenderCoords");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._perimeter.visible=e,this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPerimeter.visible=e,this._perimeterSegments=t.all;}_updateArea(){const e=this.viewData;switch(e.mode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic();}}_updateAreaEuclidean(e){const t=this.visible;e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsProjected,position:e.positionsFittedRenderCoords,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=t):this._measurementArea.visible=!1;}_updateAreaGeodesic(){this._measurementArea.visible=!1;}_updateProjectionLines(){const e=this.viewData,t=this.visible,i=e.path,s=e.mode;if(i.numVertices>0&&e.validMeasurement&&"euclidean"===s){const s=[];for(let t=0;t<i.numVertices;++t){const i=n();c$2(i,e.positionsRenderCoords[t],this._origin);const r=n();c$2(r,e.positionsFittedRenderCoords[t],this._origin),s.push([i,r]);}this._projectionLines.geometry=s,this._projectionLines.visible=t;}else this._projectionLines.geometry=null,this._projectionLines.visible=!1;}_updateLabels(){if(this.destroyed)return;const e=this.viewData,t=e.path;if(!t)return;const i=e.measurementData,s=e.mode,r=!t.isValidPolygon,o=this.visible,l=this._formatAreaLabel(this.messages,"geodesic"===s?i.geodesicArea:i.area,this.layerView.unit);r$4(l)?(this._areaLabel.geometry={type:"point",point:e.areaCentroid},this._areaLabel.text=l,this._areaLabel.visible=e.validMeasurement&&0===e.intersectingSegments.size&&o):this._areaLabel.visible=!1,this._set("areaLabel",e$5(l));const h=this._formatLengthLabel(this.messages,"geodesic"===s?i.geodesicPathLength:i.pathLength,this.layerView.unit);if(r$4(h)&&e.pathLengthLabelSegmentIndex>=0&&e.pathLengthLabelSegmentIndex<this._pathSegments.length){const i=this._pathSegments[e.pathLengthLabelSegmentIndex],s=r$4(this._cursorSegment)?this._cursorSegment:O;this._pathLengthLabel.distance=this._params.labelDistance,this._pathLengthLabel.geometry={type:"corner",left:i,right:s},this._pathLengthLabel.text=h,this._pathLengthLabel.visible=r&&t.numVertices>0&&o;}else this._pathLengthLabel.visible=!1;const m="geodesic"===s?e.geodesicCursorSegmentLength:e.cursorSegmentLength;if(r$4(m)){const e=this._formatLengthLabel(this.messages,m,this.layerView.unit);this._cursorSegmentLengthLabel.distance=this._params.labelDistance,this._cursorSegmentLengthLabel.geometry=r$4(this._cursorSegment)?{type:"segment",segment:this._cursorSegment,sampleLocation:"end"}:null,this._cursorSegmentLengthLabel.anchor="bottom",this._cursorSegmentLengthLabel.text=e$5(e),this._cursorSegmentLengthLabel.visible=r&&0!==m.value&&o;}else this._cursorSegmentLengthLabel.visible=!1;this._cursorSegmentLengthLabel.overlaps(this._pathLengthLabel)&&(this._cursorSegmentLengthLabel.visible=!1),this._pathLengthLabel.overlaps(this._areaLabel)&&(this._pathLengthLabel.visible=!1);const c="geodesic"===e.mode,d=c?i.geodesicPathLength:i.perimeterLength,u=e$5(null!=d?this._formatLengthLabel(this.messages,d,this.layerView.unit):null);if(this._set("perimeterLengthLabel",e$5(u)),e.validMeasurement&&0===e.intersectingSegments.size){this._perimeterLengthLabel.distance=this._params.labelDistance,this._perimeterLengthLabel.anchor="top",this._perimeterLengthLabel.text=u,this._perimeterLengthLabel.visible=!0;let t=!0;for(let i=0;i<e.path.numVertices;++i){const s=(e.perimeterLengthLabelSegmentIndex+i)%e.path.numVertices,r=c?this._pathSegments[s]:this._perimeterSegments[s];if(t=!0,this._perimeterLengthLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},!this._perimeterLengthLabel.overlaps(this._areaLabel))break;t=!1;}this._perimeterLengthLabel.visible=t&&o;}else this._perimeterLengthLabel.visible=!1;}_toPreferredAreaUnit(e,t){return e.toUnit(this._preferredAreaUnit(e,t))}_preferredAreaUnit(e,t){switch(t){case"metric":return v$4(e.value,e.unit);case"imperial":return J(e.value,e.unit);default:return t}}_preferredLengthUnit(e,t){const i=this._deriveLengthUnitFromAreaUnit(t);switch(i){case"metric":return E$1(e.value,e.unit);case"imperial":return N(e.value,e.unit);default:return i}}_deriveLengthUnitFromAreaUnit(e){switch(e){case"metric":return "metric";case"imperial":return "imperial";case"square-inches":return "inches";case"square-feet":return "feet";case"square-yards":return "yards";case"square-miles":return "miles";case"square-us-feet":return "us-feet";case"square-millimeters":return "millimeters";case"square-centimeters":return "centimeters";case"square-decimeters":return "decimeters";case"square-meters":return "meters";case"square-kilometers":return "kilometers";case"acres":return "imperial";case"ares":case"hectares":return "metric"}throw new Error("unhandled area unit")}_formatAreaLabel(e,t,i){return e&&t&&l$8(e,t,this._preferredAreaUnit(t,i))}_formatLengthLabel(e,t,i){return e&&t&&l$8(e,t,this._preferredLengthUnit(t,i))}_updateMessageBundle(){u$6("esri/core/t9n/Units").then((e=>{this.messages=e,this.view&&this._update();}));}};e$1([y$5()],U.prototype,"view",void 0),e$1([y$5()],U.prototype,"messages",void 0),e$1([y$5()],U.prototype,"analysis",void 0),e$1([y$5()],U.prototype,"viewData",void 0),e$1([y$5()],U.prototype,"layerView",void 0),e$1([y$5({readOnly:!0})],U.prototype,"areaLabel",void 0),e$1([y$5({readOnly:!0})],U.prototype,"perimeterLengthLabel",void 0),e$1([y$5()],U.prototype,"mode",void 0),e$1([y$5({readOnly:!0})],U.prototype,"visible",null),e$1([y$5()],U.prototype,"geodesicMeasurementDistanceThreshold",void 0),U=e$1([n$3("esri.views.3d.layers.analysis.AreaMeasurement.AreaMeasurementView")],U);const z={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25},k={validMeasurement:!1,path:null,pathVersion:-1,cursorPoint:null,measurementData:null,mode:null,positionsGeographic:null,positionsRenderCoords:null,positionsProjected:null,positionsFittedRenderCoords:null,intersectingSegments:null,triangleIndices:null,fittingMode:null,areaCentroid:null,pathLengthLabelSegmentIndex:null,perimeterLengthLabelSegmentIndex:null,checkerSize:null,geodesicCursorSegmentLength:null,cursorSegmentLength:null},O=new _$3(n(),n());

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
let u=class extends(p$2(d$4)){constructor(e){super(e),this.type="area-measurement-3d",this.layerViewData=new i,this._userUnit=null;}set unit(e){this._userUnit=e;}get unit(){return c$6(this._userUnit,this._defaultUnit)}get result(){if(r$4(this.layerViewData.measurementData)){const e=this.layerViewData.measurementData;return {area:e.area,geodesicArea:e.geodesicArea,pathLength:e.pathLength,geodesicPathLength:e.geodesicPathLength,perimeterLength:e.perimeterLength}}return {area:null,geodesicArea:null,pathLength:null,geodesicPathLength:null,perimeterLength:null}}initialize(){this.layerViewData.path.view=this.view,this.layerViewData.path.areaMeasurement=this.layer,this.analysisView=new U({view:this.view,analysis:this.layer,layerView:this}),this.analysisController=new h$4({view:this.view,analysis:this.layer,layerViewData:this.layerViewData});}destroy(){this.analysisController=l$2(this.analysisController),this.analysisView=l$2(this.analysisView);}get testData(){return {view:this.analysisView,controller:this.analysisController}}};e$1([y$5()],u.prototype,"type",void 0),e$1([y$5()],u.prototype,"analysisView",void 0),e$1([y$5()],u.prototype,"analysisController",void 0),e$1([y$5()],u.prototype,"unit",null),e$1([y$5()],u.prototype,"layer",void 0),e$1([y$5()],u.prototype,"result",null),e$1([y$5()],u.prototype,"layerViewData",void 0),e$1([y$5(e$a)],u.prototype,"_defaultUnit",void 0),e$1([y$5()],u.prototype,"_userUnit",void 0),u=e$1([n$3("esri.views.3d.layers.AreaMeasurementLayerView3D")],u);var m=u;

var AreaMeasurementLayerView3D = /*#__PURE__*/Object.freeze({
  __proto__: null,
  'default': m
});

export { AreaMeasurementLayerView3D as A, o };
