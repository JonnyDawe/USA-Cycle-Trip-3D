import { n as n$2, y as y$1, w as c$6, r, o as o$5 } from './Message-70b34921.js';
import { g, s } from './promiseUtils-2ff2b194.js';
import { y as y$2, n as n$4, E as o$3, D as u$2, z as t } from './subclass-fe5fcf78.js';
import { v, a as a$4, i as i$2, P, N } from './UniqueValueRenderer-260b50e9.js';
import { e as e$2, o as o$2, a as a$5 } from './JSONSupport-9346590f.js';
import { o as o$1 } from './Color-ae84a22a.js';
import { L } from './Loadable-d16b3d7d.js';
import { e as e$1 } from './LRUCache-eed24cc2.js';
import { T, a as a$3, n as n$3, F } from './fieldUtils-22be41cd.js';
import { d, S as S$1 } from './symbols-9e680ec7.js';
import { o as o$4 } from './PopupTemplate-d97f5e88.js';
import { r as r$1 } from './enumeration-7d0c165d.js';
import { c as c$7 } from './Point-ee7951c3.js';
import { m as m$4 } from './SimpleLineSymbol-9959d1ea.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var _;const j=n$2.getLogger("esri.renderers.DictionaryRenderer"),w={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let S=_=class extends(v(a$4)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new e$1(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary";}writeData(e,s){e&&(s.scalingExpressionInfo={expression:e,returnType:"number"});}writeVisualVariables(e,s,t,r){null!=r&&r.origin||super.writeVisualVariables(e,s,t,r);}clone(){return new _({config:y$1(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:y$1(this.fieldMap),url:y$1(this.url),visualVariables:y$1(this.visualVariables)})}async getSymbolAsync(e,t){let r$1;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r$1=await this._dictionaryPromise;}catch(d){if(g(d))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const r=""+e.attributes[t];i[s]=r;}else i[s]="";}const o=r$1(i,t);if(!o||"string"!=typeof o)return null;const n=c$6(o).toString(),p=this._symbolCache.get(n);if(p)return p.catch((()=>{this._symbolCache.pop(n);})),p;const m=o.split(";"),u=[],h=[];for(const a of m)if(a&&0!==a.length)if(-1===a.indexOf("po:"))if(-1!==a.indexOf("|"))for(const e of a.split("|"))this._itemNames.has(e)&&u.push(e);else this._itemNames.has(a)&&u.push(a);else {const e=a.substr(3).split("|");if(3===e.length){const t=e[0],r=e[1];let i=e[2];if("DashTemplate"===r)i=i.split(" ").map((e=>Number(e)));else if("Color"===r){const e=new o$1(i).toRgba();i=[e[0],e[1],e[2],255*e[3]];}else i=Number(i);h.push({primitiveName:t,propertyName:r,value:i});}}const f=!r(e.geometry)||!e.geometry.hasZ&&"point"===e.geometry.type,y=this._cimPartsToCIMSymbol(u,h,f,t);return this._symbolCache.put(n,y,1),y}async collectRequiredFields(e,s){await this.collectVVRequiredFields(e,s),this.scaleExpression&&await T(e,s,this.scaleExpression);for(const t in this.fieldMap){const r=this.fieldMap[t];s.has(r)&&e.add(r);}}get arcadeRequired(){return !0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void j.error("no valid URL!");const s$1=r(e)?e.abortOptions:null,i=L(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...s$1}),[{data:o}]=await Promise.all([i,a$3()]);if(!o)throw this._dictionaryPromise=null,new s("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=o.expression,l=o.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+o.cimRefTemplateUrl,this._itemNames=new Set(o.itemsNames),this._symbolFields=l.symbol;const c={};if(this.config){const e=this.config;for(const s in e)c[s]=e[s];}if(l.configuration)for(const t of l.configuration)c.hasOwnProperty(t.name)||(c[t.name]=t.value);const p=[];if(r(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t],r=e.fields.filter((e=>e.name===s));r.length>0&&p.push({...r[0],name:t});}return this._dictionaryPromise=n$3(n,r(e)?e.spatialReference:null,p,c).then((e=>{const s={scale:0};return (t,r$1)=>{const i=e.repurposeFeature({geometry:null,attributes:t});return s.scale=r(r$1)?r$1.scale:void 0,e.evaluate({$feature:i,$view:s})}})).catch((e=>(j.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return []}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,s)=>e+s.getAttributeHash()),"")}getMeshHash(){return `${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),i=L(r,{responseType:"json",query:{f:"json"},...s});this._ongoingRequests.set(e,i);try{return (await i).data}catch(o){return this._ongoingRequests.delete(e),Promise.reject(o)}}_combineSymbolParts(e,s,t){if(!e||0===e.length)return null;const r={...e[0]};if(e.length>1){r.symbolLayers=[];for(const s of e){const e=s;r.symbolLayers.unshift(...e.symbolLayers);}}return t&&(r.callout=w),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:s}}async _cimPartsToCIMSymbol(e,s,t,r){const i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=this._getSymbolPart(e[n],r);const o=await Promise.all(i);return new d({data:this._combineSymbolParts(o,s,t)})}};e$2([y$2({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],S.prototype,"config",void 0),e$2([y$2({type:Object,json:{write:!0}})],S.prototype,"fieldMap",void 0),e$2([y$2({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],S.prototype,"scaleExpression",void 0),e$2([o$2("scaleExpression")],S.prototype,"writeData",null),e$2([y$2({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return {enabled:!!e&&!!this.scaleExpression}}}}})],S.prototype,"scaleExpressionTitle",void 0),e$2([y$2({type:String,json:{write:!0}})],S.prototype,"url",void 0),e$2([o$2("visualVariables")],S.prototype,"writeVisualVariables",null),S=_=e$2([n$4("esri.renderers.DictionaryRenderer")],S);var x=S;

var DictionaryRenderer = /*#__PURE__*/Object.freeze({
	__proto__: null,
	'default': x
});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var n$1;const u$1=n$2.getLogger("esri.renderers.support.AttributeColorInfo");let c$5=n$1=class extends a$5{constructor(r){super(r),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null;}castField(r){return null==r?r:"function"==typeof r?(u$1.error(".field: field must be a string value"),null):o$3(r)}getAttributeHash(){return `${this.field}-${this.valueExpression}`}clone(){return new n$1({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};e$2([y$2({type:o$1,json:{type:[Number],write:!0}})],c$5.prototype,"color",void 0),e$2([y$2({type:String,json:{write:!0}})],c$5.prototype,"field",void 0),e$2([c$7("field")],c$5.prototype,"castField",null),e$2([y$2({type:String,json:{write:!0}})],c$5.prototype,"label",void 0),e$2([y$2({type:String,json:{write:!0}})],c$5.prototype,"valueExpression",void 0),e$2([y$2({type:String,json:{write:!0}})],c$5.prototype,"valueExpressionTitle",void 0),c$5=n$1=e$2([n$4("esri.renderers.support.AttributeColorInfo")],c$5);var a$2=c$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var e;let p$3=e=class extends a$5{constructor(){super(...arguments),this.unit=null;}clone(){return new e({unit:this.unit})}};e$2([y$2({type:String,json:{write:!0}})],p$3.prototype,"unit",void 0),p$3=e=e$2([n$4("esri.renderers.support.DotDensityLegendOptions")],p$3);var c$4=p$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var m$3;let y=m$3=class extends(v(a$4)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new o$1([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new m$4,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density";}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new S$1({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return [this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new m$3({attributes:y$1(this.attributes),backgroundColor:y$1(this.backgroundColor),dotBlendingEnabled:y$1(this.dotBlendingEnabled),dotShape:y$1(this.dotShape),dotSize:y$1(this.dotSize),dotValue:y$1(this.dotValue),legendOptions:y$1(this.legendOptions),outline:y$1(this.outline),referenceScale:y$1(this.referenceScale),visualVariables:y$1(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return `${this.attributes.map((e=>e.field||e.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const o of this.attributes)o.valueExpression&&await T(e,t,o.valueExpression),o.field&&e.add(o.field);}};e$2([y$2({type:[a$2],json:{write:!0}})],y.prototype,"attributes",void 0),e$2([y$2({type:o$1,json:{write:!0}})],y.prototype,"backgroundColor",void 0),e$2([y$2({type:Boolean}),o$4("dotBlendingEnabled")],y.prototype,"blendDots",void 0),e$2([y$2({type:Boolean,json:{write:!0}})],y.prototype,"dotBlendingEnabled",void 0),e$2([y$2({type:String,json:{write:!1}})],y.prototype,"dotShape",void 0),e$2([y$2({type:Number,json:{write:!1}})],y.prototype,"dotSize",void 0),e$2([y$2({type:c$4,json:{write:!0}})],y.prototype,"legendOptions",void 0),e$2([y$2({type:m$4,json:{default:null,write:!0}})],y.prototype,"outline",void 0),e$2([y$2({type:Number,json:{write:!0}})],y.prototype,"dotValue",void 0),e$2([y$2({type:Number}),o$4("dotValue")],y.prototype,"referenceDotValue",void 0),e$2([y$2({type:Number,json:{write:!0}})],y.prototype,"referenceScale",void 0),e$2([y$2({type:Number,json:{write:!0}})],y.prototype,"seed",void 0),e$2([r$1({dotDensity:"dot-density"})],y.prototype,"type",void 0),y=m$3=e$2([n$4("esri.renderers.DotDensityRenderer")],y);var b=y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var p$2;let c$3=p$2=class extends a$5{constructor(o){super(o),this.color=null,this.ratio=null;}clone(){return new p$2({color:this.color,ratio:this.ratio})}};e$2([y$2({type:o$1,json:{write:!0}})],c$3.prototype,"color",void 0),e$2([y$2({type:Number,json:{write:!0}})],c$3.prototype,"ratio",void 0),c$3=p$2=e$2([n$4("esri.renderers.support.HeatmapColorStop")],c$3);var i$1=c$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var a$1;let m$2=a$1=class extends a$4{constructor(t){super(t),this.blurRadius=10,this.colorStops=[new i$1({ratio:0,color:new o$1("rgba(255, 140, 0, 0)")}),new i$1({ratio:.75,color:new o$1("rgba(255, 140, 0, 1)")}),new i$1({ratio:.9,color:new o$1("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap";}async collectRequiredFields(t,e){const r=this.field;r&&"string"==typeof r&&F(t,e,r);}getAttributeHash(){return null}getMeshHash(){return `${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new a$1({blurRadius:this.blurRadius,colorStops:y$1(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};e$2([y$2({type:Number,json:{write:!0}})],m$2.prototype,"blurRadius",void 0),e$2([y$2({type:[i$1],json:{write:!0}})],m$2.prototype,"colorStops",void 0),e$2([y$2({type:String,json:{write:!0}})],m$2.prototype,"field",void 0),e$2([y$2({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:null==r})}}})],m$2.prototype,"fieldOffset",void 0),e$2([y$2({type:Number,json:{write:!0}})],m$2.prototype,"maxPixelIntensity",void 0),e$2([y$2({type:Number,json:{write:!0}})],m$2.prototype,"minPixelIntensity",void 0),e$2([r$1({heatmap:"heatmap"})],m$2.prototype,"type",void 0),m$2=a$1=e$2([n$4("esri.renderers.HeatmapRenderer")],m$2);var c$2=m$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var c$1;let p$1=c$1=class extends(v(a$4)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple";}async collectRequiredFields(e,r){await Promise.all([this.collectSymbolFields(e,r),this.collectVVRequiredFields(e,r)]);}async collectSymbolFields(e,r){await Promise.all(this.getSymbols().map((s=>s.collectRequiredFields(e,r))));}getSymbol(e,r){return this.symbol}async getSymbolAsync(e,r){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,r)=>e+r.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,r)=>e+JSON.stringify(r)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new c$1({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:y$1(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};e$2([y$2({type:String,json:{write:!0}})],p$1.prototype,"description",void 0),e$2([y$2({type:String,json:{write:!0}})],p$1.prototype,"label",void 0),e$2([y$2(i$2)],p$1.prototype,"symbol",void 0),e$2([r$1({simple:"simple"})],p$1.prototype,"type",void 0),p$1=c$1=e$2([n$4("esri.renderers.SimpleRenderer")],p$1);var m$1=p$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const m={key:"type",base:a$4,typeMap:{heatmap:c$2,simple:m$1,"unique-value":P,"class-breaks":N,"dot-density":b,dictionary:x},errorContext:"renderer"},n={key:"type",base:a$4,typeMap:{simple:m$1,"unique-value":P,"class-breaks":N},errorContext:"renderer"};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function o(e,n,s,t){const o=a(e,t);o&&o$5(s,o,n);}function u(e,r){if(!r||"web-scene"!==r.origin)return !0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return !0;case"heatmap":case"dictionary":case"dot-density":default:return !1}}function a(r,n){return r?u(r,n)?r.write({},n):(n.messages&&n.messages.push(new s("renderer:unsupported",`Renderer of type '${r.declaredClass}' are not supported in scenes.`,{renderer:r,context:n})),null):null}function c(e,r){return p(e,null,r)}const i=u$2({types:m});function p(e,r,s){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(s&&s.messages&&s.messages.push(new t("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:s})),null):i(e,r,s):null}

export { DictionaryRenderer as D, m as a, c, m$1 as m, n, o, p };
