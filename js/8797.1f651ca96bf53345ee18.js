(self.webpackChunk=self.webpackChunk||[]).push([[8797],{98797:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var i=r(78155),s=r(73574),n=r(80219),l=r(88903),a=r(54622),o=r(18143),d=r(15870),u=r(32422),h=r(87572),c=r(15876),y=r(47122),p=r(86125),g=r(26554),f=r(55725),v=r(31393);r(20215),r(80987),r(98548),r(20736),r(4169),r(92858),r(31531),r(82906),r(40130),r(52957),r(29126),r(6585),r(3621),r(63358),r(62121),r(81135),r(94527),r(17762),r(60816),r(61888),r(29832),r(31516),r(52109),r(89710),r(91236),r(47365),r(67079),r(71391),r(83731),r(36845),r(55688),r(15015),r(95629),r(9612),r(76326),r(4807),r(30316),r(18559),r(32769),r(42296),r(17331),r(41290),r(82361),r(65352),r(71394),r(13564),r(95559),r(68631),r(56803),r(2903),r(85570),r(71470),r(80136),r(91507),r(85289),r(98843),r(91790),r(52737),r(29831),r(16040),r(34396),r(5250),r(49878),r(84271),r(48643),r(4618),r(80657),r(94449),r(97325),r(3629),r(79506),r(26779),r(98420),r(54223),r(8725),r(51218),r(21793),r(13895),r(15576),r(28941),r(19438),r(15022),r(56416),r(92758),r(78435),r(53902),r(40481),r(78730),r(2570),r(71666),r(72257),r(41822),r(99987),r(11838),r(39068),r(24776),r(95186),r(67726),r(59312),r(93242),r(71542),r(15346),r(7571),r(58404),r(53185),r(63114),r(30665),r(28090),r(37191),r(79679),r(16063),r(43194),r(62654),r(65311),r(14754),r(72105),r(60183),r(93875),r(14215),r(20868),r(72600),r(334),r(35123),r(58576),r(42413),r(66954),r(38624),r(57424),r(49293),r(26852),r(7552),r(78082),r(37762),r(92722),r(25290),r(27270),r(84796),r(87405),r(84320),r(93450),r(97431),r(32892),r(41374),r(86897),r(41392),r(79949),r(6660),r(6783),r(75200),r(29218),r(50822),r(30494),r(55807),r(29986),r(26882),r(16408),r(32553),r(60255),r(81578);const F=n.n.getLogger("esri.views.3d.layers.SceneLayerView3D"),_=(0,h.a)();let w=class extends((0,d.z)((0,p.p)((0,f.c)((0,u.m)(h.o))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.lodFactor=1,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get filter(){return(0,n.r)(this.viewFilter)?this.viewFilter.filter:null}set filter(e){!(0,n.t)(e)&&c.k.checkSupport(e)?(0,n.r)(this.viewFilter)?this.viewFilter.filter=e:this.viewFilter=new c.k({filter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError)}):this.viewFilter=null}get requiredFields(){var e,t;return null!=(e=null==(t=this.fieldsHelper)?void 0:t.requiredFields)?e:[]}get floorFilterClause(){const e=(0,g.o)(this);return(0,n.r)(e)?a.WhereClause.create(e,this.layer.fieldsIndex):null}get lodCrossfadeinDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?e:0}get lodCrossfadeoutDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?e:0}get lodCrossfadeUncoveredDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?e:0}initialize(){this.fieldsHelper=new h.c({layerView:this}),this.updatingHandles.add(this.layer,"rangeInfos",(e=>this._rangeInfosChanged(e)),2),this.updatingHandles.add(this.layer,"renderer",(e=>this.updatingHandles.addPromise(this._rendererChange(e))),2);for(const e of["parsedDefinitionExpression","filter","viewFilter.parsedWhereClause","viewFilter.parsedGeometry","viewFilter.sortedObjectIds","floorFilterClause"])this.updatingHandles.add(this,e,(()=>this._filterChange()));for(const e of["filter","viewFilter.parsedGeometry"])this.updatingHandles.add(this,e,(()=>this._geometryFilterChange()));this.handles.add(this.layer.on("apply-edits",(e=>this.updatingHandles.addPromise(e.result)))),this.handles.add(this.layer.on("edits",(e=>this._handleEdits(e))))}destroy(){this.fieldsHelper=(0,n.k)(this.fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&F.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,n.r)(this.filter)?this.filter.createQuery(e):new o.b(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==t?void 0:t.signal).then((e=>{if(null==e||!e.features)return e;const t=this.layer;for(const r of e.features)r.layer=t,r.sourceLayer=t;return e}))}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=(0,d.u)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new c.d({layerView:this,priority:u.p.FEATURE_QUERY_ENGINE,spatialIndex:new c.y({featureAdapter:new c.n({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures(((t,r,i)=>e({id:t,index:r,meta:i})),t,2),getFeatureExtent:e,sourceSpatialReference:(0,y.p)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof o.b){const{set:r,handle:i}=t.acquireSet();return this.queryObjectIds(e).then((e=>t.setFeatureIds(r,e))),i}return super.highlight(e)}createInteractiveEditSession(e){return(0,h.s)(this.attributeEditingContext,e)}_createLayerGraphic(e){const t=new s.h(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters();return this.floorFilterClause&&this.addSqlFilter(e,this.floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,n.r)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,n.t)(e)?this.createQuery():o.b.from(e))}get attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:e=>this._forAllNodes((t=>(0,n.r)(t)?e(t.node,t.featureIds):null)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){(0,h.i)(this.attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return(0,n.r)(e)&&(0,n.r)(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter;return(0,n.t)(t)||t.isMBSGeoemtryVisible(e,this.view.spatialReference,this._controller.crsIndex)?0:1}};(0,i.e)([(0,l.y)({aliasOf:"layer"})],w.prototype,"i3slayer",void 0),(0,i.e)([(0,l.y)()],w.prototype,"suspended",void 0),(0,i.e)([(0,l.y)(u.z)],w.prototype,"updatingProgress",void 0),(0,i.e)([(0,l.y)({type:v.y})],w.prototype,"filter",null),(0,i.e)([(0,l.y)()],w.prototype,"viewFilter",void 0),(0,i.e)([(0,l.y)(_.requiredFields)],w.prototype,"requiredFields",null),(0,i.e)([(0,l.y)(_.availableFields)],w.prototype,"availableFields",void 0),(0,i.e)([(0,l.y)()],w.prototype,"fieldsHelper",void 0),(0,i.e)([(0,l.y)()],w.prototype,"floorFilterClause",null),(0,i.e)([(0,l.y)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],w.prototype,"lodFactor",void 0),(0,i.e)([(0,l.y)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],w.prototype,"updatingProgressValue",void 0),w=(0,i.e)([(0,l.n)("esri.views.3d.layers.SceneLayerView3D")],w);const b=w}}]);