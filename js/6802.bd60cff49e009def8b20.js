(self.webpackChunk=self.webpackChunk||[]).push([[6802],{96802:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>O});var i,o=r(78155),n=r(20215),s=r(88903),a=r(80219),c=r(80987),l=r(73574),h=r(32769),d=r(33897),p=r(66532),y=r(18143),u=r(32422),f=r(50822),g=r(31393);r(98548),r(20736),r(4169),r(92858),r(31531),r(82906),r(40130),r(52957),r(29126),r(6585),r(3621),r(63358),r(62121),r(81135),r(94527),r(17762),r(60816),r(61888),r(29832),r(31516),r(52109),r(89710),r(83731),r(36845),r(30466),r(98843),r(65352),r(85570),r(71470),r(80136),r(91507),r(85289),r(9612),r(8725),r(41392),r(79949),r(71391),r(55688),r(15015),r(95629),r(76326),r(4807),r(30316),r(18559),r(42296),r(17331),r(41290),r(91236),r(82361),r(71394),r(13564),r(95559),r(68631),r(56803),r(2903),r(91790),r(52737),r(47365),r(67079),r(29831),r(16040),r(34396),r(5250),r(49878),r(84271),r(48643),r(4618),r(80657),r(94449),r(97325),r(3629),r(79506),r(26779),r(98420),r(54223),r(51218),r(21793),r(13895),r(15576),r(28941),r(19438),r(15022),r(56416),r(92758),r(78435),r(53902),r(40481),r(78730),r(2570),r(71666),r(72257),r(41822),r(99987),r(11838),r(39068),r(24776),r(95186),r(67726),r(59312),r(58404),r(30665),r(53185),r(28090),r(70448),r(42413),r(7571),r(93242),r(66954),r(38624),r(57424),r(54325),r(55807),r(54622),r(29986),r(26882),r(16408),r(32553),r(60255),r(37191),r(1357),r(74589),r(79679),r(71542),r(16063),r(43194),r(62654),r(15346),r(65311),r(72105),r(60183),r(93875),r(14215),r(20868),r(72600),r(334),r(37762),r(92722),r(25290),r(7552),r(78082),r(27270),r(84796),r(87405),r(84320),r(93450),r(97431),r(32892),r(41374),r(86897),r(6660),r(6783),r(75200),r(29218),r(49293),r(30494);let v=i=class extends l.h{getObjectId(){return this.objectId}clone(){return new i({objectId:this.objectId,...this.cloneProperties()})}};(0,o.e)([(0,s.y)({type:Number,json:{read:!0}})],v.prototype,"objectId",void 0),v=i=(0,o.e)([(0,s.n)("esri.layers.graphics.controllers.StreamGraphic")],v);class w{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let m=class extends((0,h.a)((0,c.d)(o.p))){constructor(){super(...arguments),this._updateInfo={websocket:0,client:0},this.graphics=new p.s}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}clear(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||"connected"===this.connection.connectionStatus}_startup(){const{parsedUrl:e,spatialReference:t,definitionExpression:r,geometryDefinition:i,objectIdField:o,timeInfo:n,purgeOptions:s,maxReconnectionAttempts:a,maxReconnectionInterval:l,updateInterval:h}=this.layer,p=c.i.toJSON(this.layer.geometryType),y=t,u=this.layerView.view.spatialReference,f={geometry:i,where:r};this.clear(),this._set("connection",(0,d.t)(e,y,u,p,f,a,l)),this._outSpatialReference=u.toJSON(),this.store=new w(this._onUpdate.bind(this)),this.featuresManager=new d.h(this.store,o,n.toJSON(),s),this.handles.add([this.connection.on("feature",(e=>this._onFeature(e))),this.layer.watch("definitionExpression",(()=>this._startup())),this.layer.watch("geometryDefinition",(()=>this._startup())),this.layer.watch("purgeOptions",(()=>this._startup()))]);let g=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),t=e-g;if(t>2500){g=e;const r=Math.round(this._updateInfo.client/(t/1e3)),i=Math.round(this._updateInfo.websocket/(t/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit("update-rate",{client:r,websocket:i})}this.featuresManager.checkForUpdates()}),h)}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);const t=v.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){(0,a.r)(t)&&this.graphics.removeMany(t),(0,a.r)(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}};(0,o.e)([(0,s.y)()],m.prototype,"connection",void 0),(0,o.e)([(0,s.y)()],m.prototype,"layer",void 0),(0,o.e)([(0,s.y)()],m.prototype,"layerView",void 0),(0,o.e)([(0,s.y)({readOnly:!0})],m.prototype,"updating",null),m=(0,o.e)([(0,s.n)("esri.layers.graphics.controllers.StreamController")],m);var _=m;const I=e=>{let t=class extends e{constructor(...e){super(...e),this.connectionError=null,this.connectionStatus="disconnected",this.filter=null}};return(0,o.e)([(0,s.y)({readOnly:!0})],t.prototype,"connectionError",void 0),(0,o.e)([(0,s.y)({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),(0,o.e)([(0,s.y)({type:g.y})],t.prototype,"filter",void 0),t=(0,o.e)([(0,s.n)("esri.layers.mixins.StreamLayerView")],t),t};let b=class extends(I((0,p.E)((0,u.m)(f.d)))){constructor(){super(...arguments),this.type="stream-3d",this.updatePolicy=0,this.hasZ=!0,this.hasM=!1}get connectionError(){const e=this.get("controller.connection.errorString");if(e)return new n.s("stream-controller",e)}createQuery(){return new y.b({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),null==t?void 0:t.signal)}createController(){return new _({layer:this.layer,layerView:this})}beforeSetController(){}};(0,o.e)([(0,s.y)({readOnly:!0})],b.prototype,"updatePolicy",void 0),(0,o.e)([(0,s.y)({readOnly:!0})],b.prototype,"connectionError",null),(0,o.e)([(0,s.y)()],b.prototype,"controller",void 0),(0,o.e)([(0,s.y)({readOnly:!0})],b.prototype,"hasZ",void 0),(0,o.e)([(0,s.y)({readOnly:!0})],b.prototype,"hasM",void 0),b=(0,o.e)([(0,s.n)("esri.views.3d.layers.StreamLayerView3D")],b);const O=b}}]);