(self.webpackChunk=self.webpackChunk||[]).push([[5611],{55611:(t,r,e)=>{"use strict";e.r(r),e.d(r,{default:()=>c}),e(33807);var a=e(80219),n=e(62654),f=e(30494),o=e(60816),i=e(72600),s=e(7571),u=e(92858),l=e(55878);e(15346),e(20215),e(65352),e(31531),e(20736),e(78155),e(88903),e(4169),e(93242),e(98548),e(63358),e(80987),e(58404),e(29081),e(29126),e(49878),e(17762),e(14754);class b{transform(t){const r=this._transform(t),e=[r.points.buffer,r.rgb.buffer];(0,a.r)(r.pointIdFilterMap)&&e.push(r.pointIdFilterMap.buffer);for(const t of r.attributes)"buffer"in t.values&&(0,a.J)(t.values.buffer)&&t.values.buffer!==r.rgb.buffer&&e.push(t.values.buffer);return Promise.resolve({result:r,transferList:e})}_transform(t){const r=(0,l.c)(t.schema,t.geometryBuffer);let e=r.length/3,n=null;const f=[],o=(0,l.a)(t.primaryAttributeData,r,e);(0,a.r)(t.primaryAttributeData)&&o&&f.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:o});const i=(0,l.a)(t.modulationAttributeData,r,e);(0,a.r)(t.modulationAttributeData)&&i&&f.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:i});let s=(0,l.u)(t.rendererInfo,o,i,e);if(t.filterInfo&&t.filterInfo.length>0&&(0,a.r)(t.filterAttributesData)){const a=t.filterAttributesData.map((t=>{const a=(0,l.a)(t,r,e),n={attributeInfo:t.attributeInfo,values:a};return f.push(n),n}));n=new Uint32Array(e),e=(0,l.m)(r,s,n,t.filterInfo,a)}for(const a of t.userAttributesData){const t=(0,l.a)(a,r,e);f.push({attributeInfo:a.attributeInfo,values:t})}3*e<s.length&&(s=new Uint8Array(s.buffer.slice(0,3*e))),this._applyElevationOffsetInPlace(r,e,t.elevationOffset);const b=this._transformCoordinates(r,e,t.obb,u.k.fromJSON(t.inSR),u.k.fromJSON(t.outSR));return{obb:t.obb,points:b,rgb:s,attributes:f,pointIdFilterMap:n}}_transformCoordinates(t,r,e,a,f){if(!(0,s.x)(t,a,0,t,f,0,r))throw Error("Can't reproject");const u=(0,i.t)(e.center[0],e.center[1],e.center[2]),l=(0,i.n)(),b=(0,i.n)();(0,n.w)(h,e.quaternion);const c=new Float32Array(3*r);for(let a=0;a<r;a++)l[0]=t[3*a]-u[0],l[1]=t[3*a+1]-u[1],l[2]=t[3*a+2]-u[2],(0,o.W)(b,l,h),e.halfSize[0]=Math.max(e.halfSize[0],Math.abs(b[0])),e.halfSize[1]=Math.max(e.halfSize[1],Math.abs(b[1])),e.halfSize[2]=Math.max(e.halfSize[2],Math.abs(b[2])),c[3*a]=l[0],c[3*a+1]=l[1],c[3*a+2]=l[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const h=(0,f.r)(),c=function(){return new b}}}]);