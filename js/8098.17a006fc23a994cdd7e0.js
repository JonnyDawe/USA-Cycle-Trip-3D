(self.webpackChunk=self.webpackChunk||[]).push([[8098],{68098:(e,t,i)=>{"use strict";i.r(t),i.d(t,{D:()=>oe,o:()=>x}),i(33807);var s=i(78155),r=i(80219),a=i(88903),n=i(39306),o=i(32422),l=i(83731),h=i(60816),d=i(36845),c=i(13263),u=i(98548),_=i(7571),p=i(65352),g=i(6585),m=i(94527),v=i(67726),y=i(86897),w=i(58275),b=i(71542),f=i(79679),L=i(20868),z=i(72105),M=i(93875),O=i(93242),C=i(15346),V=i(3621),S=i(50822);let P=class extends s.p{constructor(e){super(e),this._unitNormalizer=new n.t,this._handles=new l.u,this._tempStartPosition=(0,h.n)(),this._tempEndPosition=(0,h.n)(),this._tempCornerPosition=(0,h.n)()}initialize(){this._handles.add((0,d.j)(this.view,"ready",(()=>this._initialize()),!0))}destroy(){this._handles=(0,r.k)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,p.e)(e),i=t===p.a?p.b:t;this._sphericalPCPF=i;const r=(0,_.n)(e,i);this._unitNormalizer.spatialReference=r?i:e,this._handles.add((0,s.N)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e})))}get _computedResult(){const{startPoint:e,endPoint:t}=this.layer;if((0,r.t)(e)||(0,r.t)(t))return null;const i=this._euclideanDistances(e,t),s=this._exactGeodesicDistanceAndAngle(e,t,i.horizontal.value);return{directDistance:i.direct,horizontalDistance:i.horizontal,verticalDistance:i.vertical,geodesicDistance:s.distance,geodesicAngle:s.angle}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,r=this._tempEndPosition,a=this._tempCornerPosition,o=this.view.spatialReference,l=this._sphericalPCPF,d=(0,_.n)(o,l)?l:o;(0,_.R)(e,s,d),(0,_.R)(t,r,d),(0,_.R)(i,a,d);const c=(0,h.q)(s,r),u=(0,h.q)(a,r),p=Math.abs(t.z-e.z),g=e=>this._unitNormalizer.normalizeDistance(e),m=g(c),v=g(u),y=g(p);return{direct:new n.e(m,"meters"),horizontal:new n.e(v,"meters"),vertical:new n.e(y,"meters")}}_exactGeodesicDistanceAndAngle(e,t,i){const s=e.spatialReference,r=new u.m({spatialReference:s});r.addPath([e,t]);const a=s.isGeographic&&(0,n.d)(s)?(0,n.g)([r],"meters")[0]:s.isWebMercator?(0,c.geodesicLength)(r,"meters"):void 0,{distance:o,angle:l}=a?{distance:a,angle:this._fallbackGeodesicAngle(a,s)}:this._fallbackGeodesicDistance(e,t,i);return{distance:new n.e(o,"meters"),angle:new n.e(l,"degrees")}}_fallbackGeodesicAngle(e,t){return e/(0,p.p)(t).metersPerDegree}_fallbackGeodesicDistance(e,t,i){if((0,_.y)(e,E)){(0,_.y)(t,D);const e=(0,h.g)(E[0]),i=(0,h.g)(E[1]),s=(0,h.g)(D[0]),r=(0,h.g)(D[1]),a=Math.abs(s-e),o=(0,h.x)(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(a)),l=(0,h.N)(o),d={distance:0};return(0,n.y)(d,[E[0],E[1]],[D[0],D[1]]),{distance:d.distance,angle:l}}const s=e.spatialReference,r=i;return{distance:r,angle:this._fallbackGeodesicAngle(r,s)}}};(0,s.e)([(0,a.y)()],P.prototype,"view",void 0),(0,s.e)([(0,a.y)()],P.prototype,"layer",void 0),(0,s.e)([(0,a.y)()],P.prototype,"viewData",void 0),(0,s.e)([(0,a.y)()],P.prototype,"_computedResult",null),P=(0,s.e)([(0,a.n)("esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController")],P);const E=(0,h.n)(),D=(0,h.n)();function x(){const e=new z.n;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(z.t`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(z.t`
    const float INV_SQRT2 = ${z.t.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}var A=Object.freeze({__proto__:null,build:x});class R extends z.c{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=R.shader.get().build();return new z.d(e.rctx,t,z.o)}bindPass(e,t){(0,z.h)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}bindDraw(e){(0,z.a2)(this.program,e),this.program.rebindTextures()}initializePipeline(){return(0,M.g)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:M.l,colorWrite:M.r})}get primitiveType(){return 5}}R.shader=new z.f(A,(()=>i.e(4651).then(i.bind(i,14651))));class G extends z.b{constructor(){super(...arguments),this.polygonOffsetEnabled=!1}}(0,s.e)([(0,z.a)()],G.prototype,"polygonOffsetEnabled",void 0);class T extends z.a6{constructor(e){super(e,q),this.techniqueConfig=new G}getTechniqueConfig(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}dispose(){}getPassParameters(){return this.params}intersect(){}createBufferWriter(){return new I}getGLMaterial(e){return 0===e.output?new k(e):void 0}}class k extends z.aj{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(R,this._material.getTechniqueConfig(),this._technique)}beginSlot(e){return 3===e}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const q={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...z.ab},j=(0,L.A)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),U=(0,h.n)(),H=(0,h.n)(),W=(0,h.n)(),Q=(0,h.n)(),F=(0,h.n)();class I{constructor(){this.vertexBufferLayout=j}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get("position").length/2+1)}write(e,t,i,s){const r=t.vertexAttributes.get("position").data,a=t.vertexAttributes.get("normal").data,n=r.length/3,o=t&&t.indices&&t.indices.get("position");o&&o.length!==2*(n-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=U,d=H,c=W,u=Q,_=F,p=e.transformation,g=e.invTranspTransformation,m=i.position,v=i.normal,y=i.uv0;let w=0;for(let e=0;e<n;++e){const t=3*e;if((0,h.a)(l,r[t],r[t+1],r[t+2]),e<n-1){const t=3*(e+1);(0,h.a)(d,r[t],r[t+1],r[t+2]),(0,h.a)(_,a[t],a[t+1],a[t+2]),(0,h.j)(_,_),(0,h.c)(c,d,l),(0,h.j)(c,c),(0,h._)(u,_,c),(0,h.j)(u,u)}const i=(0,h.q)(l,d);p&&g&&((0,h.I)(l,l,p),(0,h.I)(d,d,p),(0,h.I)(u,u,g));const o=s+2*e,b=o+1;m.setVec(o,l),m.setVec(b,l),v.setVec(o,u),v.setVec(b,u),y.set(o,0,w),y.set(o,1,-1),y.set(b,0,w),y.set(b,1,1),e<n-1&&(w+=i)}const b=i.auxpos1;for(let e=0;e<2*n;++e)b.set(s+e,w)}}class N extends w.c{constructor(e){super(e),this._parameters=B,this._handles=null,this._origin=(0,h.n)(),this._originTransform=(0,b.e)(),this._arrowCenter=(0,h.n)(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}createExternalResources(){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new T({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:e,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new l.u,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,r.t)(this._geometry)||(0,r.t)(this._geometry.startRenderSpace)||(0,r.t)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,t,i,s){const r=this.view.renderCoordsHelper,a=[],n=[],l=(e,t)=>{const s=f.c.get();(0,h.c)(s,e,i),a.push(s),n.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=f.c.get();r.worldUpAtPosition(this._arrowCenter,i),l(e,i),l(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),a=f.c.get(),n=f.c.get();s.eval(i,a),r.worldUpAtPosition(a,n),l(a,n)}}return o.q.createPolylineGeometry(a,n)}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&(0,r.r)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const B={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};class $ extends w.c{constructor(e){super(e),this._handles=new l.u,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,h.n)(),this._up=(0,h.n)(),this._right=(0,h.n)(),this._renderOccluded=4,this._color=(0,y.t)(1,0,0,1),this._outlineColor=(0,y.t)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,C.a)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,C.a)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,h.q)(t,e),(0,h.q)(t,i))/3,(0,h.j)(this._up,(0,h.c)(this._up,e,t)),(0,h.j)(this._right,(0,h.c)(this._right,i,t)),(0,h.h)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new o.a3(this.quadMaterialParameters),this._outlineMaterial=new o.a4(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,h.u)(f.c.get(),this._up,this._right),i=o.q.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,O.r)(J),(0,O.c)(J,J,this._position),(0,O.i)(J,J,[s,s,s]),(0,r.r)(e)&&(e.transformation=J)}_quadGeometryData(e,t){const i=(0,h.u)(f.c.get(),e,t);return new z.u([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const J=(0,b.e)();let K=class extends s.p{constructor(e){super(e),this._params={...Y},this._handles=new l.u,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,h.n)(),this._endPosition=(0,h.n)(),this._cornerPosition=(0,h.n)(),this._startPositionAtSeaLevel=(0,h.n)(),this._endPositionAtSeaLevel=(0,h.n)(),this._state=0,this._segmentLabelDisplayedMeasurement=1,this._triangleOrientationOverride=null,this.messages=null,this.viewMode=0,this.visualizedMeasurement=0,this.actualVisualizedMeasurement=1,this.visualElementOrientation=0,this.triangleCollapseRatioThreshold=.03}get _geodesicDistanceExceeded(){var e;const t=this.layerView.result;return(0,r.r)(t)&&(null==(e=t.horizontalDistance)?void 0:e.value)>this.layer.geodesicDistanceThreshold}get ready(){return 1===this._state}get visible(){return this.layerView.visible&&!this.layerView.suspended}get allowVisualElementsOrientationChange(){return(0,r.t)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,r.t)(this._triangleOrientationOverride)!==e&&((0,r.t)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():this._triangleOrientationOverride=null)}get labels(){return 2===this.actualVisualizedMeasurement?{direct:this._horizontalLabel,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement.stripeLength}}initialize(){this._handles.add((0,d.j)(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this._state){case 1:throw new Error("invalid state");case 2:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new N({...t,geometry:null,renderOccluded:4}),this._triangleVisualElement=new w.m({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:4}),this._rightAngleQuad=new $({...t,color:X,renderOccluded:4});const i={...t,polygonOffset:!0,stippleIntegerRepeats:!1,renderOccluded:4};this._projectedGeodesicLine=new w.m({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,o.a5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new w.m({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,o.a5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new w.m({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,o.a5)(e.guideStippleLengthPixels)}),this._segmentLabel=new n.v({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new n.v({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new n.v({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,s.l)((()=>this._updateGeometryAndViewMode())),(0,s.l)((()=>this._updateVisualElementVisibility())),(0,s.l)((()=>this._updateLabelText())),(0,s.l)((()=>this._updateLabelVisibility())),(0,s.l)((()=>this._updateSegmentStripeLength())),(0,V.g)((async()=>this._updateMessageBundle()))]),this._state=1,this._updateMessageBundle()}destroy(){2!==this._state&&(this._handles=(0,r.k)(this._handles),this._segmentVisualElement=(0,r.k)(this._segmentVisualElement),this._triangleVisualElement=(0,r.k)(this._triangleVisualElement),this._rightAngleQuad=(0,r.k)(this._rightAngleQuad),this._projectedGeodesicLine=(0,r.k)(this._projectedGeodesicLine),this._geodesicStartHint=(0,r.k)(this._geodesicStartHint),this._geodesicEndHint=(0,r.k)(this._geodesicEndHint),this._segmentLabel=(0,r.k)(this._segmentLabel),this._verticalLabel=(0,r.k)(this._verticalLabel),this._horizontalLabel=(0,r.k)(this._horizontalLabel),this.set("view",null),this._state=2)}async whenReady(){await(0,d.j)(this,"ready")}async whenMessages(){await this.whenReady(),await(0,d.j)(this,"messages")}_updateVisualElementVisibility(){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this.visible)switch(this.viewMode){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(){const e=this.view.renderCoordsHelper,{startPoint:t,endPoint:i}=this.layer;if((0,r.t)(t)||(0,r.t)(i)||t.equals(i)){this.viewMode=0;const e=this.visualizedMeasurement,t=0===e;return void(this.actualVisualizedMeasurement=t?1:e)}e.toRenderCoords(t,this._startPosition),e.toRenderCoords(i,this._endPosition);const s=this._getActualVisualElementsOrientation(),a=this._updateActualVisualizedMeasurement();this.viewMode=this._computeViewMode(a);let o=this._startPosition,l=this._endPosition;const h=1===s?1:-1,d=h*(e.getAltitude(l)-e.getAltitude(o));d<0&&(o=this._endPosition,l=this._startPosition);const c=2===a?new n.f(this._startPosition,this._endPosition,e.spatialReference):new n._(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=c,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=a,this.viewMode){case 1:this._updateSegment(c,s);break;case 2:this._updateSegmentAndTriangle(c,s,o,l,h,d);break;case 3:this._updateSegmentAndProjection(s)}}_updateSegment(e,t){this._segmentLabel.anchor=1===t?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle(e,t,i,s,r,a){const o=this.view,l=o.renderCoordsHelper,d=o.state.camera,c=this._cornerPosition;l.worldUpAtPosition(i,c),(0,h.d)(c,c,r*Math.abs(a)),(0,h.u)(c,c,i),this._triangleVisualElement.geometry=[[[i[0],i[1],i[2]],[c[0],c[1],c[2]],[s[0],s[1],s[2]]]],this._rightAngleQuad.geometry={previous:i,center:c,next:s};const u=new n._(i,c),_=new n._(c,s),p=function(e,t,i,s,r){const a=ee,o=te;r.projectToRenderScreen(i,a),r.projectToRenderScreen(t,o);const l={segment:"bottom",horizontal:"top",vertical:a[0]<o[0]?"left":"right"};{const s=ie,a=se;if((0,n.k)(e,i,s,r),(0,n.k)(e,t,a,r),(0,v._)(s,a)>=Z){const e=(0,h.e)(s[1])===(0,h.e)(a[1]);l.segment=e?(0,n.i)(l.vertical):l.vertical}else{const e=re;(0,n.k)(i,t,e,r),(0,v._)(e,a)>=Z&&(l.segment=(0,h.e)(e[0])===(0,h.e)(a[0])?(0,n.i)(l.horizontal):l.horizontal)}}if(2===s){const e=e=>"top"===e?"bottom":"top";l.segment=e(l.segment),l.horizontal=e(l.horizontal),l.vertical=e(l.vertical)}return l}(i,s,c,t,d);this._segmentLabel.anchor=p.segment,this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._verticalLabel.anchor=p.vertical,this._horizontalLabel.geometry={type:"segment",segment:_,sampleLocation:"center"},this._horizontalLabel.anchor=p.horizontal}_updateSegmentAndProjection(e){const t=this.view.renderCoordsHelper;t.setAltitude(this._startPositionAtSeaLevel,0,this._startPosition),t.setAltitude(this._endPositionAtSeaLevel,0,this._endPosition);const i=new n.f(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._geodesicStartHint.setGeometryFromSegment(new n._(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new n._(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._segmentLabel.anchor=1===e?"top":"bottom"}_updateLabelText(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel,s=this.messages,a=this.layerView.result;if((0,r.t)(a)||(0,r.t)(s))return e.text=null,t.text=null,void(i.text=null);const n=this._getLabelsText(s,a),o=1===this._segmentLabelDisplayedMeasurement;e.text=o?n.euclideanDistance:n.geodesicDistance,t.text=n.horizontalDistance,i.text=n.verticalDistance,this.notifyChange("labels")}_updateLabelVisibility(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel;if(e.visible=!1,t.visible=!1,i.visible=!1,this.visible)switch(this.viewMode){case 1:e.visible=!0;break;case 2:e.visible=!0,t.visible=!0,i.visible=!0;break;case 3:e.visible=!0}}_getLabelsText(e,{directDistance:t,horizontalDistance:i,verticalDistance:s,geodesicDistance:r,geodesicAngle:a}){const o=this.layerView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return l({euclideanDistance:t&&(0,n.c)(e,t),geodesicDistance:r&&(0,n.c)(e,r),horizontalDistance:i&&(0,n.c)(e,i),verticalDistance:s&&(0,n.s)(e,s)});case"imperial":return l({euclideanDistance:t&&(0,n.h)(e,t),geodesicDistance:r&&(0,n.h)(e,r),horizontalDistance:i&&(0,n.h)(e,i),verticalDistance:s&&(0,n.b)(e,s)});case"degrees":{const t=a&&(0,n.l)(e,a,"degrees");return l({euclideanDistance:t,geodesicDistance:t,horizontalDistance:t})}case"degrees-minutes-seconds":return l({horizontalDistance:a&&(0,n.a)(a)});default:return l({euclideanDistance:t&&(0,n.l)(e,t,o),geodesicDistance:r&&(0,n.l)(e,r,o),horizontalDistance:i&&(0,n.l)(e,i,o),verticalDistance:s&&(0,n.l)(e,s,o)})}}_updateSegmentStripeLength(){const e=this._measurementArrowStripeLength,t=this._segmentVisualElement;(0,r.r)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}_computeViewMode(e){if(2===e){if(!this._geodesicDistanceExceeded)return 1;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return 3}const t=this.layerView.result;if((0,r.t)(t))return 1;const{verticalDistance:i,horizontalDistance:s}=t,a=i.value,n=s.value;return Math.min(a/n,n/a)<this.triangleCollapseRatioThreshold?1:2}_getActualVisualElementsOrientation(){if((0,r.r)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return 0===e?this.view.state.camera.aboveGround?1:2:e}_updateActualVisualizedMeasurement(){if(0===this.visualizedMeasurement){this.actualVisualizedMeasurement=1;const e=this.layerView.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this.actualVisualizedMeasurement=2),this._geodesicDistanceExceeded&&(this.actualVisualizedMeasurement=2)}else this.actualVisualizedMeasurement=this.visualizedMeasurement;return this.actualVisualizedMeasurement}_requiresGeodesicGuideAt(e){const t=this.view;if(!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,r=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/r>=10}get _measurementArrowStripeLength(){const e=this.view,{result:t,unit:i}=this.layerView;let s=null;if((0,r.r)(t)){const e=t.directDistance;switch(i){case"metric":s=e&&e.toUnit("meters");break;case"imperial":s=e&&e.toUnit((0,p.N)(e.value,e.unit));break;case"degrees":case"degrees-minutes-seconds":{const e=t.geodesicAngle;s=e&&e.toUnit("degrees");break}default:s=e&&e.toUnit(i)}}if(s){let t=1;return t=(0,h.a8)(s.value/30),t*="degrees"===s.unit?(0,p.p)(e.spatialReference).metersPerDegree:(0,p.I)(1,s.unit,"meters"),t}return null}_updateMessageBundle(){(0,g.a)("esri/core/t9n/Units").then((e=>{this.messages=e,this.view&&this._updateLabelText()}))}};(0,s.e)([(0,a.y)()],K.prototype,"_state",void 0),(0,s.e)([(0,a.y)()],K.prototype,"_segmentLabelDisplayedMeasurement",void 0),(0,s.e)([(0,a.y)()],K.prototype,"_triangleOrientationOverride",void 0),(0,s.e)([(0,a.y)()],K.prototype,"_geodesicDistanceExceeded",null),(0,s.e)([(0,a.y)()],K.prototype,"messages",void 0),(0,s.e)([(0,a.y)()],K.prototype,"view",void 0),(0,s.e)([(0,a.y)()],K.prototype,"layer",void 0),(0,s.e)([(0,a.y)()],K.prototype,"layerView",void 0),(0,s.e)([(0,a.y)({readOnly:!0})],K.prototype,"ready",null),(0,s.e)([(0,a.y)({readOnly:!0})],K.prototype,"visible",null),(0,s.e)([(0,a.y)()],K.prototype,"viewMode",void 0),(0,s.e)([(0,a.y)()],K.prototype,"visualizedMeasurement",void 0),(0,s.e)([(0,a.y)()],K.prototype,"actualVisualizedMeasurement",void 0),(0,s.e)([(0,a.y)()],K.prototype,"visualElementOrientation",void 0),(0,s.e)([(0,a.y)()],K.prototype,"triangleCollapseRatioThreshold",void 0),(0,s.e)([(0,a.y)()],K.prototype,"allowVisualElementsOrientationChange",null),(0,s.e)([(0,a.y)()],K.prototype,"labels",null),(0,s.e)([(0,a.y)()],K.prototype,"testData",null),(0,s.e)([(0,a.y)()],K.prototype,"_measurementArrowStripeLength",null),K=(0,s.e)([(0,a.n)("esri.views.3d.layers.DirectLineMeasurement.DirectLineMeasurementView")],K);const X=(0,y.t)(1,.5,0,.75),Y={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:X,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:X,guideLineWidth:2,guideLineColor:X,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Z=Math.cos((0,h.g)(12)),ee=(0,m.x)(),te=(0,m.x)(),ie=(0,m.s)(),se=(0,m.s)(),re=(0,m.s)();let ae=class extends((0,o.m)(S.d)){constructor(e){super(e),this._userUnit=null,this.type="direct-line-measurement-3d",this.result=null}set unit(e){this._userUnit=e}get unit(){return(0,r.q)(this._userUnit,this._defaultUnit)}get viewMode(){return this._analysisView.viewMode}get visualizedMeasurement(){return this._analysisView.visualizedMeasurement}set visualizedMeasurement(e){this._analysisView.visualizedMeasurement=e}get actualVisualizedMeasurement(){return this._analysisView.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisView.visualElementOrientation}set visualElementOrientation(e){this._analysisView.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisView.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisView.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisView.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisView.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisView.labels.direct.text}get horizontalLabelText(){return this._analysisView.labels.horizontal.text}get verticalLabelText(){return this._analysisView.labels.vertical.text}get testData(){return this._analysisView.testData}initialize(){const e=this.view,t=this.layer;this._analysisView=new K({view:e,layer:t,layerView:this}),this._analysisController=new P({view:e,layer:t,viewData:this})}destroy(){(0,r.k)(this._analysisController),(0,r.k)(this._analysisView)}whenReady(){return this._analysisView.whenReady()}whenMessages(){return this._analysisView.whenMessages()}};(0,s.e)([(0,a.y)(n.j)],ae.prototype,"_defaultUnit",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"_userUnit",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"_analysisView",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"_analysisController",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"type",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"unit",null),(0,s.e)([(0,a.y)()],ae.prototype,"layer",void 0),(0,s.e)([(0,a.y)()],ae.prototype,"result",void 0),(0,s.e)([(0,a.y)({readOnly:!0})],ae.prototype,"viewMode",null),(0,s.e)([(0,a.y)()],ae.prototype,"visualizedMeasurement",null),(0,s.e)([(0,a.y)({readOnly:!0})],ae.prototype,"actualVisualizedMeasurement",null),(0,s.e)([(0,a.y)()],ae.prototype,"visualElementOrientation",null),(0,s.e)([(0,a.y)()],ae.prototype,"allowVisualElementsOrientationChange",null),(0,s.e)([(0,a.y)()],ae.prototype,"triangleCollapseRatioThreshold",null),(0,s.e)([(0,a.y)({readOnly:!0})],ae.prototype,"directLabelText",null),(0,s.e)([(0,a.y)({readOnly:!0})],ae.prototype,"horizontalLabelText",null),(0,s.e)([(0,a.y)({readOnly:!0})],ae.prototype,"verticalLabelText",null),(0,s.e)([(0,a.y)()],ae.prototype,"testData",null),ae=(0,s.e)([(0,a.n)("esri.views.3d.layers.DirectLineMeasurementLayerView3D")],ae);var ne=ae,oe=Object.freeze({__proto__:null,default:ne})}}]);