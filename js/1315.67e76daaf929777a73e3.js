(self.webpackChunk=self.webpackChunk||[]).push([[1315],{91315:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>M});var o=r(78155),i=r(80987),s=r(82906),n=(r(34396),r(94449)),p=r(79506),a=r(88903),l=r(80219),u=r(41290),d=r(20215),y=r(92858),c=r(44320),h=r(98420),f=r(51218),g=r(21793),v=r(13895),m=r(15576),S=r(28941),w=r(19438),b=r(15022),I=r(92758),x=r(71666),F=r(47365),D=r(72257),O=r(52957),C=r(78435),R=r(18143),T=r(99987),j=r(98548);r(20736),r(4169),r(31531),r(40130),r(29126),r(6585),r(3621),r(63358),r(62121),r(81135),r(94527),r(17762),r(60816),r(61888),r(29832),r(31516),r(52109),r(5250),r(49878),r(84271),r(48643),r(73574),r(89710),r(30316),r(4618),r(65352),r(80657),r(97325),r(3629),r(29831),r(16034),r(93028),r(16408),r(78730),r(67079),r(52737),r(91236),r(9612),r(76326),r(56416),r(53902),r(40481);const E="http://www.opengis.net/def/crs/OGC/1.3/CRS84";let P=class extends i.f{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getFeatureDefinition(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:r,supportedCrs:o},layer:{apiKey:i,capabilities:s,customParameters:n}}=this;return{capabilities:s,collection:e,layerDefinition:t,queryParameters:{apiKey:i,customParameters:n},spatialReference:r,supportedCrs:o}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){const r=this.getFeatureDefinition();return this.load(t).then((()=>(0,c.q)(r,e,t)))}queryFeaturesJSON(e,t={}){const r=this.getFeatureDefinition();return this.load(t).then((()=>(0,c.M)(r,e,t)))}queryObjectIds(e,t={}){return null}supportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator)||this.featureDefinition.supportedCrs.some((t=>{const r=(0,c.N)(t);return!(0,l.t)(r)&&(0,y.d)(r,e)}))}_conformsToType(e,t){var r;const o=new RegExp(`^${t}$`,"i");return null!=(r=e.conformsTo.some((e=>o.test(e))))&&r}_getCapabilities(e,t){var r,o,i,s,n,p,a;const u=(0,l.r)(t)?null==(r=t.components)?void 0:r.parameters:null;return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:null!=(o=null!=(i=null==u||null==(s=u.limit)||null==(n=s.schema)?void 0:n.maximum)?i:null==u||null==(p=u.limitFeatures)||null==(a=p.schema)?void 0:a.maximum)?o:5e3,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}_getExtent(e){var t;const r=null==(t=e.extent)?void 0:t.spatial;if(!r)return null;const o=r.bbox[0],i=4===o.length,s=o[0],n=o[1],p=i?void 0:o[2];return{xmin:s,ymin:n,xmax:i?o[2]:o[3],ymax:i?o[3]:o[4],zmin:p,zmax:i?void 0:o[5],spatialReference:y.k.WGS84.toJSON()}}_getSpatialReference(e){var t;const r=null!=(t=e.storageCrs)?t:E,o=(0,c.N)(r);return(0,l.t)(o)?y.k.WGS84:o}_getSupportedSpatialReferences(e,t){var r;const o="#/crs",i=null!=(r=e.crs)?r:[E],s=i.includes(o)?i.filter((e=>e!==o)).concat(t.crs):i,n=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return s.filter((e=>!n.test(e)))}async _loadOGCServices(e,t){const r=(0,l.r)(t)?t.signal:null,{apiKey:o,collectionId:s,customParameters:n,fields:p,geometryType:a,hasZ:u,objectIdField:y,timeInfo:h,url:f}=e,g={fields:null==p?void 0:p.map((e=>e.toJSON())),geometryType:i.t.toJSON(a),hasZ:u,objectIdField:y,timeInfo:null==h?void 0:h.toJSON()},v={apiKey:o,customParameters:n,signal:r},m=await(0,c.x)(f,v),[S,w]=await Promise.all([(0,c.S)(m,v),(0,c.k)(m,v)]);if(!this._conformsToType(S,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new d.s("ogc-feature-layer:no-geojson-support","Server does not support geojson");const b=w.collections.find((e=>e.id===s));if(!b)throw new d.s("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const I=this._conformsToType(S,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await(0,c.v)(m,v):null,x=await(0,c.T)(b,g,v),F=this._getCapabilities(x.hasZ,I),D=this._getExtent(b),O=this._getSpatialReference(b).toJSON(),C=this._getSupportedSpatialReferences(b,w);x.extent=D,this.featureDefinition={capabilities:F,collection:b,layerDefinition:x,queryParameters:{},spatialReference:O,supportedCrs:C}}};(0,o.e)([(0,a.y)()],P.prototype,"featureDefinition",void 0),(0,o.e)([(0,a.y)({constructOnly:!0})],P.prototype,"layer",void 0),(0,o.e)([(0,a.y)()],P.prototype,"type",void 0),P=(0,o.e)([(0,a.n)("esri.layers.graphics.sources.OGCFeatureSource")],P);var _=P;const G=(0,D.l)();let q=class extends((0,h.i)((0,g.e)((0,f.t)((0,b.c)((0,w.s)((0,v.l)((0,m.w)((0,S.o)((0,p.l)(u.b)))))))))){constructor(e){super(e),this.collectionId=null,this.copyright=null,this.definitionExpression=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new _({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){var e;null==(e=this.source)||e.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then((()=>this._fetchService(e)))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,O.c)(e,this.fieldsIndex),this._set("renderer",e)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,T.a)(this,e)}createQuery(){return new R.b}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r;let o,i=!1;const s=null==t||null==(r=t.feature)?void 0:r.attributes,n=this.typeIdField&&(null==s?void 0:s[this.typeIdField]);return null!=n&&this.types&&(i=this.types.some((t=>{var r,i;return t.id==n&&(o=null==(r=t.domains)?void 0:r[e],"inherited"===(null==(i=o)?void 0:i.type)&&(o=this._getLayerDomain(e)),!0)}))),i||o||(o=this._getLayerDomain(e)),o}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(R.b.from(e)||this.createQuery(),t))).then((e=>{var t;return null==e||null==(t=e.features)||t.forEach((e=>{e.layer=e.sourceLayer=this})),e}))}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),(0,O.c)(this.renderer,this.fieldsIndex),(0,O.m)(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};(0,o.e)([(0,a.y)({readOnly:!0,json:{origins:{service:{read:!0}}}})],q.prototype,"capabilities",void 0),(0,o.e)([(0,a.y)({type:String,json:{write:!0}})],q.prototype,"collectionId",void 0),(0,o.e)([(0,a.y)({type:String})],q.prototype,"copyright",void 0),(0,o.e)([(0,a.y)({readOnly:!0})],q.prototype,"defaultPopupTemplate",null),(0,o.e)([(0,a.y)({type:String})],q.prototype,"definitionExpression",void 0),(0,o.e)([(0,a.y)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"collection.description"}}}}})],q.prototype,"description",void 0),(0,o.e)([(0,a.y)({type:String})],q.prototype,"displayField",void 0),(0,o.e)([(0,a.y)({type:v.x})],q.prototype,"elevationInfo",void 0),(0,o.e)([(0,a.y)({types:{key:"type",base:I.p,typeMap:{selection:I.c,cluster:I.b}}})],q.prototype,"featureReduction",void 0),(0,o.e)([(0,a.y)({type:[F.y],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],q.prototype,"fields",void 0),(0,o.e)([(0,a.y)(G.fieldsIndex)],q.prototype,"fieldsIndex",void 0),(0,o.e)([(0,a.y)({readOnly:!0,type:j.M,json:{origins:{service:{read:{source:"layerDefinition.extent"}}}}})],q.prototype,"fullExtent",void 0),(0,o.e)([(0,a.y)({type:i.i.apiValues,json:{origins:{service:{read:{source:"layerDefinition.geometryType",reader:i.i.read}}}}})],q.prototype,"geometryType",void 0),(0,o.e)([(0,a.y)({type:Boolean,json:{origins:{service:{read:{source:"layerDefinition.hasZ"}}}}})],q.prototype,"hasZ",void 0),(0,o.e)([(0,a.y)({type:[C.E],json:{origins:{"web-map":{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:I.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}}}})],q.prototype,"labelingInfo",void 0),(0,o.e)([(0,a.y)(v.a)],q.prototype,"labelsVisible",void 0),(0,o.e)([(0,a.y)(v.f)],q.prototype,"legendEnabled",void 0),(0,o.e)([(0,a.y)({type:String,json:{origins:{service:{read:{source:"layerDefinition.objectIdField"}}}}})],q.prototype,"objectIdField",void 0),(0,o.e)([(0,a.y)({type:["OGCFeatureLayer"]})],q.prototype,"operationalLayerType",void 0),(0,o.e)([(0,a.y)(v.s)],q.prototype,"popupEnabled",void 0),(0,o.e)([(0,a.y)({type:s.M,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],q.prototype,"popupTemplate",void 0),(0,o.e)([(0,a.y)({types:n.a,json:{origins:{service:{read:{source:"layerDefinition.drawingInfo.renderer"},write:!1}},read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],q.prototype,"renderer",null),(0,o.e)([(0,a.y)({type:Boolean})],q.prototype,"screenSizePerspectiveEnabled",void 0),(0,o.e)([(0,a.y)({readOnly:!0})],q.prototype,"source",void 0),(0,o.e)([(0,a.y)({readOnly:!0,type:y.k,json:{origins:{service:{read:!0}}}})],q.prototype,"spatialReference",void 0),(0,o.e)([(0,a.y)({type:String,json:{origins:{service:{read:{source:"collection.title"}},"web-map":{write:{ignoreOrigin:!0}}}}})],q.prototype,"title",void 0),(0,o.e)([(0,a.y)({readOnly:!0,json:{read:!1}})],q.prototype,"type",void 0),(0,o.e)([(0,a.y)({type:String,readOnly:!0})],q.prototype,"typeIdField",void 0),(0,o.e)([(0,a.y)({type:[x.d]})],q.prototype,"types",void 0),(0,o.e)([(0,a.y)({type:String,json:{write:!0}})],q.prototype,"url",void 0),q=(0,o.e)([(0,a.n)("esri.layers.OGCFeatureLayer")],q);const M=q}}]);