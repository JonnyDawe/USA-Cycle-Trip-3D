(self.webpackChunk=self.webpackChunk||[]).push([[1617],{71391:(e,t,i)=>{"use strict";i.d(t,{$:()=>un,A:()=>wr,B:()=>Y,C:()=>rs,D:()=>ss,E:()=>mo,F:()=>Pr,G:()=>vr,H:()=>ln,I:()=>gn,J:()=>er,K:()=>mn,L:()=>pn,M:()=>In,N:()=>Rr,O:()=>Mn,P:()=>js,Q:()=>yn,R:()=>Fn,S:()=>Ir,T:()=>Ur,U:()=>dn,V:()=>Cn,W:()=>Or,X:()=>Ds,Y:()=>Ps,Z:()=>ir,_:()=>an,a:()=>On,a0:()=>Tr,a1:()=>Ar,a2:()=>Ii,a3:()=>Ks,a4:()=>J,a5:()=>or,a6:()=>nr,a7:()=>_r,a8:()=>mr,a9:()=>Cr,aa:()=>jn,ab:()=>pr,ac:()=>Nn,ad:()=>Ci,ae:()=>xi,af:()=>ee,ag:()=>re,ah:()=>ne,ai:()=>se,aj:()=>te,ak:()=>ie,al:()=>fn,am:()=>vn,an:()=>cn,ao:()=>hn,ap:()=>Er,b:()=>gr,c:()=>Vr,d:()=>Nr,e:()=>Br,f:()=>Hr,g:()=>Rn,h:()=>fr,i:()=>mi,j:()=>io,k:()=>Mr,l:()=>no,m:()=>Jr,n:()=>qs,o:()=>uo,p:()=>po,q:()=>so,r:()=>ro,s:()=>$r,t:()=>rr,u:()=>Sn,v:()=>wi,w:()=>yr,x:()=>to,y:()=>Mi,z:()=>sa}),i(33807);var n=i(78155),s=i(83731),r=i(36845),o=i(88903),a=i(80219),l=i(20215),d=i(55688),c=i(91236),h=i(40130),u=i(18559),p=i(80987),f=i(32769),m=i(82906),g=i(98548),y=i(82361),v=i(92858),_=i(71394),w=i(94527),b=i(13564),M=i(60816),I=i(95559),C=i(6585),x=i(20736),k=i(65352),P=i(73574),T=i(56803),A=i(91790),E=i(52957),F=i(63358),L=i(18143),D=i(3621),S=i(16040),O=i(81135),V=i(41290),R=i(11838),N=i(8725),z=i(4169),B=i(89710),H=i(24776),U=i(95186),$=i(67726),W=i(59312),j=i(732),G=i(9612);const q={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],n=t[1],s=this.values;return n>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},K={xsmall:544,small:768,medium:992,large:1200};function Z(e,t){return t?q[e].valueToClassName[t].split(" "):[]}const Y=e=>{let t=class extends e{constructor(...e){super(...e),this._breakpointsHandles=new s.u,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=K}initialize(){this._breakpointsHandles.add((0,r.d)(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(e){if(e===this._get("breakpoints"))return;const t=function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){const e=JSON.stringify(K,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}e=t?e:K,this._set("breakpoints",{...e})}_updateClassNames(){if(!this.container)return;const e=n.k.acquire(),t=n.k.acquire();let i,s=!1;for(i in q){const n=this[i],r=q[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==r&&(s=!0,this[i]=r,Z(i,n).forEach((e=>t.push(e))),Z(i,r).forEach((t=>e.push(t))))}s&&(this._applyClassNameChanges(e,t),n.k.release(e),n.k.release(t))}_applyClassNameChanges(e,t){const i=this.container;i&&(t.forEach((e=>i.classList.remove(e))),e.forEach((e=>i.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in q)Z(t,this[t]).forEach((t=>e.classList.remove(t)))}};return(0,n.e)([(0,o.y)()],t.prototype,"breakpoints",null),(0,n.e)([(0,o.y)()],t.prototype,"orientation",void 0),(0,n.e)([(0,o.y)()],t.prototype,"widthBreakpoint",void 0),(0,n.e)([(0,o.y)()],t.prototype,"heightBreakpoint",void 0),t=(0,n.e)([(0,o.n)("esri.views.BreakpointsOwner")],t),t};let X=class extends n.p{constructor(){super(...arguments),this.items=new h.L,this._watchUpdatingTracking=new f.l,this._callbacks=new Map,this._projector=(0,I.i)(),this._hiddenProjector=(0,I.i)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n=null;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const r={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const e=n.domNode.getBoundingClientRect();r.left=e.left,r.top=e.top,r.right=e.right,r.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return r}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};(0,n.e)([(0,o.y)({readOnly:!0})],X.prototype,"surface",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],X.prototype,"items",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],X.prototype,"needsRender",null),(0,n.e)([(0,o.y)({readOnly:!0})],X.prototype,"_watchUpdatingTracking",void 0),(0,n.e)([(0,o.y)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],X.prototype,"updating",void 0),X=(0,n.e)([(0,o.n)("esri.views.overlay.ViewOverlay")],X);var Q=X;function J(e,t,i,n){let s=null,r=1e3;"number"==typeof t?(r=t,n=i):(s=null!=t?t:null,r=i);let o,a=0;const l=()=>{a=0,e.apply(n,o)},d=(...e)=>{s&&s.apply(n,e),o=e,r?a||(a=setTimeout(l,r)):l()};return d.remove=()=>{a&&(clearTimeout(a),a=0)},d.forceUpdate=()=>{a&&(clearTimeout(a),l())},d.hasPendingUpdates=()=>!!a,d}function ee(e,t,i,n=2,s="abbr"){return`${(0,C.m)(t,{minimumFractionDigits:n,maximumFractionDigits:n})} ${function(e,t,i){return e.units[t][i]}(e,i,s)}`}function te(e,t,i,n=2,s="abbr"){const r=(0,k.E)(t,i);return ee(e,(0,k.I)(t,i,r),r,n,s)}function ie(e,t,i,n=2,s="abbr"){const r=(0,k.F)(t,i);return ee(e,(0,k.I)(t,i,r),r,n,s)}function ne(e,t,i,n=2,s="abbr"){const r=(0,k.N)(t,i);return ee(e,(0,k.I)(t,i,r),r,n,s)}function se(e,t,i,n=2,s="abbr"){const r=(0,k.O)(t,i);return ee(e,(0,k.I)(t,i,r),r,n,s)}function re(e,t,i=2){let n=(0,k.I)(e,t,"degrees"),s=n-Math.floor(n);n-=s,s*=60;let r=s-Math.floor(s);return s-=r,r*=60,`${n.toFixed()}Â° ${s.toFixed()}' ${r.toFixed(i)}"`}const oe=["B","kB","MB","GB","TB"],ae=a.n.getLogger("esri.widgets.Feature.support.featureUtils"),le=/href=(""|'')/gi,de=/(\{([^\{\r\n]+)\})/g,ce=/\'/g,he=/^\s*expression\//i,ue=/(\n)/gi,pe=/[\u00A0-\u9999<>\&]/gim,fe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,me=/^(?:mailto:|tel:)/,ge="relationships/",ye=(0,C.S)("short-date-short-time");function ve(e){if(!(0,a.t)(e))return e.get("sourceLayer")||e.get("layer")}async function _e(e,t){return"function"==typeof e?e.call(null,t):e}function we(e=""){if(e)return!me.test(e.trim().toLowerCase())}function be(e,t){const i=function(e,t){if(!function(e){return he.test(e)}(t)||!e)return null;const i=t.replace(he,"").toLowerCase();let n;return e.some((e=>e.name.toLowerCase()===i&&(n=e,!0))),n}(t,null==e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Me(e,t){const i=Ie(t,e);return i?i.name:e}function Ie(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function Ce(e){return`${e}`.trim()}function xe({attributes:e,globalAttributes:t,layer:i,text:n,expressionAttributes:s,fieldInfoMap:r}){return n?ke({formattedAttributes:t,template:Te(n,{...t,...s,...e},i),fieldInfoMap:r}):""}function ke({formattedAttributes:e,template:t,fieldInfoMap:i}){return Ce(function(e){return e.replace(le,"")}((0,a.b)((0,a.b)(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i))),e)))}function Pe(e,t){return e.replace(de,((e,i,n)=>{const s=Ie(t,n);return s?`{${s.name}}`:i}))}function Te(e,t,i){const n=Pe(e,i);return n?n.replace(fe,((e,i,n)=>function(e,t,i){const n=(t=Ce(t))&&"{"!==t[0];return(0,a.b)(e,function(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const n=t[e];if("string"==typeof n){const s="%27",r=(i?encodeURIComponent(n):n).replace(ce,s);t[e]=r}}(e,i,t))),i}(i,n))}(e,i||n,t))):n}function Ae(e,t){const i=t.fieldInfos,n=t.fieldName,s=Ee(i,n),r=null==s?void 0:s.clone(),o=t.preventPlacesFormatting,a=Ie(t.layer,n);if(r&&a&&"date"===a.type){const e=r.format||new m.l;e.dateFormat=e.dateFormat||"short-date-short-time",r.format=e}const l=r&&r.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?e:o?(0,C.m)(e,{...(0,C.u)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function Ee(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let n;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(n=e,0)))),n}function Fe(e){const t=[];if(!e)return t;const{fieldInfos:i,content:n}=e;return i&&t.push(...i),n&&Array.isArray(n)?(n.forEach((e=>{if("fields"===e.type){const i=e&&e.fieldInfos;i&&t.push(...i)}})),t):t}function Le(e){return e.replace(pe,(e=>`&#${e.charCodeAt(0)};`))}function De(e){return"string"==typeof e?e.replace(ue,'<br class="esri-text-new-line" />'):e}function Se({fieldInfos:e,attributes:t,layer:i,graphic:n,fieldInfoMap:s,relatedInfos:r}){const o={...t};return null==r||r.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((i=>Ve({attributes:e,graphic:i,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((i=>Ve({attributes:e,graphic:i,relatedInfo:t}))))}(o,e))),Object.keys(o).forEach((t=>{const r=o[t];o[t]=function(e){const{value:t,fieldName:i,fieldInfos:n,fieldInfoMap:s,layer:r,graphic:o}=e;if(null==t)return"";const a=function({fieldName:e,value:t,graphic:i,layer:n}){if(Oe(e))return null;if(!n||"function"!=typeof n.getFieldDomain)return null;const s=n.getFieldDomain(e,{feature:i});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:o,layer:r});if(a)return a;const l=function({fieldName:e,graphic:t,layer:i}){if(Oe(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:n}=i;if(!n||e!==n)return null;const s=i.getFeatureType(t);return s?s.name:null}({fieldName:i,graphic:o,layer:r});if(l)return l;if(s.get(i.toLowerCase()))return Ae(t,{fieldInfos:n,fieldName:i,layer:r});const d=r&&r.fieldsIndex;return d&&d.isDateField(i)?(0,C.L)(t,ye):De(t)}({fieldName:t,fieldInfos:e,fieldInfoMap:s,layer:i,value:r,graphic:n})})),o}function Oe(e=""){return!!e&&-1!==e.indexOf(ge)}function Ve({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach((n=>{const s=function(e){return e?`${ge}${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:n});e[s]=t.attributes[n]}))}const Re={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ne=h.L.ofType(T.l);let ze=class extends f.d{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Re},this.activeAttachmentInfo=null,this.attachmentInfos=new Ne,this.graphic=null,this.mode="view",this.handles.add([(0,r.d)(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Re,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new l.s("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),n=new A.u({objectIds:[i],returnMetadata:!0}),s=[],r=e.queryAttachments(n).then((e=>e[i]||s)).catch((()=>s));this._getAttachmentsPromise=r,this.notifyChange("state");const o=await r;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new l.s("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new l.s("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new l.s("invalid-layer","addAttachment(): A valid layer is required.");const r=t.addAttachment(n,e).then((e=>this._queryAttachment(e.objectId))),o=await r;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new l.s("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new l.s("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new l.s("invalid-layer","deleteAttachment(): A valid layer is required.");const r=t.deleteAttachments(n,[e.id]).then((()=>e)),o=await r;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:n,graphic:s,abilities:r}=this;if(!e)throw new l.s("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new l.s("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!r.operations.update)throw new l.s("invalid-abilities","updateAttachment(): Update abilities are required.");const o=n.findIndex((e=>e===t));if(!i||"function"!=typeof i.updateAttachment)throw new l.s("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),d=await a;return n.splice(o,1,d),d}async _queryAttachment(e){if(!e)throw new l.s("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),n=new A.u({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(n).then((e=>e[i][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:n}=t;return n&&n[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=ve(e);this._attachmentLayer=t?"scene"===t.type&&(0,a.r)(t.associatedLayer)?t.associatedLayer:t:null}};(0,n.e)([(0,o.y)()],ze.prototype,"abilities",void 0),(0,n.e)([(0,x.c)("abilities")],ze.prototype,"castAbilities",null),(0,n.e)([(0,o.y)()],ze.prototype,"activeAttachmentInfo",void 0),(0,n.e)([(0,o.y)({readOnly:!0,type:Ne})],ze.prototype,"attachmentInfos",void 0),(0,n.e)([(0,o.y)({type:P.h})],ze.prototype,"graphic",void 0),(0,n.e)([(0,o.y)()],ze.prototype,"mode",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],ze.prototype,"state",null),(0,n.e)([(0,o.y)({readOnly:!0})],ze.prototype,"supportsResizeAttachments",null),ze=(0,n.e)([(0,o.n)("esri.widgets.Attachments.AttachmentsViewModel")],ze);var Be=ze;const He={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Ue="esri-attachments__item-button",$e="esri-attachments__form-node",We="esri-attachments__file-fieldset",je="esri-attachments__file-label",Ge="esri-attachments__file-name",qe="esri-attachments__file-input",Ke="esri-attachments__metadata-fieldset",Ze="esri-button",Ye="esri-button--disabled",Xe="esri-button--secondary",Qe="esri-button--tertiary",Je="esri-button--third",et="esri-button--small",tt="esri-button--half",it=window.CSS;let nt=class extends I.x{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Be,this.visibleElements={...He},this._supportsImageOrientation=it&&it.supports&&it.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own((0,r.C)(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),(0,r.d)(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return{...He,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new l.s("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new l.s("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new l.s("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return(0,I.n)("div",{class:this.classes("esri-attachments","esri-widget")},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?(0,I.n)("div",{key:"error-message",class:"esri-attachments__error-message"},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return(0,I.n)("div",{class:"esri-attachments__loader-container",key:"loader"},(0,I.n)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?(0,I.n)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,n=this.visibleElements.cancelAddButton?(0,I.n)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ze,Qe,et,tt,e&&Ye)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?(0,I.n)("button",{type:"submit",disabled:i,class:this.classes(Ze,Xe,et,tt,{[Ye]:i})},this.messages.add):null,r=t?(0,I.n)("span",{key:"file-name",class:Ge},t.name):null,o=(0,I.n)("form",{bind:this,afterCreate:I.p,afterRemoved:I.u,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,I.n)("fieldset",{class:We},r,(0,I.n)("label",{class:this.classes(je,Ze,Xe)},t?this.messages.changeFile:this.messages.selectFile,(0,I.n)("input",{class:qe,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,n);return(0,I.n)("div",{key:"add-form-container",class:$e},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:n,submitting:s}=this,{contentType:r,size:o,url:l}=e,{abilities:d}=i,c=s||!n,h=d.editing&&d.operations.delete&&t.deleteButton?(0,I.n)("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(Ze,et,Qe,"esri-attachments__delete-button",{[Ye]:s})},this.messages.delete):null,u=d.editing&&d.operations.update&&t.updateButton?(0,I.n)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(Ze,et,Je,{[Ye]:c})},this.messages.update):null,p=this.visibleElements.cancelUpdateButton?(0,I.n)("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ze,et,Qe,Je,{[Ye]:s})},this.messages.cancel):null,f=n?(0,I.n)("span",{key:"file-name",class:Ge},n.name):null,m=d.editing&&d.operations.update?(0,I.n)("fieldset",{key:"file",class:We},f,(0,I.n)("label",{class:this.classes(je,Ze,Xe)},this.messages.changeFile,(0,I.n)("input",{class:qe,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,g=(0,I.n)("fieldset",{key:"size",class:Ke},(0,I.n)("label",null,function(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(1024));i=(0,M.o)(i,0,oe.length-1);const n=(0,C.m)(t/1024**i,{maximumFractionDigits:2});return(0,a.b)(e.units.bytes[oe[i]],{fileSize:n})}(this.messagesUnits,o))),y=(0,I.n)("fieldset",{key:"content-type",class:Ke},(0,I.n)("label",null,r)),v=(0,I.n)("form",{bind:this,afterCreate:I.p,afterRemoved:I.u,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},(0,I.n)("div",{class:"esri-attachments__metadata"},g,y),m,(0,I.n)("div",{class:"esri-attachments__actions"},h,p,u));return(0,I.n)("div",{key:"edit-form-container",class:$e},(0,I.n)("a",{class:"esri-attachments__item-link",href:l,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),(0,I.n)("div",{class:"esri-attachments__item-link-overlay"},(0,I.n)("span",{class:"esri-attachments__item-link-overlay-icon"},(0,I.n)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(0,I.n)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),(0,I.n)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),v)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:n,name:s,url:r}=e,o=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(n),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},d=-1===r.indexOf("?")?"?":"&",c=o?`${r}${d}w=${t}`:function(e){const t=(0,F.a)("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:-1!==e.indexOf("image/")?`${t}image-32.svg`:-1!==e.indexOf("audio/")?`${t}sound-32.svg`:-1!==e.indexOf("video/")?`${t}video-32.svg`:-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?`${t}excel-32.svg`:-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?`${t}word-32.svg`:-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(n),h={"esri-attachments__item-mask--icon":!o},u={"esri-attachments__image--resizable":i};return(0,I.n)("div",{class:this.classes(h,"esri-attachments__item-mask")},(0,I.n)("img",{styles:l,alt:s,src:c,class:this.classes(u,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:n}=i,{name:s,url:r}=e,o=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),a=n.editing?(0,I.n)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",(0,I.d)()?"esri-icon-left":"esri-icon-right")}):null,l=[o,(0,I.n)("label",{class:"esri-attachments__label"},(0,I.n)("span",{class:"esri-attachments__filename"},s||this.messages.noTitle),a)],d=n.editing?(0,I.n)("button",{key:"details-button",bind:this,class:Ue,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):(0,I.n)("a",{key:"details-link",class:Ue,href:r,target:"_blank"},l);return(0,I.n)("li",{class:"esri-attachments__item",key:e},d)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:n,abilities:s}=t,r=n&&n.length,o={"esri-attachments__container--list":"preview"!==e,"esri-attachments__container--preview":"preview"===e},a=s.editing&&s.operations.add&&i.addButton?(0,I.n)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ze,Qe,"esri-attachments__add-attachment-button"),type:"button"},(0,I.n)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=r?(0,I.n)("ul",{class:"esri-attachments__items"},n.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):(0,I.n)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return(0,I.n)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};(0,n.e)([(0,m.o)("viewModel.abilities")],nt.prototype,"abilities",void 0),(0,n.e)([(0,o.y)()],nt.prototype,"displayType",void 0),(0,n.e)([(0,m.o)("viewModel.graphic")],nt.prototype,"graphic",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],nt.prototype,"label",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Attachments/t9n/Attachments")],nt.prototype,"messages",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/core/t9n/Units")],nt.prototype,"messagesUnits",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],nt.prototype,"selectedFile",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],nt.prototype,"submitting",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],nt.prototype,"error",void 0),(0,n.e)([(0,o.y)({type:Be})],nt.prototype,"viewModel",void 0),(0,n.e)([(0,o.y)()],nt.prototype,"visibleElements",void 0),(0,n.e)([(0,x.c)("visibleElements")],nt.prototype,"castVisibleElements",null),nt=(0,n.e)([(0,o.n)("esri.widgets.Attachments")],nt);var st=nt;let rt=class extends Be{constructor(e){super(e),this.description=null,this.title=null}};(0,n.e)([(0,o.y)()],rt.prototype,"description",void 0),(0,n.e)([(0,o.y)()],rt.prototype,"title",void 0),rt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],rt);var ot=rt;function at(e,t){const i=`h${(0,M.o)(Math.ceil(e.level),1,6)}`;return delete e.level,(0,I.n)(i,{...e,class:(0,I.l)("esri-widget__heading",e.class)},t)}let lt=class extends I.x{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,I.n)("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?(0,I.n)(at,{level:this.headingLevel,class:"esri-feature-element-info__title"},e):null}renderDescription(){const{description:e}=this;return e?(0,I.n)("div",{key:"description",class:"esri-feature-element-info__description"},e):null}};(0,n.e)([(0,o.y)()],lt.prototype,"description",void 0),(0,n.e)([(0,o.y)()],lt.prototype,"headingLevel",void 0),(0,n.e)([(0,o.y)()],lt.prototype,"title",void 0),lt=(0,n.e)([(0,o.n)("esri.widgets.Feature.support.FeatureElementInfo")],lt);var dt=lt;let ct=class extends I.x{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new st,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new ot}initialize(){this._featureElementInfo=new dt,(0,r.d)(this,["viewModel.description","viewModel.title","headingLevel"],(()=>this._setupFeatureElementInfo())),(0,r.d)(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return(0,I.n)("div",{class:"esri-feature-attachments"},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};(0,n.e)([(0,o.y)({readOnly:!0})],ct.prototype,"attachmentsWidget",void 0),(0,n.e)([(0,m.o)("viewModel.description")],ct.prototype,"description",void 0),(0,n.e)([(0,m.o)("attachmentsWidget.displayType")],ct.prototype,"displayType",void 0),(0,n.e)([(0,m.o)("viewModel.graphic")],ct.prototype,"graphic",void 0),(0,n.e)([(0,o.y)()],ct.prototype,"headingLevel",void 0),(0,n.e)([(0,m.o)("viewModel.title")],ct.prototype,"title",void 0),(0,n.e)([(0,o.y)({type:ot})],ct.prototype,"viewModel",void 0),ct=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureAttachments")],ct);var ht=ct;let ut=class extends((0,f.a)(n.p)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add((0,r.d)(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(_e(i,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=_e(e,{graphic:t}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const n=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};(0,n.e)([(0,o.y)({readOnly:!0})],ut.prototype,"created",void 0),(0,n.e)([(0,o.y)()],ut.prototype,"creator",void 0),(0,n.e)([(0,o.y)()],ut.prototype,"destroyer",void 0),(0,n.e)([(0,o.y)({type:P.h})],ut.prototype,"graphic",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],ut.prototype,"state",null),ut=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ut);var pt=ut;function ft(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:mt(e[t])}}}function mt(e){return function(t,...i){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...i):(0,I.w)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}let gt=class extends I.x{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{we(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return(0,I.n)("div",{class:"esri-feature-content__loader-container",key:"loader"},(0,I.n)("div",{class:"esri-feature-content__loader"}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?(0,I.n)("div",{key:t,bind:t,afterCreate:this._attachToNode}):(0,I.a)(t)?(0,I.n)("div",{key:t},!t.destroyed&&t.render()):(0,I.n)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return(0,I.n)("div",{class:"esri-feature-content"},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};(0,n.e)([(0,m.o)("viewModel.creator")],gt.prototype,"creator",void 0),(0,n.e)([(0,m.o)("viewModel.graphic")],gt.prototype,"graphic",void 0),(0,n.e)([(0,o.y)({type:pt})],gt.prototype,"viewModel",void 0),gt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureContent")],gt);var yt=gt;let vt=class extends n.p{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const n=t.clone();n.label=be(n,e),i.push(n)})),i}};(0,n.e)([(0,o.y)()],vt.prototype,"attributes",void 0),(0,n.e)([(0,o.y)({type:[m.i]})],vt.prototype,"expressionInfos",void 0),(0,n.e)([(0,o.y)()],vt.prototype,"description",void 0),(0,n.e)([(0,o.y)({type:[m.a]})],vt.prototype,"fieldInfos",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],vt.prototype,"formattedFieldInfos",null),(0,n.e)([(0,o.y)()],vt.prototype,"title",void 0),vt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],vt);var _t=vt;const wt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let bt=class extends I.x{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new _t,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new dt,(0,r.d)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,n=e.fieldName,s=e.label||n,r=i?null==i[n]?"":i[n]:"",o=!(!e.format||!e.format.dateFormat),l="number"!=typeof r||o?function(e,t){if("string"!=typeof t||!t)return t;const i=function(e){let t=null;return wt.some((i=>(i.pattern.test(e)&&(t=i),!!t))),t}(t);if(!i)return t;const n=t.match(i.pattern),s=n&&n[2],r=(0,a.b)((0,a.b)(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",l="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${l}>${r}</a>`)}(this.messagesURIUtils,r):this._forceLTR(r),d={"esri-feature-fields__field-data--date":o};return(0,I.n)("tr",{key:`fields-element-info-row-${n}-${t}`},(0,I.n)("th",{key:`fields-element-info-row-header-${n}-${t}`,class:"esri-feature-fields__field-header",innerHTML:s}),(0,I.n)("td",{key:`fields-element-info-row-data-${n}-${t}`,class:this.classes("esri-feature-fields__field-data",d),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?(0,I.n)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},(0,I.n)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return(0,I.n)("div",{class:"esri-feature-fields"},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};(0,n.e)([(0,m.o)("viewModel.attributes")],bt.prototype,"attributes",void 0),(0,n.e)([(0,m.o)("viewModel.description")],bt.prototype,"description",void 0),(0,n.e)([(0,m.o)("viewModel.expressionInfos")],bt.prototype,"expressionInfos",void 0),(0,n.e)([(0,m.o)("viewModel.fieldInfos")],bt.prototype,"fieldInfos",void 0),(0,n.e)([(0,m.o)("viewModel.title")],bt.prototype,"title",void 0),(0,n.e)([(0,o.y)({type:_t})],bt.prototype,"viewModel",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Feature/t9n/Feature")],bt.prototype,"messages",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/support/t9n/uriUtils")],bt.prototype,"messagesURIUtils",void 0),bt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureFields")],bt);var Mt=bt;const It=a.n.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Ct=new Map;function xt(e){if(!Oe(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}let kt=class extends n.p{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:n,fieldInfoMap:s,layer:r}=this;return null==t?void 0:t.map((t=>{if(!t)return null;if(t.title=xe({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:n,layer:r,text:t.title}),t.caption=xe({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:n,layer:r,text:t.caption}),t.altText=xe({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:n,layer:r,text:t.altText}),"image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:i,layer:r}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:n}=t;return this._setChartValue({value:n,chartType:t.type,attributes:e,formattedAttributes:i,layer:r}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:n,layer:s}=e,{linkURL:r,sourceURL:o}=i;if(o){const e=Pe(o,s);i.sourceURL=ke({formattedAttributes:n,template:e,fieldInfoMap:t})}if(r){const e=Pe(r,s);i.linkURL=ke({formattedAttributes:n,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:n,chartType:s,layer:r}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:d}=t;if(t.fields=function(e,t){return e&&e.map((e=>Me(e,t)))}(l,r),d&&(t.normalizeField=Me(d,r)),!l.some((e=>!!(null!=n[e]||Oe(e)&&a.size))))return;const c=null==o?void 0:o.fieldInfos;l.forEach((e=>{if(Oe(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:c,fieldName:e,formattedAttributes:n,chartType:s,value:t})]);const r=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:n,fieldName:e,fieldInfos:c});t.series.push(r)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:n,formattedAttributes:s,chartType:r,value:o}=e,a=[],l=xt(n),{layerId:d,fieldName:c}=l,h=null==(t=this.relatedInfos)?void 0:t.get(d.toString());if(!h)return a;const{relatedFeatures:u,relation:p}=h;if(!p||!u)return a;const{cardinality:f}=p;return u.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===c&&a.push(this._getChartOption({value:o,attributes:t,formattedAttributes:s,fieldName:n,chartType:r,relatedFieldName:e,fieldInfos:i}))}))})),"one-to-many"===f||"many-to-many"===f?a:[a[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:n,formattedAttributes:s,fieldName:r,relatedFieldName:o,fieldInfos:a,chartType:l}=e,{layer:d}=this,{normalizeField:c,tooltipField:h}=i,u=c?Oe(c)?n[xt(c).fieldName]:n[c]:null,p=o&&void 0!==n[o]?n[o]:void 0!==n[r]?n[r]:s[r],f=void 0===p?null:p&&u?p/u:p,g=new m.d({value:f});if(Oe(r)){const e=xt(r),t=xt(h),i=t?t.fieldName:null,s=Ae(f,{fieldInfos:a,fieldName:o,layer:d,preventPlacesFormatting:!!u}),c=e?e.label||e.fieldName:o,p=i&&void 0!==n[i]?n[i]:c;return g.tooltip=this._getTooltip({label:p,value:s,chartType:l}),g}const y=Ee(a,r),v=Me(r,d),_=h&&void 0!==s[h]?s[h]:be(y||new m.a({fieldName:v}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),w=s[v];return g.tooltip=this._getTooltip({label:_,value:w,chartType:l}),g}};(0,n.e)([(0,o.y)()],kt.prototype,"activeMediaInfoIndex",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],kt.prototype,"activeMediaInfo",null),(0,n.e)([(0,o.y)()],kt.prototype,"attributes",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"description",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"fieldInfoMap",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"formattedAttributes",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"expressionAttributes",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],kt.prototype,"formattedMediaInfos",null),(0,n.e)([(0,o.y)()],kt.prototype,"layer",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],kt.prototype,"formattedMediaInfoCount",null),(0,n.e)([(0,o.y)()],kt.prototype,"mediaInfos",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"popupTemplate",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"relatedInfos",void 0),(0,n.e)([(0,o.y)()],kt.prototype,"title",void 0),kt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],kt);var Pt=kt,Tt=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],At=[{name:"default",colors:[].concat(Tt.slice(30,39),Tt.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Et="en-us",Ft=new Map([["ar",()=>Promise.all([i.e(9351),i.e(5018)]).then(i.bind(i,15018)).then((function(e){return e.a}))],["bs-ba",()=>Promise.all([i.e(9351),i.e(2984)]).then(i.bind(i,92984)).then((function(e){return e.b}))],["ca-es",()=>Promise.all([i.e(9351),i.e(3778)]).then(i.bind(i,93778)).then((function(e){return e.c}))],["cs-cz",()=>Promise.all([i.e(9351),i.e(275)]).then(i.bind(i,10275)).then((function(e){return e.c}))],["da-dk",()=>Promise.all([i.e(9351),i.e(9309)]).then(i.bind(i,9309)).then((function(e){return e.d}))],["de-de",()=>Promise.all([i.e(9351),i.e(3722)]).then(i.bind(i,63722)).then((function(e){return e.d}))],["de-ch",()=>Promise.all([i.e(9351),i.e(6369)]).then(i.bind(i,96369)).then((function(e){return e.d}))],["el-gr",()=>Promise.all([i.e(9351),i.e(5048)]).then(i.bind(i,15048)).then((function(e){return e.e}))],["en-us",()=>Promise.all([i.e(9351),i.e(5101)]).then(i.bind(i,5101)).then((function(e){return e.e}))],["en-ca",()=>Promise.all([i.e(9351),i.e(5106)]).then(i.bind(i,35106)).then((function(e){return e.e}))],["es-es",()=>Promise.all([i.e(9351),i.e(5141)]).then(i.bind(i,45141)).then((function(e){return e.e}))],["et-ee",()=>Promise.all([i.e(9351),i.e(3740)]).then(i.bind(i,83740)).then((function(e){return e.e}))],["fi-fi",()=>Promise.all([i.e(9351),i.e(7812)]).then(i.bind(i,77812)).then((function(e){return e.f}))],["fr-fr",()=>Promise.all([i.e(9351),i.e(7169)]).then(i.bind(i,17169)).then((function(e){return e.f}))],["he-il",()=>Promise.all([i.e(9351),i.e(6360)]).then(i.bind(i,96360)).then((function(e){return e.h}))],["hr-hr",()=>Promise.all([i.e(9351),i.e(8579)]).then(i.bind(i,88579)).then((function(e){return e.h}))],["hu-hu",()=>Promise.all([i.e(9351),i.e(1625)]).then(i.bind(i,91625)).then((function(e){return e.h}))],["id-id",()=>Promise.all([i.e(9351),i.e(7913)]).then(i.bind(i,57913)).then((function(e){return e.i}))],["it-it",()=>Promise.all([i.e(9351),i.e(3890)]).then(i.bind(i,53890)).then((function(e){return e.i}))],["ja-jp",()=>Promise.all([i.e(9351),i.e(7952)]).then(i.bind(i,17952)).then((function(e){return e.j}))],["ko-kr",()=>Promise.all([i.e(9351),i.e(2005)]).then(i.bind(i,52005)).then((function(e){return e.k}))],["lt-lt",()=>Promise.all([i.e(9351),i.e(7986)]).then(i.bind(i,47986)).then((function(e){return e.l}))],["lv-lv",()=>Promise.all([i.e(9351),i.e(9030)]).then(i.bind(i,39030)).then((function(e){return e.l}))],["nb-no",()=>Promise.all([i.e(9351),i.e(5531)]).then(i.bind(i,45531)).then((function(e){return e.n}))],["nl-nl",()=>Promise.all([i.e(9351),i.e(3827)]).then(i.bind(i,43827)).then((function(e){return e.n}))],["pl-pl",()=>Promise.all([i.e(9351),i.e(2361)]).then(i.bind(i,22361)).then((function(e){return e.p}))],["pt-br",()=>Promise.all([i.e(9351),i.e(2342)]).then(i.bind(i,62342)).then((function(e){return e.p}))],["pt-pt",()=>Promise.all([i.e(9351),i.e(9596)]).then(i.bind(i,89596)).then((function(e){return e.p}))],["ro-ro",()=>Promise.all([i.e(9351),i.e(638)]).then(i.bind(i,80638)).then((function(e){return e.r}))],["ru-ru",()=>Promise.all([i.e(9351),i.e(851)]).then(i.bind(i,80851)).then((function(e){return e.r}))],["sk-sk",()=>Promise.all([i.e(9351),i.e(5857)]).then(i.bind(i,65857)).then((function(e){return e.s}))],["sl-sl",()=>Promise.all([i.e(9351),i.e(6740)]).then(i.bind(i,86740)).then((function(e){return e.s}))],["sr-rs",()=>Promise.all([i.e(9351),i.e(6306)]).then(i.bind(i,86306)).then((function(e){return e.s}))],["sv-se",()=>Promise.all([i.e(9351),i.e(7728)]).then(i.bind(i,27728)).then((function(e){return e.s}))],["th-th",()=>Promise.all([i.e(9351),i.e(573)]).then(i.bind(i,45833)).then((function(e){return e.t}))],["tr-tr",()=>Promise.all([i.e(9351),i.e(3984)]).then(i.bind(i,73984)).then((function(e){return e.t}))],["uk-ua",()=>Promise.all([i.e(9351),i.e(8092)]).then(i.bind(i,68092)).then((function(e){return e.u}))],["vi-vn",()=>Promise.all([i.e(9351),i.e(758)]).then(i.bind(i,10758)).then((function(e){return e.v}))],["zh-cn",()=>Promise.all([i.e(9351),i.e(1806)]).then(i.bind(i,1806)).then((function(e){return e.z}))],["zh-hk",()=>Promise.all([i.e(9351),i.e(7310)]).then(i.bind(i,67310)).then((function(e){return e.z}))],["zh-tw",()=>Promise.all([i.e(9351),i.e(7310)]).then(i.bind(i,67310)).then((function(e){return e.z}))]]);let Lt,Dt;const St="esri-feature-media__button",Ot="esri-feature-media__icon",Vt="esri-icon-left-triangle-arrow",Rt="esri-icon-right-triangle-arrow",Nt=.05,zt=.95;let Bt=class extends I.x{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Pt,this.messages=null}initialize(){this._featureElementInfo=new dt,this.own((0,r.d)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),(0,r.d)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return(0,I.n)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?(0,I.n)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:r,altText:o,title:a,type:l}=e,{sourceURL:d,linkURL:c}=s,h=we(c)?"_blank":"_self",u="_blank"===h?"noreferrer":"",p=r?t:null,f=p?p.timestamp:0,m=p?p.sourceURL:d,g=(0,I.n)("img",{alt:o||a,key:`media-${l}-${i}-${n}-${f}`,src:m});return(c?(0,I.n)("a",{title:a,href:c,rel:u,target:h},g):null)||g}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return(0,I.n)("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?(0,I.n)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:e.title}):null,i=e.caption?(0,I.n)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:e.caption}):null;return(0,I.n)("div",{key:"media-container",class:"esri-feature-media__item-container"},(0,I.n)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,n=t?this.classes(St,"esri-feature-media__previous"):this.classes(St,"esri-feature-media__next"),s=t?this.classes(Ot,"esri-feature-media__previous-icon",Vt):this.classes(Ot,"esri-feature-media__next-icon",Rt),r=t?this.classes(Ot,"esri-feature-media__previous-icon--rtl",Rt):this.classes(Ot,"esri-feature-media__next-icon--rtl",Vt),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return(0,I.n)("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:n,bind:this,onclick:a},(0,I.n)("span",{"aria-hidden":"true",class:s}),(0,I.n)("span",{"aria-hidden":"true",class:r}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=(0,D.i)()){if(e=function(e){return e?Ft.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const e of Ft.keys())if(e.startsWith(t)){i=e;break}return i}(e)||Et:Et}(e),Lt&&e===Dt)return Lt;Lt=Promise.all([i.e(247),i.e(9351)]).then(i.bind(i,89617)).then((function(e){return e.i})),Dt=e;try{const[t,i]=await Promise.all([Lt,Ft.get(Dt)()]);Dt===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Lt=null,Dt=null,null}return Lt}(),{activeMediaInfo:n}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:n,chartsModule:t})}_handleMediaKeyup(e){const t=(0,l.i)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:i,mediaInfo:n}=e,{value:s,type:r}=n,{am4core:o}=t,a=function(e,t="default"){const i=At.find((e=>e.name===t));return i?i.colors.map((t=>e.color(t))):null}(o);(0,I.b)()&&o.useTheme(t.am4themes_dark),o.useTheme(t.am4themes_animated),o.useTheme((function(e){e instanceof o.ColorSet&&a&&(e.list=a)}));const l="pie-chart"===r?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",n.altText||n.title),l.data=s.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==r||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:n,am4charts:s}=i,r=n.create(t,s.PieChart);r.rtl=(0,I.d)();const o=r.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,n),r}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:r,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),d=l.renderer.labels.template;l.renderer.minLabelPosition=Nt,l.renderer.maxLabelPosition=zt,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,r),d.wrap=!0;const c=e.series.push(new o.ColumnSeries);c.dataFields.valueY="value",c.dataFields.categoryX="tooltip",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarX=new r.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:r,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=e.xAxes.push(new o.ValueAxis),d=l.renderer.labels.template;l.renderer.minLabelPosition=Nt,l.renderer.maxLabelPosition=zt,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,r),d.wrap=!0;const c=e.series.push(new o.ColumnSeries);c.dataFields.valueX="value",c.dataFields.categoryY="tooltip",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarY=new r.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:r,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),d=l.renderer.labels.template;l.renderer.minLabelPosition=Nt,l.renderer.maxLabelPosition=zt,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,r),d.wrap=!0;const c=e.series.push(new o.LineSeries);c.dataFields.categoryX="tooltip",c.dataFields.valueY="value",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarX=new r.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:n}=e,{type:s}=n,{am4core:r,am4charts:o}=i,a=r.create(t,o.XYChart);return a.rtl=(0,I.d)(),"column-chart"===s&&this._createColumnChart(a,e),"bar-chart"===s&&this._createBarChart(a,e),"line-chart"===s&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const n=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),n);this._refreshTimer=s}_getImageSource(e,t){const i=-1!==e.indexOf("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${i}timestamp=${t}${s?"#":""}${s}`}};(0,n.e)([(0,m.o)("viewModel.attributes")],Bt.prototype,"attributes",void 0),(0,n.e)([(0,m.o)("viewModel.activeMediaInfoIndex")],Bt.prototype,"activeMediaInfoIndex",void 0),(0,n.e)([(0,m.o)("viewModel.description")],Bt.prototype,"description",void 0),(0,n.e)([(0,m.o)("viewModel.fieldInfoMap")],Bt.prototype,"fieldInfoMap",void 0),(0,n.e)([(0,m.o)("viewModel.layer")],Bt.prototype,"layer",void 0),(0,n.e)([(0,m.o)("viewModel.mediaInfos")],Bt.prototype,"mediaInfos",void 0),(0,n.e)([(0,m.o)("viewModel.popupTemplate")],Bt.prototype,"popupTemplate",void 0),(0,n.e)([(0,m.o)("viewModel.relatedInfos")],Bt.prototype,"relatedInfos",void 0),(0,n.e)([(0,m.o)("viewModel.title")],Bt.prototype,"title",void 0),(0,n.e)([(0,o.y)({type:Pt})],Bt.prototype,"viewModel",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Feature/t9n/Feature")],Bt.prototype,"messages",void 0),Bt=(0,n.e)([(0,o.n)("esri.widgets.Feature.FeatureMedia")],Bt);var Ht=Bt;const Ut=["$datastore","$map","$layer","$aggregatedfeatures"],$t=a.n.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function Wt({graphic:e,view:t}){const{isAggregate:i,layer:n}=e;if(!i||!n||"2d"!==(null==t?void 0:t.type))return[];const s=await t.whenLayerView(n);if(!s.createQuery||!s.queryFeatures)return[];const r=s.createQuery();r.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(r);return o}async function jt({expressionAttributes:e,info:t,arcadeUtils:i,spatialReference:n,map:s,graphic:r,view:o}){const a=`expression/${t.name}`,l=i.createSyntaxTree(t.expression),d=Ut.filter((e=>i.hasVariable(l,e)));await i.loadScriptDependencies(l,!0,d);const c=i.getViewInfo({spatialReference:n}),h=i.createExecContext(r,c);h.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:n,viewInfo:s,map:r,graphic:o}){i.forEach((i=>{const a=i.toLowerCase(),l={map:r,spatialReference:s.sr};if("$map"===a&&(n.vars[a]=t.convertMapToFeatureSetCollection(l)),"$layer"===a&&(n.vars[a]=t.convertFeatureLayerToFeatureSet(o.sourceLayer,s.sr)),"$datastore"===a&&(n.vars[a]=t.convertServiceUrlToWorkspace(o.sourceLayer.url,s.sr)),"$aggregatedfeatures"===a){const i=o.layer,{fields:r,objectIdField:l,geometryType:d,spatialReference:c,displayField:h}=i,u=new S.W({fields:r,objectIdField:l,geometryType:d,spatialReference:c,displayField:h,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:e});n.vars[a]=t.convertFeatureLayerToFeatureSet(u,s.sr)}}))}({aggregatedFeatures:await Wt({graphic:r,view:o}),arcadeUtils:i,featureSetVars:d,context:h,viewInfo:c,map:s,graphic:r});const u=i.createFunction(l,h),p=await i.executeAsyncFunction(u,h).catch((e=>$t.error("arcade-execution-error",{error:e,graphic:r,expressionInfo:t})));e[a]="string"==typeof p?De(Le(p)):Array.isArray(p)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?De(Le(e)):e}</li>`)).join("")}</ul>`}(p):p&&"esri.arcade.Dictionary"===p.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?De(Le(i)):i}</td></tr>`})).join("")}</table>`}(p):p}async function Gt({popupTemplate:e,spatialReference:t,graphic:n,map:s,view:r}){const o=e.expressionInfos,a=[],d={};if(!o||!o.length)return d;const c=await Promise.all([i.e(9787),i.e(9351)]).then(i.bind(i,9389)).then((function(e){return e.aq}));for(const e of o)a.push(jt({expressionAttributes:d,info:e,arcadeUtils:c,spatialReference:t,map:s,graphic:n,view:r}));return await(0,l.A)(a),d}const qt="esri.widgets.FeatureViewModel",Kt=a.n.getLogger(qt);let Zt=class extends n.p{constructor(e){super(e),this._handles=new s.u,this._featureAbortController=null,this.graphicChangedThrottled=J(this.graphicChanged,1,this),this._expressionAttributes=null,this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add((0,r.d)(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return(0,a.r)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach((e=>{const n=Me(e.fieldName,t);e.fieldName=n,i.set(n.toLowerCase(),e)})),i}(Fe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return ve(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Pt&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Pt&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Pt&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=(0,l.h)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){Kt.error("error","error loading popupTemplate for graphic",{error:t,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new m.e({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:i}=this,{description:n,title:s}=e;return this.contentViewModels[t]=new ot({graphic:i,...this._compileTitleAndDesc({title:s,description:n})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:n,destroyer:s}=e;return this.contentViewModels[t]=new pt({graphic:i,creator:n,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:n,graphic:s,formattedAttributes:r,_expressionAttributes:o}=this,{attributes:a}=s,l=r.global;return{title:xe({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:n,text:e}),description:xe({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:n,text:t})}}_compileFields(e,t){const{_effectivePopupTemplate:i,formattedAttributes:n}=this,s=e.clone(),r=(null==e?void 0:e.fieldInfos)||(null==i?void 0:i.fieldInfos),o=null==i?void 0:i.expressionInfos,a={...n.global,...n.content[t]},{description:l,title:d}=s,c=new _t({attributes:a,expressionInfos:o,fieldInfos:r,...this._compileTitleAndDesc({title:d,description:l})});return this.contentViewModels[t]=c,s.fieldInfos=c.formattedFieldInfos.slice(0),s}_compileMedia(e,t){const{graphic:i,_fieldInfoMap:n,_effectivePopupTemplate:s,relatedInfos:r,_sourceLayer:o,_expressionAttributes:a}=this,{attributes:l}=i,d=this.formattedAttributes.global,c=e.clone(),{description:h,mediaInfos:u,title:p}=c,f=new Pt({activeMediaInfoIndex:c.activeMediaInfoIndex||0,attributes:l,layer:o,fieldInfoMap:n,formattedAttributes:d,expressionAttributes:a,mediaInfos:u,popupTemplate:s,relatedInfos:r,...this._compileTitleAndDesc({title:p,description:h})});return c.mediaInfos=f.formattedMediaInfos.slice(0),this.contentViewModels[t]=f,c}_compileText(e,t){const i=e.clone(),{graphic:n,_fieldInfoMap:s,_sourceLayer:r,_expressionAttributes:o}=this;if(i&&i.text){const{attributes:e}=n,t=this.formattedAttributes.global;i.text=xe({attributes:e,fieldInfoMap:s,globalAttributes:t,expressionAttributes:o,layer:r,text:i.text})}return this.contentViewModels[t]=new pt({graphic:n,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:n}=e,s=null==t?void 0:t.editFieldsInfo;return n&&s?function(e,t){const{creatorField:i,creationDateField:n,editorField:s,editDateField:r}=e;if(!t)return;const o=t[r];if("number"==typeof o){const e=t[s];return{type:"edit",date:(0,C.L)(o,ye),user:e}}const a=t[n];if("number"==typeof a){const e=t[i];return{type:"create",date:(0,C.L)(a,ye),user:e}}return null}(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:n,_expressionAttributes:s}=this,{attributes:r}=n;return xe({attributes:r,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return _e(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return _e(null==e?void 0:e.content,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:n,_effectivePopupTemplate:s,spatialReference:r,map:o,view:a}=this,{content:{value:d},title:{value:c}}=await(0,l.A)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!n)return;await async function({graphic:e,popupTemplate:t,layer:i,spatialReference:n},s){if(!i||!t)return;if("function"==typeof i.load&&await i.load(s),!e.attributes)return;const r=e.attributes[i.objectIdField];if(null==r)return;const o=[r],a=await t.getRequiredFields(i.fieldsIndex),l=(0,E.f)(a,e),d=l?[]:a,c=t.returnGeometry||await async function(e){var t;if(null==(t=e.expressionInfos)||!t.length)return!1;const i=await(0,E.a)(),{arcadeUtils:{hasGeometryFunctions:n}}=i;return n(e)}(t);if(l&&!c)return;const h=await async function(e,t){var i,n;const{layer:s,graphic:r,outFields:o,objectIds:a,returnGeometry:l,spatialReference:d}=e,c=a[0];if("number"!=typeof c&&"string"!=typeof c){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:s,graphic:r,objectId:c,requiredFields:o};return ae.warn(e,t),null}if(null==(i=s.capabilities)||null==(n=i.operations)||!n.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:s,graphic:r,requiredFields:o,returnGeometry:l};return ae.warn(e,t),null}const h=s.createQuery();return h.objectIds=a,h.outFields=o,h.returnGeometry=!!l,h.outSpatialReference=d,(await s.queryFeatures(h,t)).features[0]}({layer:i,graphic:e,outFields:d,objectIds:o,returnGeometry:c,spatialReference:n},s);h&&(h.geometry&&(e.geometry=h.geometry),h.attributes&&(e.attributes={...e.attributes,...h.attributes}))}({graphic:n,popupTemplate:s,layer:i,spatialReference:r},e);const{expressionAttributes:{value:h}}=await(0,l.A)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Gt({popupTemplate:this._effectivePopupTemplate,spatialReference:r,graphic:n,map:o,view:a})});t===this._featureAbortController&&n&&(this._expressionAttributes=h,this._set("formattedAttributes",this._createFormattedAttributes(d,h)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(d)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:i,graphic:n,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:o}=this,a=null==i?void 0:i.fieldInfos,l={...n.attributes,...t},d={global:Se({fieldInfos:a,graphic:n,attributes:l,layer:r,fieldInfoMap:o,relatedInfos:s}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(d.content[t]=Se({fieldInfos:e.fieldInfos,graphic:n,attributes:l,layer:r,fieldInfoMap:o,relatedInfos:s}))})),d}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Fe(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:n,_sourceLayer:s}=this;n.clear();const r=(0,a.r)(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!r)return;const o=t.filter((e=>e&&Oe(e.fieldName)));if(!o||!o.length)return;t.forEach((e=>this._configureRelatedInfo(e,r)));const d=await function({relatedInfos:e,layer:t},i){const n={};return e.forEach(((e,s)=>{const{relation:r}=e;if(!r){const e=new l.s("relation-required","A relation is required on a layer to retrieve related records.");throw It.error(e),e}const{relatedTableId:o}=r;if("number"!=typeof o){const e=new l.s("A related table ID is required on a layer to retrieve related records.");throw It.error(e),e}const a=`${t.url}/${o}`,d=Ct.get(a),c=d||function(e,t){return(0,p.L)(e,{query:{f:"json"},signal:t&&t.signal})}(a,i);d||Ct.set(a,c),n[s]=c})),(0,l.A)(n)}({relatedInfos:n,layer:r},i);Object.keys(d).forEach((e=>{var t;const i=n.get(e.toString()),s=null==(t=d[e])?void 0:t.value;i&&s&&(i.layerInfo=s.data)}));const c=await function({graphic:e,relatedInfos:t,layer:i},n){const s={};return t.forEach(((t,r)=>{t.layerInfo&&(s[r]=async function(e,t,i,n){const s=i.layerId.toString(),{layerInfo:r,queryTask:o,relation:a,relatedFields:d,outStatistics:c}=t,h=function({originRelationship:e,relationships:t,layerId:i}){let n;return t&&t.some((t=>(`${t.relatedTableId}`===i&&t.id===e.id&&(n=t),!!n))),n}({originRelationship:a,relationships:r.relationships,layerId:s});if(h.relationshipTableId&&h.keyFieldInRelationshipTable){const t=(await function(e,t,i,n){const s=new A.l;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,n)}(e,h,i,n))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[r.objectIdField]));if((null==c?void 0:c.length)>0&&r.supportsStatistics){const e=new L.b;e.where=function(e,t,i){let n=0;const s=[];for(;n<t.length;)s.push(`${e} IN (${t.slice(n,1e3+n)})`),n+=1e3;return s.join(" OR ")}(r.objectIdField,s),e.outFields=d,e.outStatistics=c;const i={features:Promise.resolve(t),statsFeatures:o.execute(e)};return(0,l.A)(i)}}const u=null==h?void 0:h.keyField;if(u){const i=(0,E.J)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(r.fields,u)),s=function(e,t){const i=t.toLowerCase();for(const t in e)if(t.toLowerCase()===i)return e[t];return null}(e.attributes,a.keyField),d=i?`${u}=${s}`:`${u}='${s}'`,c=o.execute(new L.b({where:d,outFields:t.relatedFields}),n),h=t.outStatistics&&t.outStatistics.length>0&&r.supportsStatistics?o.execute(new L.b({where:d,outFields:t.relatedFields,outStatistics:t.outStatistics}),n):null,p={features:c};return h&&(p.statsFeatures=h),(0,l.A)(p)}return null}(e,t,i,n))})),(0,l.A)(s)}({graphic:e,relatedInfos:n,layer:r},i);Object.keys(c).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:n}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const r=n&&n.value;t.relatedStatsFeatures=r?r.features:[]}(null==(t=c[e])?void 0:t.value,n.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,n=xt(e.fieldName);if(!n)return;const{layerId:s,fieldName:r}=n;if(!s)return;const o=i.get(s.toString())||function(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:n}=t;return n.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(!i)return;const n=`${t.url}/${i.relatedTableId}`;return{url:n,queryTask:new T.Q({url:n,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}(s,t);o&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const n=new L.m({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(n)}}({relatedInfo:o,fieldName:r,fieldInfo:e}),this.relatedInfos.set(s,o))}};(0,n.e)([(0,o.y)()],Zt.prototype,"_featureAbortController",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"_effectivePopupTemplate",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"_fieldInfoMap",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"_sourceLayer",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"content",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"contentViewModels",void 0),(0,n.e)([(0,o.y)({type:Boolean})],Zt.prototype,"defaultPopupTemplateEnabled",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"formattedAttributes",void 0),(0,n.e)([(0,o.y)({type:P.h,value:null})],Zt.prototype,"graphic",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"lastEditInfo",void 0),(0,n.e)([(0,o.y)()],Zt.prototype,"relatedInfos",void 0),(0,n.e)([(0,o.y)()],Zt.prototype,"spatialReference",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"title",void 0),(0,n.e)([(0,o.y)()],Zt.prototype,"map",null),(0,n.e)([(0,o.y)({readOnly:!0})],Zt.prototype,"waitingForContent",null),(0,n.e)([(0,o.y)()],Zt.prototype,"view",void 0),Zt=(0,n.e)([(0,o.n)(qt)],Zt);var Yt=Zt;const Xt=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>(0,I.a)(e)&&!e.destroyed?(0,I.n)("div",{key:e},e.render()):e instanceof HTMLElement?(0,I.n)("div",{key:e,bind:e,afterCreate:this._attachToNode}):(0,I.t)(e)?(0,I.n)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=(0,n.e)([(0,o.n)("esri.widgets.Feature.ContentMixin")],t),t},Qt="esri-feature__content-element",Jt={title:!0,content:!0,lastEditedInfo:!0};let ei=class extends(Xt(I.x)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...Jt},this.map=null,this.view=null,this.viewModel=new Yt}initialize(){this.own((0,r.d)(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...Jt,...e}}render(){const{waitingForContent:e}=this.viewModel;return(0,I.n)("div",{class:this.classes("esri-feature","esri-widget")},(0,I.n)("div",{class:"esri-feature__size-container"},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return(0,I.n)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,I.n)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?(0,I.n)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?(0,I.n)(at,{level:this.headingLevel,class:"esri-feature__title",innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,I.n)("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:(0,I.n)("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:n}=t.viewModel;return"loading"===i||n.length>0?(0,I.n)("div",{key:this._buildKey("attachments-element",e),class:this.classes(Qt)},t.render()):null}renderCustom(e,t){const{creator:i}=e,n=this._contentWidgets[t];return!n||n.destroyed?null:i?(0,I.n)("div",{key:this._buildKey("custom-element",t),class:Qt},n.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,I.n)("div",{key:this._buildKey("fields-element",e),class:Qt},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,I.n)("div",{key:this._buildKey("media-element",e),class:Qt},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:n,user:s}=i,r="edit"===i.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=(0,C.s)(r,{date:n,user:s});return(0,I.n)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",Qt)},o)}renderText(e,t){const i=e.text,n=this._contentWidgets[t];return!n||n.destroyed?null:i?(0,I.n)("div",{key:this._buildKey("text-element",t),class:this.classes(Qt,"esri-feature__text")},n.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:n}=this.viewModel;if(Array.isArray(i))i.forEach(((i,s)=>{"attachments"===i.type&&(this._contentWidgets[s]=new ht({displayType:i.displayType,headingLevel:t.title?e+1:e,viewModel:n[s]})),"fields"===i.type&&(this._contentWidgets[s]=new Mt({viewModel:n[s]})),"media"===i.type&&(this._contentWidgets[s]=new Ht({viewModel:n[s]})),"text"===i.type&&(this._contentWidgets[s]=new yt({viewModel:n[s]})),"custom"===i.type&&(this._contentWidgets[s]=new yt({viewModel:n[s]}))}),this);else{const e=n[0];e&&!e.destroyed&&(this._contentWidgets[0]=new yt({viewModel:e}))}this.scheduleRender()}};(0,n.e)([(0,m.o)("viewModel.graphic")],ei.prototype,"graphic",void 0),(0,n.e)([(0,m.o)("viewModel.defaultPopupTemplateEnabled")],ei.prototype,"defaultPopupTemplateEnabled",void 0),(0,n.e)([(0,o.y)()],ei.prototype,"headingLevel",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ei.prototype,"label",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Feature/t9n/Feature")],ei.prototype,"messages",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/support/t9n/uriUtils")],ei.prototype,"messagesURIUtils",void 0),(0,n.e)([(0,m.o)("viewModel.spatialReference")],ei.prototype,"spatialReference",void 0),(0,n.e)([(0,m.o)("viewModel.title")],ei.prototype,"title",void 0),(0,n.e)([(0,o.y)()],ei.prototype,"visibleElements",void 0),(0,n.e)([(0,x.c)("visibleElements")],ei.prototype,"castVisibleElements",null),(0,n.e)([(0,m.o)("viewModel.map")],ei.prototype,"map",void 0),(0,n.e)([(0,m.o)("viewModel.view")],ei.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Yt})],ei.prototype,"viewModel",void 0),ei=(0,n.e)([(0,o.n)("esri.widgets.Feature")],ei);var ti=ei;let ii=class extends p.n.EventedAccessor{constructor(e){super(e),this._anchorHandles=new s.u,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([(0,r.h)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),(0,r.h)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",n=(0,r.B)(t,i,(()=>this._viewpointChange()));this._anchorHandles.add(n,e),this._viewpointHandle=n,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,n=this.get("view.ready"),s=i&&n&&(0,a.r)(e)?t.toScreen(e):null;this._set("screenLocation",s)}};(0,n.e)([(0,o.y)()],ii.prototype,"location",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],ii.prototype,"screenLocation",void 0),(0,n.e)([(0,o.y)()],ii.prototype,"screenLocationEnabled",void 0),(0,n.e)([(0,o.y)()],ii.prototype,"view",void 0),ii=(0,n.e)([(0,o.n)("esri.widgets.support.AnchorElementViewModel")],ii);var ni=ii;let si=class extends ni{constructor(e){super(e),this.visible=!1}};(0,n.e)([(0,o.y)()],si.prototype,"visible",void 0),si=(0,n.e)([(0,o.n)("esri.widgets.CompassViewModel")],si);var ri=si;let oi=class extends I.x{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new ri,this.visible=!1}initialize(){this.own([(0,r.h)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0,i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,n={"esri-spinner--start":e&&i,"esri-spinner--finish":!e&&i},s=this._getPositionStyles();return(0,I.n)("div",{class:this.classes("esri-spinner",n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,l.C)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||(0,a.t)(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,n.e)([(0,m.o)("viewModel.location")],oi.prototype,"location",void 0),(0,n.e)([(0,m.o)("viewModel.view")],oi.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:ri})],oi.prototype,"viewModel",void 0),(0,n.e)([(0,m.o)("viewModel.visible")],oi.prototype,"visible",void 0),oi=(0,n.e)([(0,o.n)("esri.widgets.Spinner")],oi);var ai=oi;function li(e){return e&&"opacity"in e?e.opacity*li(e.parent):1}async function di(e,t){var n,s;if(!e)return;const r=e.sourceLayer,o=null!=(n=(0,a.r)(t)&&null!=(s=t.useSourceLayer)&&s?r:e.layer)?n:r,l=li(o);if((0,a.r)(e.symbol)&&(!(0,a.r)(t)||!0!==t.ignoreGraphicSymbol)){const i="web-style"===e.symbol.type?await e.symbol.fetchSymbol((0,a.r)(t)?t.abortOptions:null):e.symbol.clone();return(0,R.v)(i,null,l),i}const d=(0,a.r)(t)&&t.renderer||o&&"renderer"in o&&o.renderer;let c=d&&"getSymbolAsync"in d?await d.getSymbolAsync(e,t):null;if(!c)return;if(c="web-style"===c.type?await c.fetchSymbol((0,a.r)(t)?t.abortOptions:null):c.clone(),!("visualVariables"in d)||!d.visualVariables||!d.visualVariables.length)return(0,R.v)(c,null,l),c;if("arcadeRequiredForVisualVariables"in d&&d.arcadeRequiredForVisualVariables&&((0,a.t)(t)||(0,a.t)(t.arcade))){const e={...(0,a.f)(t)};e.arcade=await(0,E.a)(),t=e}const h=await Promise.resolve().then(i.bind(i,48643)),u=[],p=[],f=[],m=[];for(const e of d.visualVariables)switch(e.type){case"color":u.push(e);break;case"opacity":p.push(e);break;case"rotation":m.push(e);break;case"size":e.target||f.push(e)}const g=!!u.length&&u[u.length-1],y=g?h.getColor(g,e,t):null,v=!!p.length&&p[p.length-1];let _=v?h.getOpacity(v,e,t):null;if(null!=l&&(_=null!=_?_*l:l),(0,R.v)(c,y,_),f.length){const i=h.getAllSizes(f,e,t);await(0,R.M)(c,i)}for(const i of m)(0,R.q)(c,h.getRotationAngle(i,e,t),i.axis);return c}const ci=(0,a.c)("mac")?"Meta":"Ctrl",hi={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)hi[e]=String.fromCharCode(e);for(let e=1;e<25;e++)hi[111+e]=`F${e}`;for(let e=65;e<91;e++)hi[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function ui(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class pi{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const fi=a.n.getLogger("esri.views.input.InputHandler");class mi{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?fi.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const s="string"==typeof e?new pi(e,n):e,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},a=new gi(s,i,{onPause:o,onRemove:o,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),r(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[s.eventType];return l||(l=[],this._incoming[s.eventType]=l),l.push(a),r(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new yi(e,{onEmit:(e,t,i,n)=>{this._manager.emit(e.eventType,t,i,n)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):fi.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class gi{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class yi{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class vi extends mi{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const _i=a.n.getLogger("esri.views.input.InputManager");let wi=class extends n.p{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=ci,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=Mi.INTERNAL){if(this._nameToGroup[e])return void _i.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void _i.error("Can't register a group of zero handlers");const n={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=n;for(let e=n.handlers.length-1;e>=0;e--){const t=n.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,n,s,r)=>{this._emitInputEvent(t.priorityIndex+1,e,i,n,r,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(n,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):_i.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s)for(const t of n.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of n.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)ui(e)||t.add(e)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(n(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(n(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const r=t.native;s("Alt",!(!r||!r.altKey)),s("Ctrl",!(!r||!r.ctrlKey)),s("Shift",!(!r||!r.shiftKey)),s("Meta",!(!r||!r.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new vi((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Mi.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],Mi.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,r=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,r),n?(r.add(s),1===r.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):r.has(s)&&(r.delete(s),0===r.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,r){const o=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new bi(t,i,o,r||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new b.e,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),n=t.data&&t.data.eventId;if(null==n||!this._stoppedPropagationEventIds.has(n))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=n&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new b.e;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};(0,n.e)([(0,o.y)({readOnly:!0})],wi.prototype,"hasPendingInputs",null),(0,n.e)([(0,o.y)()],wi.prototype,"eventSource",void 0),(0,n.e)([(0,o.y)()],wi.prototype,"recognizers",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],wi.prototype,"latestPointerType",void 0),wi=(0,n.e)([(0,o.n)("esri.views.input.InputManager")],wi);class bi{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const Mi={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};function Ii(e){return e&&"function"==typeof e.maskOccludee}function Ci(e,t,i){return(0,a.t)(e)||e>i&&(0===t||e<t)}function xi(e){let{minScale:t,maxScale:i}=e;return t=t||0,i=i||0,{minScale:t,maxScale:i}}const ki="esri-icon-zoom-in-magnifying-glass",Pi=new m.f({id:"zoom-to-feature",title:"{messages.zoom}",className:ki}),Ti=new m.f({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Ai=new m.f({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ki}),Ei=new m.f({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),Fi=a.n.getLogger("esri.widgets.Popup.PopupViewModel");function Li(e){const{selectedFeature:t,location:i,view:n}=e;return n?"3d"===n.type?t||i:e.get("selectedFeature.geometry")||i:null}const Di=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return(0,n.e)([(0,o.y)()],t.prototype,"goToOverride",void 0),(0,n.e)([(0,o.y)()],t.prototype,"view",void 0),t=(0,n.e)([(0,o.n)("esri.widgets.support.GoTo")],t),t},Si=h.L.ofType({key:"type",defaultKeyValue:"button",base:m.g,typeMap:{button:m.f,toggle:m.h}}),Oi="esri.widgets.Popup.PopupViewModel",Vi=a.n.getLogger(Oi);let Ri=class extends(Di(ni)){constructor(e){super(e),this._handles=new s.u,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Si,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new P.h({symbol:new O.S({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([(0,r.d)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),(0,r.h)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),(0,r.h)(this,"view.animation.state",(e=>this._animationStateChange(e))),(0,r.h)(this,"location",(e=>this._locationChange(e))),(0,r.h)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),(0,r.h)(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),(0,r.h)(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),(0,r.h)(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>function(e){const{event:t,view:i}=e,{action:n}=t,s=i&&i.popup;if(!n)return Promise.reject(new l.s("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new l.s("trigger-action:missing-arguments","view.popup is missing"));const{disabled:r,id:o}=n;if(!o)return Promise.reject(new l.s("trigger-action:invalid-action","action.id is missing"));if(r)return Promise.reject(new l.s("trigger-action:invalid-action","Action is disabled"));if(o===Pi.id)return async function(e){const{location:t,selectedFeature:i,view:n,zoomFactor:s}=e,r=Li(e);if(!r){const e=new l.s("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:r,view:n});return Fi.error(e),Promise.reject(e)}const o=n.scale/s,a=e.get("selectedFeature.geometry")||t,d=a&&"point"===a.type&&function(e,t){if("3d"!==(null==t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new l.s("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Fi.error(t)})),t}return!0}(i,n);Pi.active=!0,Pi.disabled=!0,await e.view.goTo({target:r,scale:d?o:void 0}),Pi.active=!1,Pi.disabled=!1,e.zoomToLocation=null,d&&(e.location=a)}(s.viewModel);if(o===Ai.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new l.s("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Fi.error(e),e}if(!t.isAggregate){const e=new l.s("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Fi.error(e),e}const n=t.sourceLayer,s=await i.whenLayerView(n),r=s.createQuery();r.aggregateIds=[t.getObjectId()],Ai.active=!0,Ai.disabled=!0;const{extent:o}=await s.queryExtent(r);await i.goTo({target:o}),Ai.active=!1,Ai.disabled=!1}(s.viewModel);if(o===Ei.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Ti.id){s.close();const{selectedFeature:e}=s;if(!e)return Promise.reject(new l.s(`trigger-action:${Ti.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()}({event:e,view:this.view}))),(0,r.O)(this,"waitingForResult",(()=>this._waitingForResultChange()),!0),(0,r.h)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),(0,r.h)(this,["view.scale"],this._viewScaleChange),(0,r.O)(this,"visible",(()=>this.browseClusterEnabled=!1)),(0,r.h)(this,"browseClusterEnabled",(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Si;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:r}=this,o=s?i.concat(t):t,a=r&&("function"==typeof r.getEffectivePopupTemplate&&r.getEffectivePopupTemplate(n)||r.popupTemplate),l=a&&a.actions,d=a&&a.overwriteActions?l:l?l.concat(o):o;return d&&d.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){var e;const t=this._get("defaultActions")||new Si;return t.removeAll(),t.addMany(null!=(e=this.selectedFeature)&&e.isAggregate?[Ai.clone(),Ei.clone()]:[Pi.clone()]),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,r=n&&t.length;r&&i&&-1===s?this.selectedFeatureIndex=0:r&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,x.d)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e),e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Li(this);if(!t){const i=new l.s("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return Vi.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new l.s("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return Vi.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(e){e.features=e.features.filter((e=>e.isAggregate))})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new l.s("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw Fi.error(e),e}if(!t.isAggregate){const e=new l.s("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Fi.error(e),e}const n=t.sourceLayer,s=await i.whenLayerView(n),r=s.createQuery();r.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(r);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new l.s("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw Fi.error(e),e}if(!t.isAggregate){const e=new l.s("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Fi.error(e),e}const n=t.sourceLayer,s=await i.whenLayerView(n),r=s.createQuery();r.aggregateIds=[t.getObjectId()],Ei.active=!0,Ei.disabled=!0;const{features:o}=await s.queryFeatures(r);Ei.active=!1,Ei.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}(this)}_animationStateChange(e){this.zoomToLocation||(Pi.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=null==(e=this.view)?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;(null!=(e=this.selectedFeature)&&e.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(null===i)return;const r=((i-1)*n+t)%t,o=r+n;s.slice(r,o).forEach(((t,i)=>{t&&!t.graphic&&(t.graphic=e[r+i])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate)return;return e.symbol=await di(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=(0,a.f)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,n=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[n,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(null!=e&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const n=i.slice(0),s=[];t.forEach(((t,i)=>{if(!t)return;let r=null;if(n.some(((e,i)=>(e&&e.graphic===t&&(r=e,n.splice(i,1)),!!r))),r)s[i]=r;else{var o,a;const n=new Yt({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(o=this.view)?void 0:o.spatialReference,graphic:t===e?t:null,map:null==(a=this.view)?void 0:a.map,view:this.view});s[i]=n}})),n.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),Mi.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=(0,l.h)(),{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:r}=e,o=[Promise.resolve(t),...s.map((e=>e.promise))];return n.popup.open({location:r||i,promises:o}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return(0,a.t)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;let{layer:r,sourceLayer:o}=t;if("map-notes"!==(null==o?void 0:o.type)&&"subtype-group"!==(null==o?void 0:o.type)||(r=o),!(r&&r instanceof V.b))return;const a=this._getLayerView(n,r);this._highlightPromise=a;const l=await a;if(!(l&&function(e){return e&&"function"==typeof e.highlight}(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const d="objectIdField"in r&&r.objectIdField,c=t.attributes,h=c&&d&&c[d],u=l.highlight(h||t);this._handles.add(u,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};(0,n.e)([(0,o.y)()],Ri.prototype,"featurePage",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"isLoadingFeature",null),(0,n.e)([(0,o.y)({type:Si})],Ri.prototype,"actions",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"active",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"allActions",null),(0,n.e)([(0,o.y)({type:Boolean})],Ri.prototype,"defaultPopupTemplateEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"autoCloseEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"autoOpenEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"browseClusterEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"content",void 0),(0,n.e)([(0,o.y)({type:Si,readOnly:!0})],Ri.prototype,"defaultActions",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"featureCount",null),(0,n.e)([(0,o.y)()],Ri.prototype,"features",null),(0,n.e)([(0,o.y)()],Ri.prototype,"featuresPerPage",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"featureViewModels",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"highlightEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"includeDefaultActions",void 0),(0,n.e)([(0,o.y)({type:x.b})],Ri.prototype,"location",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"pendingPromisesCount",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"selectedClusterBoundaryFeature",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"waitingForResult",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"promiseCount",null),(0,n.e)([(0,o.y)()],Ri.prototype,"promises",null),(0,n.e)([(0,o.y)({value:null,readOnly:!0})],Ri.prototype,"selectedFeature",null),(0,n.e)([(0,o.y)({value:-1})],Ri.prototype,"selectedFeatureIndex",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"selectedFeatureViewModel",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ri.prototype,"state",null),(0,n.e)([(0,o.y)()],Ri.prototype,"title",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"updateLocationEnabled",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"view",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"visible",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"zoomFactor",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"zoomToLocation",void 0),(0,n.e)([(0,o.y)()],Ri.prototype,"centerAtLocation",null),Ri=(0,n.e)([(0,o.n)(Oi)],Ri);var Ni=Ri;const zi="selected-index",Bi="popup-spinner",Hi="esri-icon-left-triangle-arrow",Ui="esri-icon-right-triangle-arrow",$i="esri-icon-loading-indicator",Wi="esri-rotating",ji="esri-popup--shadow",Gi="esri-popup__header-container",qi="esri-popup__button",Ki="esri-popup__icon",Zi={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Yi="esri-popup";function Xi(e,t){return void 0===t?`${Yi}__${e}`:`${Yi}__${e}-${t}`}const Qi="esri.widgets.Popup",Ji=a.n.getLogger(Qi),en={closeButton:!0,featureNavigation:!0};let tn=class extends(Xt(I.x)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new s.u,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{null!=e&&e.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=J((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Ni,this.visible=null,this.visibleElements={...en},this._addSelectedFeatureIndexHandle(),this.own([(0,r.h)(this,"viewModel.screenLocation",(()=>this._positionContainer())),(0,r.h)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),(0,r.h)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),(0,r.h)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),(0,r.h)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),(0,r.h)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,r.h)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),(0,r.h)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),(0,r.h)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,r.h)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),(0,r.h)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),(0,r.O)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),(0,r.C)(this,"viewModel.allActions","change",(()=>this._watchActions())),(0,r.d)(this,"viewModel.allActions",(()=>this._watchActions())),(0,r.h)(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,n,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(n=i.viewModel)?void 0:n.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Zi}set dockOptions(e){const t={...Zi},i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},r={...t.breakpoint,...n},{breakpoint:o}=s;!0===o?s.breakpoint=r:"object"==typeof o&&(s.breakpoint={...r,...o}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:n}=this.viewModel,s={...t,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=s):this._feature=new ti({headingLevel:i+1,viewModel:n,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...en,...e}}blur(){const{active:e}=this.viewModel;e||Ji.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Ji.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(zi);const n=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:n};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,n;const{actionsMenuOpen:s,dockEnabled:r,featureMenuVisible:o,dividedActions:a,currentAlignment:l,currentDockPosition:d}=this,{active:c}=this.viewModel,{menuActions:h}=a,u=c&&h.length>1&&s,p=c&&r,f=c&&!r,m=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,g=null==(i=this.selectedFeature)||null==(n=i.layer)?void 0:n.id,y={"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":p,[ji]:f,"esri-popup--is-docked-top-left":"top-left"===d,"esri-popup--is-docked-top-center":"top-center"===d,"esri-popup--is-docked-top-right":"top-right"===d,"esri-popup--is-docked-bottom-left":"bottom-left"===d,"esri-popup--is-docked-bottom-center":"bottom-center"===d,"esri-popup--is-docked-bottom-right":"bottom-right"===d,"esri-popup--feature-menu-open":o,"esri-popup--actions-menu-open":u};return(0,I.n)("div",{class:this.classes("esri-popup",y),role:"presentation","data-layer-title":m,"data-layer-id":g,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},c?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,I.n)("span",{"aria-hidden":"true",class:this.classes(Ki,$i,Wi)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?(0,I.n)("div",{key:Xi("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=(0,I.d)(),t={[Ui]:e,"esri-popup__pagination-previous-icon--rtl":e,[Hi]:!e,"esri-popup__pagination-previous-icon":!e};return(0,I.n)("span",{"aria-hidden":"true",class:this.classes(Ki,t)})}renderPreviousButton(){const{messages:e}=this;return(0,I.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(qi,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=(0,I.d)(),t={[Hi]:e,"esri-popup__pagination-next-icon--rtl":e,[Ui]:!e,"esri-popup__pagination-next-icon":!e};return(0,I.n)("span",{"aria-hidden":"true",class:this.classes(Ki,t)})}renderNextButton(){const{messages:e}=this;return(0,I.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(qi,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return(0,I.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(qi,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={"esri-icon-minimize":e,"esri-popup__icon--dock-icon":!e,"esri-icon-dock-right":!e&&("top-right"===t||"bottom-right"===t),"esri-icon-dock-left":!e&&("top-left"===t||"bottom-left"===t),"esri-icon-maximize":!e&&"top-center"===t,"esri-icon-dock-bottom":!e&&"bottom-center"===t};return(0,I.n)("span",{"aria-hidden":"true",class:this.classes(i,Ki)})}renderDockButton(){var e,t,i;const{dockEnabled:n,messages:s}=this,r=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,o=n?s.undock:s.dock;return"xsmall"!==r&&null!=(i=this.dockOptions)&&i.buttonEnabled?(0,I.n)("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(qi,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,r={"esri-popup__header-container--button":i},o=(0,I.n)(at,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:e}),a=i?(0,I.n)("button",{key:`${e}--collapsible`,id:t,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Gi,r),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed},o):(0,I.n)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Gi,r)},o);return e?a:null}renderCloseIcon(){return(0,I.n)("span",{"aria-hidden":"true",class:this.classes(Ki,"esri-icon-close")})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?(0,I.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:qi,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,I.n)("header",{class:"esri-popup__header"},this.renderTitle(),(0,I.n)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:n}=this.viewModel;return t&&!i?(0,I.n)("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,r=i?s.close:s.open,{menuActions:o}=n;return o.length?(0,I.n)("div",{key:Xi("actions-menu-button"),class:this.classes(qi,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":r,title:r},(0,I.n)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s,inlineActions:r}=n;return s.length&&i?(0,I.n)("ul",{id:e,role:"menu","aria-labelledby":t,key:Xi("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+r.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,n=!!t.length;return i||n?(0,I.n)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,I.n)("section",{key:Xi("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:n}=t,s=!!i.length,r={"esri-popup__footer--has-pagination":e,"esri-popup__footer--has-actions":s,"esri-popup__footer--has-actions-menu":!!n.length};return e||s?(0,I.n)("div",{key:Xi("feature-buttons"),class:this.classes("esri-popup__footer",r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,n=(0,C.s)(e.selectedFeatures,{total:t.length});return(0,I.n)("section",{key:Xi("menu"),class:"esri-popup__feature-menu"},(0,I.n)("strong",{class:"esri-popup__feature-menu-header"},n),(0,I.n)("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:I.p},this.renderFeatureMenu(),(0,I.n)("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?(0,I.n)("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:(0,I.n)("div",{key:Xi("pointer"),class:"esri-popup__pointer",role:"presentation"},(0,I.n)("div",{class:this.classes("esri-popup__pointer-direction",ji)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:n,contentId:s,collapsible:r,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:d}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,h="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,u={[ji]:e,"esri-popup--is-collapsible":r,"esri-popup--is-collapsed":a};return(0,I.n)("div",{class:this.classes("esri-popup__main-container","esri-widget",u),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":d?n:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?(0,I.n)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return(0,I.n)("span",{key:"text",class:"esri-popup__action-text"},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),n={[$i]:e.active,[Wi]:e.active,[Ki]:!!t,"esri-popup__action-image":!e.active&&!!i};return t&&(n[t]=!e.active),(0,I.n)("span",{key:"icon","aria-hidden":"true",class:this.classes(Ki,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:n}=e,s=this._getActionTitle(t),r={"esri-popup__action":"toggle"!==t.type,"esri-popup__action-toggle":"toggle"===t.type,"esri-popup__action-toggle--on":"toggle"===t.type&&t.value,"esri-popup__button--disabled":t.disabled},o=[this.renderActionIcon(t),this.renderActionText(s)],a="menu-item"===n?(0,I.n)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(qi,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o):(0,I.n)("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(qi,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:r}=this.viewModel,o=e===r,a={"esri-popup__feature-menu-item--selected":o},l=o?(0,I.n)("span",{key:Xi(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,d=(0,I.n)("span",{innerHTML:e.title||n.untitled});return(0,I.n)("li",{role:"menuitem",tabIndex:-1,key:Xi(`feature-menu-feature-${s}`),class:this.classes(a,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},(0,I.n)("span",{class:"esri-popup__feature-menu-title"},d,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?(0,I.n)("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,r=null==i?void 0:i.attributes,o="zoom-to-feature"===s?(0,C.s)(e.title,{messages:t}):"remove-selected-feature"===s?(0,C.s)(e.title,{messages:n}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?(0,C.s)(e.title,{messages:t}):e.title;return o&&r?(0,C.s)(o,r):o}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:n,image:s}=e,r=s||n?n:"esri-icon-default-action";return r&&i?(0,C.s)(r,i):r}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:n}=e;return n&&i?(0,C.s)(n,i):n}_createFeatureUpdatedAnimation(){return(0,I.g)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add((0,r.h)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,n=0===t;return{inlineActions:i?e.slice(0):n?new h.L:e.slice(0,t),menuActions:i?new h.L:n?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===(0,l.i)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===(0,l.i)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=(0,l.i)(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),r=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+r)%r].focus()):(e.stopPropagation(),s[(n-1+r)%r].focus())}_handleActionMenuItemKeyup(e){const t=(0,l.i)(e),{_actionsMenuNode:i}=this,n=e.currentTarget["data-action-index"];if(!i)return;const s=i.querySelectorAll("li"),r=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+r)%r].focus()):(e.stopPropagation(),s[(n-1+r)%r].focus())}_handleMainKeyup(e){const t=(0,l.i)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=(0,r.h)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,zi)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:r}=e;if(isNaN(i)||isNaN(t)||!r||!n)return!1;const o=r.padding;return"right"===s&&n.x+i/2>r.width-o.right||"left"===s&&n.x-i/2<o.left||"top"===s&&n.y-t<o.top||"bottom"===s&&n.y+t>r.height-o.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:r,view:o}=s;if((0,a.t)(r)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(r,o))return this._get("currentAlignment")||"top-center";function l(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const d=n?window.getComputedStyle(n,null):null,c=d?l(d.getPropertyValue("max-height")):0,h=d?l(d.getPropertyValue("height")):0,{height:u,width:p}=i.getBoundingClientRect(),f=p+t,m=Math.max(u,c,h)+t,g=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:r,side:"right",view:o}),y=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:r,side:"left",view:o}),v=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:r,side:"top",view:o}),_=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:r,side:"bottom",view:o});return y?v?"bottom-right":"top-right":g?v?"bottom-left":"top-left":v?_?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,I.d)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,n=(0,I.d)()?"top-left":"top-right";if(!i)return n;const s=i.padding||{left:0,right:0,top:0,bottom:0},r=i.width-s.left-s.right,{breakpoints:o}=i;return o&&r<=o.xsmall?"bottom-center":n}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:r}=this,o=n/2,a=i.height-t,l=i.width-e,{padding:d}=this.view;return"bottom-center"===s?{top:t+r-d.top,left:e-o-d.left}:"top-left"===s?{bottom:a+r-d.bottom,right:l+r-d.right}:"bottom-left"===s?{top:t+r-d.top,right:l+r-d.right}:"top-right"===s?{bottom:a+r-d.bottom,left:e+r-d.left}:"bottom-right"===s?{top:t+r-d.top,left:e+r-d.left}:"top-center"===s?{bottom:a+r-d.bottom,left:e-o-d.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if((0,a.t)(e)||!t)return;const s=this._calculateFullWidth(t),r=this._calculateAlignmentPosition(e.x,e.y,n,s);return r?{top:void 0!==r.top?`${r.top}px`:"auto",left:void 0!==r.left?`${r.left}px`:"auto",bottom:void 0!==r.bottom?`${r.bottom}px`:"auto",right:void 0!==r.right?`${r.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[r,o]=t,{width:a,height:l}=i;return n<=a&&r>a||n>a&&r<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,r=[],o=[];r[0]=e[0]-n,r[1]=e[1]-s,o[0]=t[0]-n,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(r,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const n=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:r,height:o}=s;if(isNaN(r)||isNaN(o))return!1;const a=n.hasOwnProperty("width")&&r<=n.width,l=n.hasOwnProperty("height")&&o<=n.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?(0,C.s)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Bi),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new ai({view:e}),e.ui.add(this._spinner,{key:Bi,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"actionsMenuId",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"actionsMenuButtonId",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"featureMenuId",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"titleId",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"contentId",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"hasContent",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"featureNavigationVisible",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"collapsible",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"featureMenuVisible",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"contentCollapsed",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"dividedActions",null),(0,n.e)([(0,m.o)("viewModel.actions")],tn.prototype,"actions",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"actionsMenuOpen",null),(0,n.e)([(0,o.y)()],tn.prototype,"alignment",void 0),(0,n.e)([(0,m.o)("viewModel.autoCloseEnabled")],tn.prototype,"autoCloseEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.autoOpenEnabled")],tn.prototype,"autoOpenEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.defaultPopupTemplateEnabled")],tn.prototype,"defaultPopupTemplateEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.content")],tn.prototype,"content",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"collapsed",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"collapseEnabled",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"currentAlignment",null),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"currentDockPosition",null),(0,n.e)([(0,o.y)()],tn.prototype,"dockOptions",null),(0,n.e)([(0,o.y)()],tn.prototype,"dockEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.featureCount")],tn.prototype,"featureCount",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"featureMenuOpen",void 0),(0,n.e)([(0,m.o)("viewModel.features")],tn.prototype,"features",void 0),(0,n.e)([(0,m.o)("viewModel.goToOverride")],tn.prototype,"goToOverride",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"headingLevel",void 0),(0,n.e)([(0,m.o)("viewModel.highlightEnabled")],tn.prototype,"highlightEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.location")],tn.prototype,"location",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],tn.prototype,"label",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"maxInlineActions",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Popup/t9n/Popup")],tn.prototype,"messages",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/t9n/common")],tn.prototype,"messagesCommon",void 0),(0,n.e)([(0,m.o)("viewModel.promises")],tn.prototype,"promises",void 0),(0,n.e)([(0,m.o)("viewModel.selectedFeature")],tn.prototype,"selectedFeature",void 0),(0,n.e)([(0,m.o)("viewModel.selectedFeatureIndex")],tn.prototype,"selectedFeatureIndex",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],tn.prototype,"selectedFeatureWidget",null),(0,n.e)([(0,o.y)()],tn.prototype,"spinnerEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.title")],tn.prototype,"title",void 0),(0,n.e)([(0,m.o)("viewModel.updateLocationEnabled")],tn.prototype,"updateLocationEnabled",void 0),(0,n.e)([(0,m.o)("viewModel.view")],tn.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Ni}),function(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,n=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);i.push(...n)}}(["triggerAction","trigger-action"])],tn.prototype,"viewModel",void 0),(0,n.e)([(0,m.o)("viewModel.visible")],tn.prototype,"visible",void 0),(0,n.e)([(0,o.y)()],tn.prototype,"visibleElements",void 0),(0,n.e)([(0,x.c)("visibleElements")],tn.prototype,"castVisibleElements",null),(0,n.e)([ft()],tn.prototype,"_close",null),(0,n.e)([ft()],tn.prototype,"_toggleDockEnabled",null),(0,n.e)([ft()],tn.prototype,"_toggleFeatureMenu",null),(0,n.e)([ft()],tn.prototype,"_toggleActionsMenu",null),(0,n.e)([ft()],tn.prototype,"_triggerAction",null),(0,n.e)([ft()],tn.prototype,"_selectFeature",null),(0,n.e)([ft()],tn.prototype,"_next",null),(0,n.e)([ft()],tn.prototype,"_previous",null),tn=(0,n.e)([(0,o.n)(Qi)],tn);var nn=tn;const sn=[0,0];function rn(e){e&&((0,I.f)(e),e.parentNode&&e.parentNode.removeChild(e))}const on=750,an=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:on},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),rn(this.root),this._set("root",null),(0,I.r)(this.userContent,t),rn(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",(0,I.r)(e,t),e.appendChild(t),this._set("userContent",t);const s=document.createElement("div");s.className="esri-view-root",e.insertBefore(s,e.firstChild),this._set("root",s);const o=document.createElement("div");o.className="esri-view-surface",o.setAttribute("role","application"),o.tabIndex=0,s.appendChild(o),this._set("surface",o);const a=new Q;s.appendChild(a.surface),this._set("overlay",a),a.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,n.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,r.d)(this,"size",(e=>{const[t,i]=e,n="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?o.classList.add(n):o.classList.remove(n)})),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new nn({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const n=this.position;return e-=n[0],t-=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const n=this.position;return e+=n[0],t+=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,r.d)(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),(0,r.d)(this,"popup",((t,i)=>{const n="popup";i&&e.remove(i,n),t&&(t.view=e.view,e.add(t,{key:n,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=on,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=on};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),(0,n.A)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const n=this._position();i.freq=n||t?16:Math.min(on,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const n=this.width,s=this.height;return t===n&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return sn[0]=i.left+t.pageXOffset,sn[1]=i.top+t.pageYOffset,sn}(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return(0,n.e)([(0,o.y)({value:null,cast:e=>(0,I.c)(e)})],t.prototype,"container",null),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"focused",null),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"height",void 0),(0,n.e)([(0,o.y)({type:nn})],t.prototype,"popup",null),(0,n.e)([(0,o.y)({type:Q})],t.prototype,"overlay",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"position",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"resizing",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"root",void 0),(0,n.e)([(0,o.y)({value:null,readOnly:!0})],t.prototype,"size",null),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"surface",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"suspended",void 0),(0,n.e)([(0,o.y)()],t.prototype,"ui",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"userContent",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"width",void 0),(0,n.e)([(0,o.y)()],t.prototype,"widthBreakpoint",void 0),t=(0,n.e)([(0,o.n)("esri.views.DOMContainer")],t),t};function ln(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],n=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}function dn(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),n=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return(0,M.a)(e,i,n,s),e}function cn(e,t,i){i=i||e;const n=(0,M.z)(e,t);(0,M.a)(i,e[0]-n*t[0],e[1]-n*t[1],e[2]-n*t[2]),(0,M.j)(i,i)}function hn(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,M.a)(t,0,1,0):(0,M.a)(t,1,0,0),(0,M._)(i,e,t),(0,M.j)(t,t),(0,M._)(t,i,e),(0,M.j)(i,i)}function un(e,t,i,n,s,r){const o=e+(t-e)*s;return o+(i+(n-i)*s-o)*r}function pn(e,t,i,n=(0,M.n)()){const s=(0,M.s)(e),r=(0,M.s)(t),o=(0,M.z)(e,t)/(s*r);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*r)/Math.sin(a),d=l/s*Math.sin((1-i)*a),c=l/r*Math.sin(i*a);return(0,M.d)(kn,e,d),(0,M.d)(Pn,t,c),(0,M.u)(n,kn,Pn)}return(0,M.y)(n,e,t,i)}function fn(e,t,i,n=(0,M.n)(),s=(0,M.n)()){const r=(0,M.s)(e),o=(0,M.s)(t),a=(0,M.z)(e,t)/(r*o);if(a<.9999999999999999){const l=Math.acos(a),d=Math.sin(l),c=Math.sin(i*l),h=Math.sin((1-i)*l),u=(1-i)*r+i*o;{const i=u/d,s=i/o*c;(0,M.d)(kn,e,i/r*h),(0,M.d)(Pn,t,s),(0,M.u)(n,kn,Pn)}{const n=1/r*(-Math.cos((1-i)*l)*l*u+h*(-r+o));(0,M.d)(kn,e,n);const a=1/o*(Math.cos(i*l)*l*u+c*(-r+o));(0,M.d)(Pn,t,a),(0,M.u)(s,kn,Pn),(0,M.d)(s,s,1/d)}return s}return(0,M.y)(n,e,t,i),(0,M.c)(s,t,e),(0,M.j)(s,s),s}function mn(e,t,i){e=(0,M.j)(kn,e),t=(0,M.j)(Pn,t);const n=(0,M.x)((0,M.z)(e,t));if(i){const s=(0,M._)(xn,e,t);if((0,M.z)(s,i)<0)return-n}return n}function gn(e){const t=e.length;return function(i){if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let n=1;for(;i>e[n][0];)n++;const s=e[n-1][0],r=e[n][0],o=(r-i)/(r-s);return o*e[n-1][1]+(1-o)*e[n][1]}}class yn{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),s&&i===t&&(i=e),i+n}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return(0,M.o)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,n=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function vn(e,t,i,n){(0,M.c)(_n,t,e),(0,M.c)(wn,i,e),(0,M._)(n,_n,wn),(0,M.j)(n,n),n[3]=-(0,M.z)(e,n)}const _n=(0,M.n)(),wn=(0,M.n)();function bn(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const Mn=bn(new yn(0,2*Math.PI)),In=bn(new yn(-Math.PI,Math.PI)),Cn=bn(new yn(0,360)),xn=(0,M.n)(),kn=(0,M.n)(),Pn=(0,M.n)();var Tn;let An=Tn=class extends n.a{constructor(...e){super(...e),this.position=new x.b([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,n){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const s={position:e};return null!=t&&(s.heading=t),null!=i&&(s.tilt=i),null!=n&&(s.fov=n),s}return e}writePosition(e,t,i,n){const s=e.clone();s.x=(0,o.u)(e.x||0),s.y=(0,o.u)(e.y||0),s.z=e.hasZ?(0,o.u)(e.z||0):e.z,t[i]=s.write(null,n)}readPosition(e,t){const i=new x.b;return i.read(e,t),i.x=(0,o.u)(i.x||0),i.y=(0,o.u)(i.y||0),i.z=i.hasZ?(0,o.u)(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}clone(){return new Tn({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};(0,n.e)([(0,o.y)({type:x.b,json:{write:{isRequired:!0}}})],An.prototype,"position",void 0),(0,n.e)([(0,n.o)("position")],An.prototype,"writePosition",null),(0,n.e)([(0,z.e)("position")],An.prototype,"readPosition",null),(0,n.e)([(0,o.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,x.c)((e=>Cn.normalize((0,o.u)(e))))],An.prototype,"heading",void 0),(0,n.e)([(0,o.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,x.c)((e=>(0,M.o)((0,o.u)(e),-180,180)))],An.prototype,"tilt",void 0),(0,n.e)([(0,o.y)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],An.prototype,"fov",void 0),An=Tn=(0,n.e)([(0,o.n)("esri.Camera")],An);var En,Fn=An;let Ln=En=class extends n.a{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new En({rotation:this.rotation,scale:this.scale,targetGeometry:(0,a.r)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,a.r)(this.camera)?this.camera.clone():null})}};function Dn(){return{enabled:!this.camera}}(0,n.e)([(0,o.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Dn}}}}})],Ln.prototype,"rotation",void 0),(0,n.e)([(0,x.c)("rotation")],Ln.prototype,"castRotation",null),(0,n.e)([(0,o.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Dn}}}}})],Ln.prototype,"scale",void 0),(0,n.e)([(0,o.y)({types:p.e,json:{read:B.p,write:!0,origins:{"web-scene":{read:B.p,write:{overridePolicy:Dn}}}}})],Ln.prototype,"targetGeometry",void 0),(0,n.e)([(0,o.y)({type:Fn,json:{write:!0}})],Ln.prototype,"camera",void 0),Ln=En=(0,n.e)([(0,o.n)("esri.Viewpoint")],Ln);var Sn=Ln;const On=e=>{let t=class extends e{async fetchPopupFeatures(e,t){await this.when();const{location:i,queryArea:s,layerViewsAndGraphics:r,clientOnlyGraphics:o}=await this._prepareFetchPopupFeatures(e,t),a=Promise.resolve(o),d=this._queryLayerPopupFeatures({queryArea:s,layerViewsAndGraphics:r,options:t}),c=d.map((e=>e.promise));return{location:i,clientOnlyGraphics:o,allGraphicsPromise:(0,l.k)([a,...c]).then(n.M),promisesPerLayerView:d}}_queryLayerPopupFeatures({queryArea:e,layerViewsAndGraphics:t,options:i}){return t.map((({layerView:t,graphics:n})=>{const s={clientGraphics:n,event:(0,a.r)(i)?i.event:null,signal:(0,a.r)(i)?i.signal:null,defaultPopupTemplateEnabled:!!(0,a.r)(i)&&!!i.defaultPopupTemplateEnabled},r=t.fetchPopupFeatures(e,s);return{layerView:t,promise:r}}))}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate((0,a.r)(t)&&t.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,t){const{clientGraphics:i,queryArea:n,location:s}=await this._popupHitTestGraphics(e,t),r=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:o,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,r);return{clientOnlyGraphics:a,layerViewsAndGraphics:o,queryArea:n,location:s}}async _popupHitTestGraphics(e,t){const{results:i,mapPoint:n}=await this.popupHitTest(e),s=i.filter((e=>this._isValidPopupGraphic(e.graphic,t))),r=s.length?s[0].mapPoint:null;return{clientGraphics:s.map((e=>e.graphic)),queryArea:n,location:n||r}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((t=>{this._isValidPopupLayerView(t)&&e.push(t)})),(0,a.r)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return(0,a.r)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}_graphicsPerFetchPopupLayerView(e,t){const i=[],n=new Map,s=t.map((e=>{const t=[];return"layer"in e?n.set(e.layer,t):n.set(e.graphics,t),{layerView:e,graphics:t}}));for(const t of e){const e=n.get(t.layer)||n.get(t.sourceLayer)||null;e?e.push(t):i.push(t)}return{layerViewsAndGraphics:s,clientOnlyGraphics:i}}};return t=(0,n.e)([(0,o.n)("esri.views.PopupView")],t),t};let Vn=class extends n.p{constructor(e){super(e),this.view=null,this.baseLayerViews=new h.L,this.referenceLayerViews=new h.L,this._loadingHandle=(0,r.d)(this,"view.map.basemap",(e=>{e&&e.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};function Rn(e,t){for(const[i,n]of e)if(t(n,i))return!0;return!1}function Nn(e,t){for(const[i,n]of e)if(t(n,i))return n;return null}(0,n.e)([(0,o.y)({constructOnly:!0})],Vn.prototype,"view",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Vn.prototype,"baseLayerViews",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Vn.prototype,"referenceLayerViews",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Vn.prototype,"suspended",null),(0,n.e)([(0,o.y)({type:Boolean,readOnly:!0})],Vn.prototype,"updating",null),Vn=(0,n.e)([(0,o.n)("esri.views.BasemapView")],Vn);const zn=a.n.getLogger("esri.views.LayerViewManager");class Bn{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=(0,l.h)(),this._deferred=(0,l.E)(),this._started=!1,this.done=!1,(0,l.v)(this._controller.signal,(()=>{const t=new l.s("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{var n,s;let r,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new l.s("layer:view-not-supported","No layerview implementation was found");const n=await this.layerViewImporter.importLayerView(t);(0,l.a)(e),r="default"in n?new n.default({layer:t,view:i}):new n({layer:t,view:i})}const d=()=>{o=(0,a.a)(o),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};o=(0,l.v)(e,d),(0,l.a)(e);try{await r.when()}catch(e){throw d(),e}if(!(null==(n=this._map)||null==(s=n.allLayers)?void 0:s.includes(t)))return d(),void this._deferred.reject(new l.s("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new l.s("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let Hn=class extends f.d{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new f.l,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const t=null==(e=this.view.map)?void 0:e.allLayers;if(t)for(const e of t)this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e)},this._reschedule=()=>((0,a.t)(this._workPromise)&&(this._workPromise=(0,l.E)()),this.handles.remove("reschedule"),this.handles.add((0,n.j)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var e,t,i;const n=this.view.map;if(this._map!==n&&(this.clear(),this._map=n),(0,a.t)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const s=new u.p({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&"layers"in e?e.layers:null});if(!s)return this._workPromise.resolve(),void(this._workPromise=null);for(const e of s)this._createLayerView(e);this._refreshCollections();for(const[e,t]of this._layerLayerViewInfoMap)s.includes(e)||(this._layerLayerViewInfoMap.delete(t.layer),t.destroy());const r=s.filter((e=>"group"===e.type)).map((e=>e.layers)),o=[null==n||null==(e=n.ground)?void 0:e.layers,null==n||null==(t=n.basemap)?void 0:t.baseLayers,null==n||null==(i=n.basemap)?void 0:i.referenceLayers,null==n?void 0:n.layers,...r].filter((e=>!!e));this.handles.add(o.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([(0,r.C)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),(0,r.d)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return(0,a.r)(this._workPromise)||this._watchUpdatingTracking.updating||Rn(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new l.s("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let n=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const r=e.layerView;r.layer=s,r.parent=i,t.getItemAt(n)!==r&&t.splice(n,0,r),s.layers&&this._populateLayerViewsOwners(s.layers,r.layerViews,r),n+=1}n<t.length&&t.splice(n,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Bn(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{var i,n;t&&((0,l.g)(t)||"cancelled:layerview-create"===t.name)||zn.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:"no title"}', id:'${null!=(n=e.id)?n:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,n.e)([(0,o.y)()],Hn.prototype,"_workPromise",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Hn.prototype,"_watchUpdatingTracking",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Hn.prototype,"_layersToLayerViews",null),(0,n.e)([(0,o.y)({readOnly:!0})],Hn.prototype,"_rootCollectionNames",null),(0,n.e)([(0,o.y)()],Hn.prototype,"layerViewImporter",void 0),(0,n.e)([(0,o.y)()],Hn.prototype,"supportsGround",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Hn.prototype,"updating",null),(0,n.e)([(0,o.y)({readOnly:!0})],Hn.prototype,"updatingRemaining",null),(0,n.e)([(0,o.y)({constructOnly:!0})],Hn.prototype,"view",void 0),Hn=(0,n.e)([(0,o.n)("esri.views.LayerViewManager")],Hn);var Un=Hn;let $n=class extends n.p{constructor(e){super(e),this.factor=1.5,this.offset=(0,w.c)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,n.e)([(0,o.y)({type:Number})],$n.prototype,"factor",void 0),(0,n.e)([(0,o.y)({nonNullable:!0})],$n.prototype,"offset",void 0),(0,n.e)([(0,o.y)()],$n.prototype,"position",void 0),(0,n.e)([(0,o.y)({type:Number,range:{min:0}})],$n.prototype,"size",void 0),(0,n.e)([(0,o.y)()],$n.prototype,"maskUrl",void 0),(0,n.e)([(0,o.y)()],$n.prototype,"maskEnabled",void 0),(0,n.e)([(0,o.y)()],$n.prototype,"overlayUrl",void 0),(0,n.e)([(0,o.y)()],$n.prototype,"overlayEnabled",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],$n.prototype,"version",null),(0,n.e)([(0,o.y)({type:Boolean})],$n.prototype,"visible",void 0),$n=(0,n.e)([(0,o.n)("esri.views.Magnifier")],$n);var Wn=$n;const jn=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshTimestamp=null,this.refreshDebounced=(0,l.B)((async(e,t)=>{let i;"number"==typeof e?i=e:(i=Date.now(),t=e),this._set("refreshTimestamp",i),this.doRefresh&&await this.doRefresh(t).catch((e=>{(0,l.g)(e)||a.n.getLogger(this.declaredClass).error(e)}))}),2e3)}refresh(e=Date.now()){this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh().catch((e=>{(0,l.g)(e)||a.n.getLogger(this.declaredClass).error(e)}))}};return(0,n.e)([(0,o.y)()],t.prototype,"layer",void 0),(0,n.e)([(0,m.o)("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),t=(0,n.e)([(0,o.n)("esri.layers.mixins.RefreshableLayerView")],t),t};function Gn(e){return"refresh"in e}let qn=class extends p.n.EventedAccessor{constructor(){super(...arguments),this._handles=new s.u,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",(()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(()=>this._restartTicking())),this.watch("view.ready",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>Gn(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((t=>{if(Gn(t)){const i=Math.round(6e4*t.refreshInterval),n=this._currentTick%i==0,s=e-t.refreshTimestamp<5400;i&&n&&!s&&(t.refresh(e),this.emit("refresh",{layerView:t,timestamp:e,trigger:"interval"}))}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach((i=>{Gn(i)&&i.layer&&e.push(i.watch("refreshInterval",t),i.layer.on("refresh",(()=>{const e=Date.now();i.refresh(e),this.emit("refresh",{layerView:i,timestamp:e,trigger:"layer-refresh"})})))})),e}_getCommonInterval(e){const t=(e,i)=>isNaN(e)||isNaN(i)?0:i<=0?e:t(i,e%i);return e.toArray().reduce(((e,i)=>t(Math.round(6e4*i.refreshInterval),e)),0)}};(0,n.e)([(0,o.y)()],qn.prototype,"view",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],qn.prototype,"tickInterval",null),qn=(0,n.e)([(0,o.n)("esri.views.RefreshManager")],qn);var Kn=qn;const Zn=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Yn={};function Xn(e){return!!Yn[e]}Zn.forEach((e=>{Yn[e]=!0}));class Qn{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,n){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!Xn(t))return!1;return!0}(s))return s.some(Xn)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let r,o;Array.isArray(t)?o=t:(r=t,o=[]),"function"==typeof i?r=i:n=i,n=null!=n?n:Mi.DEFAULT;const a=this.createUniqueGroupName(),l=new Jn(this.view,s,o,r);this.handlers.set(a,{handler:l,priority:n});for(const e of s){const t=this.handlerCounts.get(e)||0;this.handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(a,[l],n),{remove:()=>this.removeHandler(a,s)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class Jn extends mi{constructor(e,t,i,n){super(!0),this.view=e;for(const e of t)switch(e){case"click":this.registerIncoming("click",i,(e=>n(this.wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",i,(e=>n(this.wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(e=>n(this.wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(e=>n(this.wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",i,(e=>n(this.wrapHold(e))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this.wrapDrag(e);t&&n(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>n(this.wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>n(this.wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>n(this.wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>n(this.wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>n(this.wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>n(this.wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>n(this.wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>n(this.wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>n(this.wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{n(this.wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{n(this.wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{n(this.wrapBlur(e))}))}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:r,native:o,eventId:a}=e.data,{cancelable:l,timestamp:d}=e;return{type:"click",pointerType:t,button:i,buttons:n,x:s,y:r,native:o,timestamp:d,screenPoint:(0,w.c)(s,r),mapPoint:this.getMapPoint(s,r),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:r,native:o,eventId:a}=e.data,{cancelable:l,timestamp:d}=e;return{type:"double-click",pointerType:t,button:i,buttons:n,x:s,y:r,native:o,timestamp:d,mapPoint:this.getMapPoint(s,r),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:r,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:d,timestamp:c}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:n,x:s,y:r,native:o,timestamp:c,mapPoint:this.getMapPoint(s,r),eventId:a,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:r,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:d,timestamp:c}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:n,x:s,y:r,native:o,timestamp:c,mapPoint:this.getMapPoint(s,r),eventId:a,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:i,buttons:n,x:s,y:r,native:o}=e.data,{cancelable:a,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:n,x:s,y:r,native:o,timestamp:l,mapPoint:this.getMapPoint(s,r),cancelable:a,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap((0,w.c)(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:i,y:n}=t.center,{action:s,pointerType:r,button:o}=t;if("start"===s&&(this.latestDragStart=t),!this.latestDragStart)return;const a=t.pointer.native,l=t.buttons,{cancelable:d,timestamp:c}=e,h={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===s&&(this.latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:h,pointerType:r,button:o,buttons:l,radius:t.radius,angle:(0,M.N)(t.angle),native:a,timestamp:c,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:i,native:n}=e.data,{cancelable:s,timestamp:r}=e;return{type:"key-down",key:t,repeat:i,native:n,timestamp:r,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:i,y:n,button:s,buttons:r,native:o,eventId:a}=e.data,l=o.pointerId,d=o.pointerType,{cancelable:c,timestamp:h}=e;return{type:t,x:i,y:n,pointerId:l,pointerType:d,button:s,buttons:r,native:o,timestamp:h,eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:i,buttons:n,native:s,eventId:r}=e.data.currentEvent,{button:o}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,d=e.data.action,c={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:h,timestamp:u}=e;return{type:"pointer-drag",x:t,y:i,pointerId:a,pointerType:l,button:o,buttons:n,action:d,origin:c,native:s,timestamp:u,eventId:r,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:n}=e,{x:s,y:r,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:r,deltaY:o,native:a,timestamp:n,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:i,device:n}=e.data,{cancelable:s,timestamp:r}=e,{buttons:o,axes:a}=i;return{type:"gamepad",device:n,timestamp:r,action:t,buttons:o,axes:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function es(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,function(e){return e&&"focus"in e}(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function ts(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function is(e){return(0,w.c)(e.x,e.y)}function ns(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,w.c)(t.clientX-i.left,t.clientY-i.top)}function ss(e,t){return t instanceof Event?ns(e,t):is(t)}function rs(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}class os{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":as(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!ls(e))break;const n=is(e),s=this._intersect(n,e.pointerType,t.forEachTool);if((0,a.t)(s))break;const r=this._findToolAndManipulatorByKey(s,t.forEachTool,ds),o=(0,a.x)(r,(e=>e.manipulator)),l=(0,a.x)(r,(e=>e.tool));!((0,a.r)(o)&&(0,a.r)(l)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,l,e),(0,a.r)(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:s,start:n}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",screenPoint:n}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!ls(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=this._draggedManipulators.get(e.pointerId),r=(0,a.x)(n||s,(({key:e})=>e)),o=this._findManipulatorByKey(r,t.forEachTool);if((0,a.t)(o))break;const l=is(e);l.x=(0,M.o)(l.x,0,t.view.width),l.y=(0,M.o)(l.y,0,t.view.height);const d=(0,a.f)(n||s).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,s?o.events.emit("drag",{action:"update",start:d,screenPoint:l}):o.events.emit("drag",{action:"start",start:d,screenPoint:l,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:(0,a.f)(r),start:d}));break;case"end":o.dragging=!1,s&&o.events.emit("drag",{action:"end",start:d,screenPoint:l}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const n=is(e),s=this._intersect(n,e.pointerType,t.forEachTool),r=this._findToolAndManipulatorByKey(s,t.forEachTool,ds);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((!(0,a.r)(r)||r.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),(0,a.t)(r))break;const{manipulator:o,tool:l}=r;if(!o.interactive)break;o.selectable&&!l.selectionManagementDisabled&&(o.selected=!o.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const d=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:d,stopPropagation:i});break}case"click":{const n=is(e),s=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(s,t.forEachTool);if((0,a.t)(r)||!r.interactive)break;const o=e.native.shiftKey;r.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:o}),i();break}case"double-click":{const n=is(e),s=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(s,t.forEachTool);if((0,a.t)(r)||!r.interactive)break;const o=e.native.shiftKey;r.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const n=is(e),s=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(s,t.forEachTool);if((0,a.t)(r)||!r.interactive)break;const o=e.native.shiftKey;r.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}}this._updateCursor(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:is(i)}),this._grabbedManipulators.forEach((({key:i},n)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(n)}))}_handlePointerEnd(e,t){const i=(0,a.x)(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),n=this._findManipulatorByKey(i,t.forEachTool);if((0,a.r)(n)&&!n.dragging){const s=(0,a.r)(t.creatingTool)&&t.creatingTool===(0,a.f)(i).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||s||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:is(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let i=null;return Rn(e,(({key:e})=>{const n=this._findManipulatorByKey(e,t);return!!((0,a.r)(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(i=n.cursor,!0)})),i}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,i=!0,n){const s=t=>t.tool===e&&((0,a.t)(n)||t.manipulatorId===n);this._grabbedManipulators.forEach((({key:e},i)=>{if(s(e)){this._grabbedManipulators.delete(i);const n=this._findManipulatorByKey(e,t);(0,a.r)(n)&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(s(e)){this._draggedManipulators.delete(i);const n=this._findManipulatorByKey(e,t);(0,a.r)(n)&&(n.dragging=!1,n.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(s(e)){this._hoveredManipulators.delete(i);const n=this._findManipulatorByKey(e,t);(0,a.r)(n)&&(n.hovering=!1)}})),this._updateCursor(t)}_intersect(e,t,i){let n=null;return i((i=>{if(null==i.manipulators||!ts(i))return!1;const s=i.manipulators.intersect(e,t);return!(0,a.t)(s)&&(n={manipulatorId:s.id,tool:i},!0)})),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition((0,w.c)(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!as(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(is(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,n){const s=this._intersect(e,i,n);let r=this._findManipulatorByKey(s,n);const o=(0,a.x)(this._hoveredManipulators.get(t),(({key:e})=>e)),l=this._findManipulatorByKey(o,n);(0,a.r)(r)&&!r.interactive&&(r=null),l!==r&&((0,a.r)(l)&&(l.hovering=!1),(0,a.r)(r)?(r.hovering=!0,this._hoveredManipulators.set(t,{key:(0,a.f)(s)})):this._hoveredManipulators.delete(t),this._updateCursor(n))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,ds)?ds.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return(0,a.t)(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!ts(t))return!1;const n=t.manipulators.findById(e.manipulatorId);return!!(0,a.r)(n)&&(i.manipulator=n,i.tool=t,!0)})),i.manipulator?i:null)}}function as(e){return"mouse"===e}function ls(e){return"mouse"!==e.pointerType||0===e.button}const ds={manipulator:null,tool:null},cs=a.n.getLogger("esri.views.ToolViewManager"),hs="manipulators",us="tools";let ps=class extends f.d{constructor(e){super(e),this._creatingTool=null,this._manipulatorState=new os,this.tools=function(){const e=new h.L;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;es(t,!1),t.destroyed||t.detach()})),e}(),this.cursor=null,this._forEachTool=e=>{if(!(0,a.r)(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this.handles.add([this.view.on(Zn,(e=>{this._handleInputEvent(e)}),Mi.TOOL),this.tools.on("before-add",(e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(cs.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((e=>e.destroy()))}set activeTool(e){!(0,a.r)(e)||this.view.ready?(function(e,t,i){const n=e.activeTool;t!==n&&((0,a.r)(n)&&n.deactivate&&n.deactivate(),i(t),(0,a.r)(t)&&t.activate&&t.activate())}(this,e,(t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool((e=>{const t=(0,a.t)(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const i=ts(e);!(0,a.t)(this.activeTool)&&i||this._manipulatorState.clearPointers(e,this._forEachTool,!i)})),this._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):cs.error("#activeTool=","cannot set active tool while view is not ready")}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))}async createTool(e,t,i){const s="Tool creation was interrupted by another tool being created",{abortHandle:o,tool:d}=await this.updatingHandles.addPromise((async()=>{await this.view.whenReady(),(0,l.a)(i,s);const n=(0,l.v)(i,(()=>this.activeTool=null)),r=function(e){return(0,a.t)(e)?{}:"function"==typeof e?e():e}(t),o=new e({...r,view:this.view});return await o.whenCreationStarted(),(0,l.a)(i,s),{abortHandle:n,tool:o}})());return this._rejectCreatingTool(s),this._creatingTool=d,d.attach(),this._refreshToolWatchers(),es(d,!0),await d.when(),(0,a.r)(o)&&o.remove(),this._creatingTool=null,(0,l.a)(i,s),this.tools.add(d),d instanceof n.p&&null!=d.completed&&(0,r.j)(d,"completed").then((()=>{es(d,!1)})),d}attach(){this._forEachTool((e=>e.attach())),"3d"===this.view.type?this.handles.add([this.view.state.watch("camera",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this.forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))}))],hs):this.handles.add(this.view.watch("extent",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){this.activeTool=null,this._forEachTool((e=>{e.detach(),e.destroy()})),this.tools.removeAll(),this.handles.remove(hs)}forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};(0,a.r)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&(0,a.r)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(us),this._forEachTool((e=>{if(e instanceof n.p){const t=(0,r.h)(e,["cursor","visible","editable"],(()=>{ts(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this.handles.add(t,us)}e.manipulators&&this.handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),us)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool((t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0))),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;(0,a.t)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation((0,l.m)(e)),es(t,!1),"destroyed"!==t.toolState&&t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter((t=>((0,a.t)(e)||t!==e)&&null!=t.completed&&!t.completed)).forEach((e=>{this.tools.remove(e)}))}};(0,n.e)([(0,o.y)({constructOnly:!0,nonNullable:!0})],ps.prototype,"view",void 0),(0,n.e)([(0,o.y)({value:null})],ps.prototype,"activeTool",null),(0,n.e)([(0,o.y)({readOnly:!0,type:h.L})],ps.prototype,"tools",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],ps.prototype,"cursor",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],ps.prototype,"updating",null),ps=(0,n.e)([(0,o.n)("esri.views.ToolViewManager")],ps);var fs=ps;let ms=class extends n.p{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":gs.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return ys[this.deviceType]}};(0,n.e)([(0,o.y)({nonNullable:!0,readOnly:!0})],ms.prototype,"nativeIndex",void 0),(0,n.e)([(0,o.y)({type:String,readOnly:!0})],ms.prototype,"deviceType",null),(0,n.e)([(0,o.y)({type:Number,readOnly:!0})],ms.prototype,"axisThreshold",null),ms=(0,n.e)([(0,o.n)("esri.views.input.gamepad.GamepadInputDevice")],ms);const gs=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),ys={standard:.15,spacemouse:.025,unknown:0};var vs=ms;let _s=class extends n.p{constructor(...e){super(...e),this.devices=new h.L,this.enabledFocusMode="document"}};(0,n.e)([(0,o.y)({type:h.L.ofType(vs),readOnly:!0})],_s.prototype,"devices",void 0),(0,n.e)([(0,o.y)({type:["document","view","none"]})],_s.prototype,"enabledFocusMode",void 0),_s=(0,n.e)([(0,o.n)("esri.views.input.gamepad.GamepadSettings")],_s);var ws=_s;let bs=class extends n.p{constructor(){super(...arguments),this.gamepad=new ws}};(0,n.e)([(0,o.y)({readOnly:!0})],bs.prototype,"gamepad",void 0),bs=(0,n.e)([(0,o.n)("esri.views.input.Input")],bs);var Ms=bs;let Is=class extends n.p{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,n.e)([(0,o.y)({type:Boolean,nonNullable:!0})],Is.prototype,"enabled",void 0),(0,n.e)([(0,o.y)({type:vs})],Is.prototype,"device",void 0),(0,n.e)([(0,o.y)({type:["pan","zoom"],nonNullable:!0})],Is.prototype,"mode",void 0),(0,n.e)([(0,o.y)({type:["forward-down","forward-up"],nonNullable:!0})],Is.prototype,"tiltDirection",void 0),(0,n.e)([(0,o.y)({type:Number,nonNullable:!0})],Is.prototype,"velocityFactor",void 0),Is=(0,n.e)([(0,o.n)("esri.views.navigation.gamepad.GamepadSettings")],Is);var Cs=Is;let xs=class extends n.p{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Cs,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};(0,n.e)([(0,o.y)({type:Boolean})],xs.prototype,"browserTouchPanEnabled",void 0),(0,n.e)([(0,o.y)({type:Cs,nonNullable:!0})],xs.prototype,"gamepad",void 0),(0,n.e)([(0,o.y)({type:Boolean})],xs.prototype,"momentumEnabled",void 0),(0,n.e)([(0,o.y)({type:Boolean})],xs.prototype,"mouseWheelZoomEnabled",void 0),xs=(0,n.e)([(0,o.n)("esri.views.navigation.Navigation")],xs);var ks=xs;function Ps(e,t,i){const n=As(e),s=t,r=function(e,t,i){if(!Ts(e)||!Ts(t))return 4;if(null==e||null==t)return 0;if(!i&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}(n,s,i);{let t=null;if(n){const s=y.v.deriveUnitFromSR(n,e.spatialReference).heightUnit;i||s===n.heightUnit||(t=new l.s("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${s})`,{horizontalUnit:s}))}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!Ls(e)}(e)||4===r||t)return new l.s("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n,error:t})}{let e=null;switch(r){case 1:{const t=n.heightUnit||"unknown",i=s.heightUnit||"unknown";e=new l.s("layerview:incompatible-height-unit",`The vertical units of the layer (${t}) must match the vertical units of the scene (${i})`,{layerUnit:t,sceneUnit:i});break}case 2:{const t=n.heightModel||"unknown",i=s.heightModel||"unknown";e=new l.s("layerview:incompatible-height-model",`The height model of the layer (${t}) must match the height model of the scene (${i})`,{layerHeightModel:t,sceneHeightModel:i});break}case 3:{const t=n.vertCRS||"unknown",i=s.vertCRS||"unknown";e=new l.s("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${t}) must match the vertical datum of the scene (${i})`,{layerDatum:t,sceneDatum:i});break}}if(e)return new l.s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:s,error:e})}return null}function Ts(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function As(e){const t=e.url&&(0,N.d)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&(0,a.r)(t)&&"ImageServer"===t.serverType||!Es(e)||!e.heightModelInfo?Ls(e)?y.v.deriveUnitFromSR(Os,e.spatialReference):null:e.heightModelInfo}function Es(e){return"heightModelInfo"in e}function Fs(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function Ls(e){return Fs(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Ss(e)}function Ds(e){return null!=e.layers||Ss(e)||Fs(e)||Es(e)}function Ss(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":case"slice":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"direct-line-measurement":case"area-measurement":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const Os=new y.v({heightModel:"gravity-related-height"});var Vs;const Rs=a.n.getLogger("esri.views.support.DefaultsFromMap");let Ns=Vs=class extends n.p{constructor(){super(...arguments),this._handles=new s.u,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=Vs.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add((0,r.C)(this.view,`map.${t}`,"change",e,e,e,!0));this._handles.add((0,r.y)(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let i;for(let n=0;n<t.length&&(i=this.get(t.slice(0,n+1).join(".")),i);n++)if(i.load&&!i.isFulfilled())return{collectionName:e,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:e,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,i=!1;const n=e.catch((()=>{})).then((()=>{t?i=!0:n===this._waitTask&&this._update()}));return t=!1,i||(this._waitTask=n),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections((e=>this._processSpatialReferenceSource(e)));if(this._debugLog(`Search ended with status '${Bs(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${zs(e)})`)):(this.defaultSpatialReference&&t.length>1&&t.findIndex((e=>e.equals(this.defaultSpatialReference)))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog(`Locking to ${zs(e)}`)),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((t=>this._findExtent(t,e))),this.logDebugInformation=t,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections((e=>this._processHeightModelInfoSource(e)),(e=>Ds(e)));this._debugLog(`Search ended with status ${Bs(e)}`),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let i=2;return this._forAllMapCollectionSources((e=>{if(2!==i)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading)&&(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),i=0,1))}),(n=>!(2!==i||(null==t||t(n)?!n.load||n.isFulfilled()||this._updateWhen(n.load())?(!n.load||n.isResolved())&&e(n)&&(i=1,1):(this._debugLog(`Source ${n.id} is loading -> wait`),i=0,1):(this._debugLog(`Source ${n.id} is skipped due to predicate`),1))))),i}_preloadMapCollections(e){let t=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(n=>0!==t&&!(null!=e&&!e(n)||(n.load&&!n.isFulfilled()&&(this.logDebugInformation=i,this._debugLog(`Pre-loading source ${n.id}`),this.logDebugInformation=!1,n.load().catch((()=>{})),t--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(e,t){for(const i of this.mapCollectionPaths){const n=`map.${i}`,s=this._ensureLoadedOwnersFromCollectionName(n);if(!1===e(s))continue;const r=s.owner;if(!r||r.isRejected&&r.isRejected()){this._debugLog(`Collection ${n} owner is invalid or rejected -> skip`);continue}const o=this.view.get(n);o?this._forEachSource(o,t):this._debugLog(`Collection ${n} does not exist -> skip`)}}_forEachSource(e,t){for(const i of e.items)!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=(0,n.q)(t,this._spatialReferenceCandidates,((e,t)=>e.equals(t))),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const i="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),n=i.find((e=>e.spatialReference.equals(t)));if(n)return this._set("extent",n),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=i.map((t=>({extent:t,layer:e}))),n=this._extentCandidates||[];this._extentCandidates=n.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=this._extentCandidates.find((t=>(0,x.x)(t.extent.spatialReference,e)));if(t)this._set("extent",(0,x.g)(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=(0,l.h)();const n=await Promise.resolve().then(i.bind(i,41392));try{const i=await n.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",i)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const i=t.filter((t=>this.view.isSpatialReferenceSupported(t,e,(e=>this._debugLog(e)))));return 0===i.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${i.map(zs).join(", ")}`),i}_processHeightModelInfoSource(e){const t=As(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,i=e.get("layers.0");let n=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");n="tileInfo"in e&&e.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in i&&i.tileInfo}n&&!n.spatialReference.equals(this.spatialReference)&&(n=null),this._debugLog(`updateTileInfo: setting ${n}`),this._set("tileInfo",n),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&Rs.info(e)}};function zs(e){return e?JSON.stringify(e.toJSON()):"undefined"}function Bs(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}Ns.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],(0,n.e)([(0,o.y)()],Ns.prototype,"logDebugInformation",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"isSpatialReferenceDone",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"isTileInfoDone",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"isHeightModelInfoSearching",void 0),(0,n.e)([(0,o.y)({constructOnly:!0})],Ns.prototype,"view",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"spatialReference",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"extent",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"heightModelInfo",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"vcsWkid",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"latestVcsWkid",void 0),(0,n.e)([(0,o.y)()],Ns.prototype,"mapCollectionPaths",void 0),(0,n.e)([(0,o.y)()],Ns.prototype,"defaultSpatialReference",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ns.prototype,"tileInfo",void 0),Ns=Vs=(0,n.e)([(0,o.n)("esri.views.support.DefaultsFromMap")],Ns);var Hs,Us=Ns;const $s=a.n.getLogger("esri.views.View");let Ws=Hs=class extends((0,f.a)(p.n.EventedMixin((0,p.d)(n.p)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new u.p({getCollections:()=>{var e,t,i;return[null==(e=this.basemapView)?void 0:e.baseLayerViews,null==(t=this.groundView)?void 0:t.layerViews,this.layerViews,null==(i=this.basemapView)?void 0:i.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.defaultsFromMap=new Us({view:this}),this.fatalError=null,this.extent=null,this.graphics=new _.u,this.navigating=!1,this.layerViews=new h.L,this.magnifier=new Wn,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new Ms,this.navigation=new ks,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Qn(this),this.persistableViewModels=new h.L,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(e=>{e?(this._currentSpatialReference=this.spatialReference,Hs.views.add(this)):(this._currentSpatialReference=null,Hs.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let e;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,(0,r.j)(this,"ready"))))),this.basemapView=new Vn({view:this}),this.layerViewManager=new Un({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.refreshManager=new Kn({view:this}),this.toolViewManager=new fs({view:this}),this._resetInitialViewPropertiesFromContent(),(0,r.d)(this.defaultsFromMap,"isSpatialReferenceDone",(t=>{const i=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&i||!e){if(t&&!this.spatialReference&&i&&!e){const t=e=(0,l.C)(this.spatialReferenceWarningDelay);e.then((()=>{t===e&&$s.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else e=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return $s.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!p.f.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&($s.warn("#map","The provided map is already destroyed",{map:e}),e=null),p.f.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return(0,a.r)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new l.s("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,i){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&$s.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,(0,r.$)(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}createTool(e,t,i){return this.toolViewManager.createTool(e,t,i)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([(0,r.h)(this,"spatialReference",((t,i)=>{(0,v.d)(t,i)||e()})),(0,r.h)(this,"initialExtentRequired",e),(0,n.j)(e)],"defaultsFromMap")}};Ws.views=new h.L,(0,n.e)([(0,m.o)("toolViewManager.activeTool")],Ws.prototype,"activeTool",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"allLayerViews",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"groundView",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"animation",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"basemapView",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"defaultsFromMap",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"fatalError",void 0),(0,n.e)([(0,o.y)({type:g.M})],Ws.prototype,"extent",void 0),(0,n.e)([(0,o.y)((0,_.m)())],Ws.prototype,"graphics",void 0),(0,n.e)([(0,o.y)({readOnly:!0,type:y.v,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],Ws.prototype,"heightModelInfo",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"interacting",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"navigating",void 0),(0,n.e)([(0,o.y)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],Ws.prototype,"preconditionsReady",null),(0,n.e)([(0,o.y)({type:h.L,readOnly:!0})],Ws.prototype,"layerViews",void 0),(0,n.e)([(0,o.y)({type:Wn})],Ws.prototype,"magnifier",void 0),(0,n.e)([(0,o.y)({value:null,type:d.j})],Ws.prototype,"map",null),(0,n.e)([(0,o.y)()],Ws.prototype,"padding",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"ready",void 0),(0,n.e)([(0,o.y)({type:v.k})],Ws.prototype,"spatialReference",null),(0,n.e)([(0,o.y)()],Ws.prototype,"spatialReferenceWarningDelay",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"stationary",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"supportsGround",void 0),(0,n.e)([(0,o.y)({type:c.y})],Ws.prototype,"timeExtent",void 0),(0,n.e)([(0,m.o)("toolViewManager.tools")],Ws.prototype,"tools",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"toolViewManager",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"type",void 0),(0,n.e)([(0,o.y)({type:Number})],Ws.prototype,"scale",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"updating",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"initialExtentRequired",void 0),(0,n.e)([(0,o.y)({readOnly:!0,type:g.M})],Ws.prototype,"initialExtent",null),(0,n.e)([(0,o.y)()],Ws.prototype,"cursor",null),(0,n.e)([(0,o.y)()],Ws.prototype,"renderContext",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"input",void 0),(0,n.e)([(0,o.y)({type:ks,nonNullable:!0})],Ws.prototype,"navigation",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"layerViewManager",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"width",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"height",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"resizing",void 0),(0,n.e)([(0,o.y)({value:null,readOnly:!0})],Ws.prototype,"size",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"suspended",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"viewEvents",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Ws.prototype,"persistableViewModels",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"_isValid",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"_readyCycleForced",void 0),(0,n.e)([(0,o.y)()],Ws.prototype,"_currentSpatialReference",void 0),Ws=Hs=(0,n.e)([(0,o.n)("esri.views.View")],Ws);var js=Ws;let Gs=class extends p.m{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((e,t)=>this._dfd={resolve:e,reject:t})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new l.s("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=(0,l.U)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};(0,n.e)([(0,o.y)({readOnly:!0})],Gs.prototype,"done",null),(0,n.e)([(0,o.y)({readOnly:!0,type:String})],Gs.prototype,"state",void 0),(0,n.e)([(0,o.y)()],Gs.prototype,"target",void 0),Gs=(0,n.e)([(0,o.n)("esri.views.ViewAnimation")],Gs),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Gs||(Gs={}));var qs=Gs;function Ks(){return[1,0,0,1,0,0]}Object.freeze({__proto__:null,create:Ks,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,i,n,s,r){return[e,t,i,n,s,r]},createView:function(e,t){return new Float64Array(e,t,6)}});const Zs=180/Math.PI;function Ys(e,t,i,n){return n&&i&&!n.equals(i)&&(0,x.x)(n,i)&&n.isWebMercator?n.isWebMercator?function(e,t){let i=t[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin((0,M.r)(i)),(0,$.r)(e,(0,M.r)(t[0])*x.s.radius,.5*x.s.radius*Math.log((1+i)/(1-i)))}(e,t):function(e,t,i){const n=(0,M.b)(t[0]/x.s.radius);return(0,$.r)(e,n-360*Math.floor((n+180)/360),(0,M.b)(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/x.s.radius))))}(e,t):(0,$.a)(e,t)}function Xs(e){return e.wkid?e:e.spatialReference||v.k.WGS84}function Qs(e,t){return t.type?(0,$.r)(e,t.x,t.y):(0,$.a)(e,t)}function Js(e){return(0,k.G)(e)}function er(e,t){return Math.max(e.width/t[0],e.height/t[1])*function(e){return(0,v.s)(e)?39.37*Js(e)*96:1}(e.spatialReference)}async function tr(e,t,i,n){let s,r;if(!e)return null;if(Array.isArray(e)&&!e.length)return null;if(h.L.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&"object"==typeof e[0]){const s=e.every((e=>"attributes"in e)),r=e.some((e=>!e.geometry));let o=e;if(s&&r&&t&&t.allLayerViews){const i=new Map;for(const t of e){const e=t.layer,n=i.get(e)||[],s=t.attributes[e.objectIdField];null!=s&&n.push(s),i.set(e,n)}const n=[];i.forEach(((e,i)=>{const s=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in s){const t=i.createQuery();t.objectIds=e,t.returnGeometry=!0,n.push(s.queryFeatures(t))}}));const s=await Promise.all(n),r=[];for(const e of s)if(e&&e.features&&e.features.length)for(const t of e.features)(0,a.r)(t.geometry)&&r.push(t.geometry);o=r}for(const e of o)n=await tr(e,t,i,n);return n}if(Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])s=new x.b(e);else if(e instanceof x.p)s=e;else if("geometry"in e)if(e.geometry)s=e.geometry;else if(e.layer){const i=e.layer,n=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in n){const t=i.createQuery();t.objectIds=[e.attributes[i.objectIdField]],t.returnGeometry=!0;const r=await n.queryFeatures(t);s=(0,a.g)(r,"features",0,"geometry")}}if((0,a.t)(s))return null;if(r="point"===s.type?new g.M({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference}):s.extent,!r)return null;const o=(0,x.x)(r,i);if(!r.spatialReference.equals(i)&&o)r=(0,x.g)(r,i);else if(!o)return null;return n?n.union(r):r.clone()}function ir(e,t){const i=e.targetGeometry,n=t.targetGeometry;return i.x=n.x,i.y=n.y,i.spatialReference=n.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function nr(e,t,i){return i?(0,$.r)(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):(0,$.l)(e,t,.5)}const sr=function(){const e=(0,W.n)();return function(t,i,n){const s=i.targetGeometry;Qs(e,s);const r=.5*lr(i);return t.xmin=e[0]-r*n[0],t.ymin=e[1]-r*n[1],t.xmax=e[0]+r*n[0],t.ymax=e[1]+r*n[1],t.spatialReference=s.spatialReference,t}}();function rr(e,t,i,n,s){return yr(e,t,i.center),e.scale=er(i,n),s&&s.constraints&&s.constraints.constrain(e),e}const or=function(){const e=(0,W.n)();return function(t,i,n){return(0,$.C)(t,function(e,t){return(0,$.l)(e,t,.5)}(t,i),nr(e,i,n))}}(),ar=function(){const e=[1,0,0,1,0,0],t=(0,W.n)();return function(i,n,s,r){const o=lr(n),a=dr(n);return(0,$.r)(t,o,o),(0,H.M)(e,t),(0,H.c)(e,e,a),(0,H.i)(e,e,or(t,s,r)),(0,H.i)(e,e,[0,r.top-r.bottom]),(0,$.r)(i,e[4],e[5])}}();function lr(e){return e.scale*function(e){return(0,a.r)(e)&&(0,v.s)(e.spatialReference)?1/(39.37*Js(e.spatialReference)*96):1}(e.targetGeometry)}function dr(e){return(0,M.r)(e.rotation)||0}const cr=function(){const e=(0,W.n)(),t=(0,W.n)(),i=(0,W.n)();return function(n,s,r,o,a,l){return(0,$.p)(e,s),(0,$.l)(t,r,.5*l),(0,$.r)(i,1/o*l,-1/o*l),(0,H.n)(n),(0,H.i)(n,n,t),a&&(0,H.c)(n,n,a),(0,H.e)(n,n,i),(0,H.i)(n,n,e),n}}(),hr=function(){const e=(0,W.n)();return function(t,i,n,s){const r=lr(i),o=dr(i);return Qs(e,i.targetGeometry),cr(t,e,n,r,o,s)}}(),ur=function(){const e=(0,W.n)();return function(t,i,n,s){const r=lr(i);return Qs(e,i.targetGeometry),cr(t,e,n,r,0,s)}}();function pr(e){if(e.isWrappable){const t=(0,v.S)(e);return t.valid[1]-t.valid[0]}return 0}function fr(e,t){return async function(e,t){if(!e||!t)return new Sn({targetGeometry:new x.b,scale:0,rotation:0});let i=t.spatialReference;const{constraints:n,padding:s,viewpoint:r,size:o}=t,l=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let d=null;e instanceof Sn?d=e:e.viewpoint?d=e.viewpoint:e.target&&"esri.Viewpoint"===e.target.declaredClass&&(d=e.target);let c=null;d&&d.targetGeometry?c=d.targetGeometry:e instanceof g.M?c=e:(e||e&&("center"in e||"extent"in e||"target"in e))&&(c=await tr(e.center,t,i)||await tr(e.extent,t,i)||await tr(e.target,t,i)||await tr(e,t,i)),!c&&r&&r.targetGeometry?c=r.targetGeometry:!c&&t.extent&&(c=t.extent);const h=Xs(c);if(i||(i=Xs(t.spatialReference||t.extent||c)),!(0,x.x)(c,i)&&h&&!h.equals(i))return null;const u=Qs((0,W.n)(),c.center?c.center:c),p=new x.b(Ys(u,u,h,i),i);let f=null;f=d&&(0,a.r)(d.targetGeometry)&&"point"===d.targetGeometry.type?d.scale:e.hasOwnProperty("scale")&&e.scale?e.scale:e.hasOwnProperty("zoom")&&-1!==e.zoom&&n&&n.effectiveLODs?n.zoomToScale(e.zoom):Array.isArray(c)||"point"===c.type||"extent"===c.type&&0===c.width&&0===c.height?t.extent&&(0,x.x)(t.extent,i)?er((0,x.g)(t.extent,i),l):t.extent?er(t.extent,l):r.scale:(0,x.x)(c.extent,i)?er((0,x.g)(c.extent,i),l):er(c.extent,l);const m=function(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){const t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((e=>"layer"in e))){let t=0,i=0;for(const n of e){const e=n.layer;e&&e.minScale&&e.maxScale&&(t=e.minScale<t?e.minScale:t,i=e.maxScale>i?e.maxScale:i)}return t&&i?{min:t,max:i}:null}}}(e);m&&(m.min&&m.min>f?f=m.min:m.max&&m.max<f&&(f=m.max));let y=0;d?y=d.rotation:e.hasOwnProperty("rotation")?y=e.rotation:r&&(y=r.rotation);let v=new Sn({targetGeometry:p,scale:f,rotation:y});return n&&(v=n.fit(v),n.constrainByGeometry(v),n.rotationEnabled||(v.rotation=y)),v}(e,t)}const mr=function(){const e=(0,W.n)(),t=(0,W.n)(),i=[0,0,0];return function(n,s,r){(0,$.o)(e,n,s),(0,$.g)(e,e),(0,$.o)(t,n,r),(0,$.g)(t,t),(0,$.j)(i,e,t);let o=Math.acos((0,$._)(e,t)/((0,$.b)(e)*(0,$.b)(t)))*Zs;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),gr=function(){const e=(0,W.n)();return function(t,i,n,s){const r=t.targetGeometry;return ir(t,i),ar(e,i,n,s),r.x+=e[0],r.y+=e[1],t}}(),yr=function(){const e=(0,W.n)();return function(t,i,n){ir(t,i);const s=t.targetGeometry,r=Xs(n),o=Xs(s);return Qs(e,n),Ys(e,e,r,o),s.x=e[0],s.y=e[1],t}}(),vr=function(){const e=(0,W.n)();return function(t,i,n,s,r){r||(r="center"),(0,$.C)(e,n,s),(0,$.l)(e,e,.5);const o=e[0],a=e[1];switch(r){case"center":(0,$.r)(e,0,0);break;case"left":(0,$.r)(e,-o,0);break;case"top":(0,$.r)(e,0,a);break;case"right":(0,$.r)(e,o,0);break;case"bottom":(0,$.r)(e,0,-a);break;case"top-left":(0,$.r)(e,-o,a);break;case"bottom-left":(0,$.r)(e,-o,-a);break;case"top-right":(0,$.r)(e,o,a);break;case"bottom-right":(0,$.r)(e,o,-a)}return Pr(t,i,e),t}}();function _r(e,t,i){return ir(e,t),e.rotation+=i,e}function wr(e,t,i){return ir(e,t),e.rotation=i,e}const br=function(){const e=(0,W.n)();return function(t,i,n,s,r){return ir(t,i),isNaN(n)||0===n||(xr(e,s,i,r),t.scale=i.scale*n,kr(e,e,t,r),Pr(t,t,(0,$.r)(e,e[0]-s[0],s[1]-e[1]))),t}}();function Mr(e,t,i){return ir(e,t),e.scale=i,e}const Ir=function(){const e=(0,W.n)();return function(t,i,n,s,r,o){return ir(t,i),isNaN(n)||0===n||(xr(e,r,i,o),t.scale=i.scale*n,t.rotation+=s,kr(e,e,t,o),Pr(t,t,(0,$.r)(e,e[0]-r[0],r[1]-e[1]))),t}}(),Cr=function(){const e=(0,W.n)(),t=(0,W.n)();return function(i,n,s,r,o,a,l){return or(t,a,l),(0,$.s)(e,o,t),r?Ir(i,n,s,r,e,a):br(i,n,s,e,a)}}(),xr=function(){const e=[1,0,0,1,0,0];return function(t,i,n,s){return(0,$.D)(t,i,function(e,t,i,n){return hr(e,t,i,1),(0,H.r)(e,e)}(e,n,s))}}(),kr=function(){const e=[1,0,0,1,0,0];return function(t,i,n,s){return(0,$.D)(t,i,hr(e,n,s,1))}}(),Pr=function(){const e=(0,W.n)(),t=[1,0,0,1,0,0];return function(i,n,s){ir(i,n);const r=lr(n),o=i.targetGeometry;return(0,H.h)(t,dr(n)),(0,H.e)(t,t,(0,W.t)(r,r)),(0,$.D)(e,s,t),o.x+=e[0],o.y+=e[1],i}}();function Tr(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function Ar(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Er(e,t,i,n,s,r,o,a,l){const d=new Float32Array(9);return d[0]=e,d[1]=t,d[2]=i,d[3]=n,d[4]=s,d[5]=r,d[6]=o,d[7]=a,d[8]=l,d}function Fr(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}var Lr;Object.freeze({__proto__:null,create:Tr,clone:Ar,fromValues:Er,createView:function(e,t){return new Float32Array(e,t,9)}});const Dr=[0,0];let Sr=Lr=class extends n.a{constructor(e){super(e),this._viewpoint2D={center:(0,W.n)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new g.M,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=Tr(),this.displayViewMat3=Tr(),this.viewMat3=Tr(),this.viewMat2d=(0,H.a)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=ir(i,e.viewpoint),this._set("size",(0,$.a)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Lr({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Fr(t)?(0,$.D)(e,t,this.inverseTransform):(Dr[0]=t,Dr[1]=i,(0,$.D)(e,Dr,this.inverseTransform))}toScreen(e,t,i){return Fr(t)?(0,$.D)(e,t,this.transform):(Dr[0]=t,Dr[1]=i,(0,$.D)(e,Dr,this.transform))}toScreenNoRotation(e,t,i){return Fr(t)?(0,$.D)(e,t,this.transformNoRotation):(Dr[0]=t,Dr[1]=i,(0,$.D)(e,Dr,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size");return cr(e,i,s,t,0,n),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:n}=this._viewpoint2D,s=this._get("pixelRatio")||1,r=this._get("size"),o=new Sn({targetGeometry:new x.b(e[0],e[1],t),scale:i,rotation:n});if(this._set("viewpoint",o),!r||!t||!i)return;this.resolution=lr(o),this.rotation=n,this.scale=i,this.spatialReference=t,(0,$.a)(this.center,e);const a=0!==r[0]?2/r[0]:0,l=0!==r[1]?-2/r[1]:0;(0,U.s)(this.displayMat3,a,0,0,0,l,0,-1,1,1);const d=(0,U.r)(this.viewMat3),c=(0,H.t)(r[0]/2,r[1]/2),h=(0,H.t)(-r[0]/2,-r[1]/2),u=(0,M.r)(n);(0,U.M)(d,d,c),(0,U.h)(d,d,u),(0,U.M)(d,d,h),(0,U.i)(this.displayViewMat3,this.displayMat3,d);const p=(0,H.n)(this.viewMat2d);return(0,H.i)(p,p,c),(0,H.c)(p,p,u),(0,H.i)(p,p,h),sr(this.extent,o,r),hr(this.transform,o,r,s),(0,H.r)(this.inverseTransform,this.transform),ur(this.transformNoRotation,o,r,s),this.worldScreenWidth=function(e,t){return Math.round(pr(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};(0,n.e)([(0,o.y)({readOnly:!0})],Sr.prototype,"id",void 0),(0,n.e)([(0,o.y)({value:1,json:{write:!0}})],Sr.prototype,"pixelRatio",null),(0,n.e)([(0,o.y)({json:{write:!0}})],Sr.prototype,"size",null),(0,n.e)([(0,o.y)({type:Sn,json:{write:!0}})],Sr.prototype,"viewpoint",null),Sr=Lr=(0,n.e)([(0,o.n)("esri.views.2d.ViewState")],Sr);var Or=Sr;function Vr(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}function Rr(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}class Nr{constructor(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this.currentCount=i,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e}emitStart(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}emitUpdate(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}emitEnd(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}function zr(e){let t=e*e;return e<0&&(t*=-1),t}function Br(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function Hr(e,t,i){const n=i,s=e.state,r=e.device,o="forward-down"===t.tiltDirection?1:-1;return"standard"===r.deviceType?(n.translation[0]=zr(s.axes[0]),n.translation[1]=zr(s.axes[1]),n.translation[2]=zr(s.buttons[7])-zr(s.buttons[6]),n.heading=zr(s.axes[2]),n.tilt=zr(s.axes[3])):"spacemouse"===r.deviceType&&(n.translation[0]=1.2*zr(s.axes[0]),n.translation[1]=1.2*zr(s.axes[1]),n.translation[2]=2*-zr(s.axes[2]),n.heading=1.2*zr(s.axes[5]),n.tilt=1.2*zr(s.axes[3])),n.tilt*=o,(0,M.d)(n.translation,n.translation,1),n}function Ur(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function $r(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}function Wr(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value?e.value:1:0)),axes:t.axes.map((t=>function(e,t){const i=Math.abs(e);return i<t?0:(0,M.e)(e)*(i-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class jr{constructor(e,t){this.element=e,this.input=t,this._hasEventListeners=!1,this.onConnectGamepad=e=>{this.connectGamepad(e.gamepad)},this.onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,n=this.inputDevices[i];n&&(this.emitGamepadEvent(t,Wr(n),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(n),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this.callback=e}connectGamepad(e){const t=new vs(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=(0,n.A)({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const e=document.hasFocus(),t=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!t;this.forEachGamepad((e=>{const t=this.inputDevices[e.index];if(!t)return;const n=this.latestUpdate[e.index],s=Wr(t),r=i||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(s);if(n){if(n.timestamp===e.timestamp)return;if(!n.active&&r)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(n.state,s))return}this.emitGamepadEvent(e,s,!r)}))}forEachGamepad(e){const t=window.navigator.getGamepads();for(let i=0;i<t.length;i++){const n=t[i];this.validate(n)&&e(n)}}emitGamepadEvent(e,t,i){const n=this.latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const r=!s&&i?"start":s&&i?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:r})}validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}const Gr=(0,a.c)("trident"),qr=(0,a.c)("edge"),Kr=(0,a.c)("chrome"),Zr=(0,a.c)("ff"),Yr=(0,a.c)("safari"),Xr="esri-view-surface--touch-none",Qr="esri-view-surface--touch-pan";class Jr{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new jr(e,this.input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(eo[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&eo[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(eo[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Xr:Qr),this._element.classList.add(this._browserTouchPanningEnabled?Qr:Xr)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Xr),this._element.classList.remove(Qr),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(e){}}_updateNormalizedPointerLikeEvent(e,t){const i=ns(this._element,e);return Jr.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),t.x=i.x,t.y=i.y,t}_handleKey(e,t){const i=function(e){if(void 0!==e.key)return(0,l.i)(e);const t=hi[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);i&&"key-up"===e&&this._keyDownState.delete(i);const n={native:t,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===e&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,t){let i=t.deltaY;switch(t.deltaMode){case 0:(Gr||qr)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Gr||qr?i*=.7:Kr||Yr?i*=.6:Zr&&(i*=1.375);const n=Math.abs(i);if(n>100){const e=.02;i=i/n*200/(1+Math.exp(-e*(n-100)))}const s=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:i});this._callback(e,s)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const i={native:t};t.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}Jr.test={disableSubpixelCoordinates:!1};const eo={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class to extends mi{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}function io(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}const no={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class so extends mi{constructor(e=no.maximumDoubleClickDelay,t=no.maximumDoubleClickDistance,i=no.maximumDoubleTouchDelay,n=no.maximumDoubleTouchDistance,s=l.o){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))}get hasPendingInputs(){return Rn(this._pointerState,(e=>null!=e.doubleClickTimeout))}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_handleImmediateClick(e){const t=e.data,i=this._pointerId(t),n=this._pointerState.get(i);if(n){const s="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;io(n.event.data,t)>s?(this._clearDoubleClickTimeout(i,!0),this._startClick(e)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(n.event.data,void 0,n.event.modifiers))}else this._startClick(e)}_startClick(e){const t=this._pointerId(e.data),i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(t,{event:e,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(t)),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(e){const t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}_handleDrag(e){const t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}_clearDoubleClickTimeout(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}class ro extends mi{constructor(e){super(!1),this.navigationTouch=e,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(e,t,i,n){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:n,pointers:lo(this.activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}addPointer(e){const t=e.native.pointerId,i=ao(this.activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,n);const s=co(n,oo(this.activePointerMap));n.initialAngle=s,n.lastAngle=s,this.updatePointerAngles(i)}updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,i=this.activePointerMap.get(t);i?i.event=e:this.addPointer(e)}removePointer(e){const t=ao(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)}updatePointerAngles(e){const t=ao(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=co(i,t)-e,i.lastAngle=co(i,t)-e}))}emitEvent(e,t,i){const n=ao(this.activePointerMap);this.drag.emit(this.createPayload(e,t,n,i),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=(0,n.w)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,(0,n.w)(e.timestamp))))}handlePointerDrag(e){const t=e.data,i=t.currentEvent,s=(0,n.w)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this.updatePointer(i),!this.isCurrentDragSuppressed&&this.emitEvent("update",i,s)):(this.addPointer(i),this.emitEvent("added",i,s),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(i),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",i,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function oo(e){const t=[];return e.forEach((e=>{t.push((0,w.c)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,w.c)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,n]=e,[s,r]=[n.x-i.x,n.y-i.y];return t.radius=Math.sqrt(s*s+r*r)/2,t.center.x=(i.x+n.x)/2,t.center.y=(i.y+n.y)/2,t}let i=0,n=0;for(let t=0;t<e.length;t++)i+=e[t].x,n+=e[t].y;i/=e.length,n/=e.length;const s=e.map((e=>e.x-i)),r=e.map((e=>e.y-n));let o=0,a=0,l=0,d=0,c=0,h=0,u=0;for(let e=0;e<s.length;e++){const t=s[e],i=r[e],n=t*t,p=i*i;o+=n,a+=p,l+=t*i,d+=n*t,c+=p*i,h+=t*p,u+=i*n}const p=.5*(d+h),f=.5*(c+u),m=o*a-l*l,g=(p*a-f*l)/m,y=(o*f-l*p)/m,v=(0,w.c)(g+i,y+n);return{radius:Math.sqrt(g*g+y*y+(o+a)/e.length),center:v}}(t)}function ao(e){const t=oo(e);let i=0;return e.forEach((e=>{let n=co(e,t),s=n-e.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=e.lastAngle+s,e.lastAngle=n;const r=n-e.initialAngle;i+=r})),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function lo(e){const t=new Map;return e.forEach(((e,i)=>t.set(i,e.event))),t}function co(e,t){const i=e.event,n=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,n)}var ho;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(ho||(ho={}));class uo extends mi{constructor(e=no.maximumDoubleClickDelay,t=no.maximumDoubleClickDistance,i=no.maximumDoubleTouchDelay,n=no.maximumDoubleTouchDistance,s=l.o){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=this._pointerId(t);if(!this._pointerState.has(i)){const e={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(i,e),this.startCapturingPointer(t.native)}}_handlePointerLoss(e,t){const i=e.data,n=this._pointerId(i),s=this._pointerState.get(n);if(s&&"pointer-up"===t&&s.downButton===i.native.button){const t=s.immediateDoubleClick;if(t){t.timeoutHandle.remove();const n="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;io(t,e.data)>n?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,t.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),i)}}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_removeState(e){const t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}class po extends mi{constructor(e=300,t=1.5,i=6,n=6,s=500,r=l.o){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=n,this.holdDelay=s,this._clock=r,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let n=null;0===this._pointerState.size&&(n=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}_createPointerDragData(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,t),void 0,n.modifiers):function(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}(t,n.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),n.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}}startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((n=>{null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,t)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,"pointer-up"===t?i:s.previousEvent),void 0,s.modifiers):"pointer-up"===t&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}const fo={checkMajorWebPerformanceCaveat:!0};function mo(e){e={...fo,...e};const t=(0,j.r)();return t.available?e.checkMajorWebPerformanceCaveat&&t.majorPerformanceCaveat?new l.s("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?t.supportsElementIndexUint?t.supportsStandardDerivatives?t.supportsInstancedArrays?null:new l.s("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new l.s("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new l.s("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new l.s("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new l.s("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new l.s("webgl:required","WebGL is required but not supported.")}const go="esri-component";let yo=class extends n.p{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(go),t&&t.classList.remove(go),this._set("node",e))}castNode(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,I.c)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};(0,n.e)([(0,o.y)({dependsOn:[]})],yo.prototype,"id",null),(0,n.e)([(0,o.y)()],yo.prototype,"node",null),(0,n.e)([(0,x.c)("node")],yo.prototype,"castNode",null),(0,n.e)([(0,o.y)({readOnly:!0})],yo.prototype,"widget",void 0),yo=(0,n.e)([(0,o.n)("esri.views.ui.Component")],yo);var vo=yo;const _o={left:0,top:0,bottom:0,right:0},wo={bottom:30,top:15,right:15,left:15},bo="manual",Mo="esri-ui",Io="esri-ui-corner",Co="esri-ui-inner-container";function xo(e){return"object"!=typeof e||e instanceof vo||"declaredClass"in e||!("component"in e||"index"in e||"position"in e)?null:e}function ko(e,{top:t,bottom:i,left:n,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=n,e.style.right=s}let Po=class extends p.n.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new s.u,this.view=null,this._initContainers()}initialize(){this._handles.add([(0,r.d)(this,"view.padding, container",this._applyViewPadding.bind(this)),(0,r.d)(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Mo),e.classList.add((0,I.E)()),this._attachContainers(e)),t&&(t.classList.remove(Mo),ko(t,{top:"",bottom:"",left:"",right:""}),(0,I.f)(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...wo,...e}}get width(){const e=this.get("view.width")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,n;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=xo(e);s&&({index:i,position:t,component:e,key:n}=s),t&&"object"==typeof t&&({index:i,key:n,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,n)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const i=this._find(e);if(i){const n=this._componentToKey;if(n.has(e)&&n.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map((e=>this.empty(e))).reduce(((e,t)=>e.concat(t))):(e=e||bo)===bo?Array.prototype.slice.call(this._manualContainer.children).filter((e=>!e.classList.contains(Io))).map((e=>this.remove(e))):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let i;const n=xo(e)||xo(t);if(n&&(i=n.index,t=n.position,e=n.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,n){e instanceof vo||(e=new vo({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),n&&this._componentToKey.set(e,n)}_find(e){return e?e instanceof vo?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||_o}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Co),e.classList.add("esri-ui-corner-container");const t=document.createElement("div");t.classList.add(Co),t.classList.add("esri-ui-manual-container");const i=document.createElement("div");i.classList.add("esri-ui-top-left"),i.classList.add(Io),e.appendChild(i);const n=document.createElement("div");n.classList.add("esri-ui-top-right"),n.classList.add(Io),e.appendChild(n);const s=document.createElement("div");s.classList.add("esri-ui-bottom-left"),s.classList.add(Io),e.appendChild(s);const r=document.createElement("div");r.classList.add("esri-ui-bottom-right"),r.classList.add(Io),e.appendChild(r),this._innerContainer=e,this._manualContainer=t;const o=(0,I.d)();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":r,"top-leading":o?n:i,"top-trailing":o?i:n,"bottom-leading":o?r:s,"bottom-trailing":o?s:r},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||bo,n=e.index,s=this._positionNameToContainerLookup[i],r=n>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),!r)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);0!==n?n>=o.length?s.appendChild(t.node):(0,I.o)(t.node,o[n]):s.firstChild?(0,I.o)(t.node,s.firstChild):s.appendChild(t.node)}_applyViewPadding(){const e=this.container;e&&ko(e,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const e=this._innerContainer;e&&ko(e,this._toPxPosition(this.padding))}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return 0===e?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some((n=>(t=n===e,t&&(i=n),t))),i}_findById(e){let t,i=null;return this._components.some((n=>(t=n.id===e,t&&(i=n),t))),i}_findByNode(e){let t,i=null;return this._components.some((n=>(t=n.node===e,t&&(i=n),t))),i}};(0,n.e)([(0,o.y)()],Po.prototype,"container",null),(0,n.e)([(0,o.y)()],Po.prototype,"height",null),(0,n.e)([(0,o.y)({value:wo})],Po.prototype,"padding",null),(0,n.e)([(0,x.c)("padding")],Po.prototype,"castPadding",null),(0,n.e)([(0,o.y)()],Po.prototype,"view",void 0),(0,n.e)([(0,o.y)()],Po.prototype,"width",null),Po=(0,n.e)([(0,o.n)("esri.views.ui.UI")],Po);var To=Po;function Ao(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function Eo(e,t,i){i&&t&&(e.find((e=>e.layerView===t&&e.text===i))||e.push({text:i,layerView:t}))}const Fo=[];let Lo=class extends f.d{constructor(e){super(e),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new h.L,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const t=this.get("view.allLayerViews");t&&this.handles.add(t.map((e=>e.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),e&&e.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const e=this.get("view.allLayerViews");Fo.length=0,e?(e.forEach((e=>{if(e.suspended||!e.get("layer.attributionVisible"))return;const t=e.layer;if(Ao(t,"user"))return void Eo(Fo,e,t.copyright);if(t.hasAttributionData){if(this._fetchedAttributionData.has(e)){const i=this._fetchedAttributionData.get(e);return void(i?Eo(Fo,e,this._getDynamicAttribution(i,this.view,t)):Ao(t)&&Eo(Fo,e,t.copyright))}return void this._fetchAttributionData(e)}const i=t.get("portalItem.accessInformation");Eo(Fo,e,i||t.copyright)})),function(e,t){return e.length!==t.length||e.some(((e,i)=>e.text!==t[i].text))}(this.items,Fo)&&(this.items.removeAll(),this.items.addMany(Fo)),Fo.length=0,this.notifyChange("state")):this.clear()},this.handles.add([(0,r.C)(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),(0,r.w)(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await(0,G.a)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,n={};if(!i)return n;for(let e=0;e<i.length;e++){const s=i[e],r=s.coverageAreas;if(!r)return;for(const i of r){const r=i.bbox,o=i.zoomMin-(t&&i.zoomMin?1:0),a=i.zoomMax-(t&&i.zoomMax?1:0),l={xmin:r[1],ymin:r[0],xmax:r[3],ymax:r[2],spatialReference:v.k.WGS84},d={extent:(0,x.d)(l),attribution:s.attribution||"",score:null!=i.score?i.score:100,id:e};for(let e=o;e<=a;e++)n[e]=n[e]||[],n[e].push(d)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,t,i){const{extent:n,scale:s}=t;let r=i.tileInfo.scaleToZoom(s);if(r=Math.min(e.maxKey,Math.round(r)),!n||null==r||r<=-1)return"";const o=e[r],a=(0,x.g)(n.center.clone().normalize(),t.spatialReference),l={};return o?o.filter((e=>{const t=!l[e.id]&&a&&(0,g.t)(e.extent,a);return t&&(l[e.id]=!0),t})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};(0,n.e)([(0,o.y)({readOnly:!0,type:h.L})],Lo.prototype,"items",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Lo.prototype,"state",null),(0,n.e)([(0,o.y)()],Lo.prototype,"view",void 0),Lo=(0,n.e)([(0,o.n)("esri.widgets.Attribution.AttributionViewModel")],Lo);var Do=Lo;let So=class extends I.x{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Do}initialize(){this.own((0,r.C)(this,"viewModel.items","change",(()=>this.scheduleRender())))}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(-1===e.indexOf(t.text)&&e.push(t.text),e)),[]).join(this.itemDelimiter)}render(){const e={"esri-attribution--open":this._isOpen};return(0,I.n)("div",{bind:this,class:this.classes("esri-attribution esri-widget",e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return(0,I.n)("div",{class:"esri-attribution__powered-by"},"Powered by"," ",(0,I.n)("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive(),i=t?0:-1,{attributionText:n}=this,s=t?"button":void 0,r={"esri-attribution__sources--open":e,"esri-interactive":t};return(0,I.n)("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",r),innerHTML:n,role:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth}_afterSourcesNodeUpdate(e){let t=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,r=s>=n,o=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,o&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive()&&(this._isOpen=!this._isOpen)}_isInteractive(){return this._isOpen||this._attributionTextOverflowed}};(0,n.e)([(0,o.y)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],So.prototype,"attributionText",null),(0,n.e)([(0,o.y)()],So.prototype,"iconClass",void 0),(0,n.e)([(0,o.y)()],So.prototype,"itemDelimiter",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],So.prototype,"label",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Attribution/t9n/Attribution")],So.prototype,"messages",void 0),(0,n.e)([(0,m.o)("viewModel.view")],So.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Do})],So.prototype,"viewModel",void 0),(0,n.e)([ft()],So.prototype,"_toggleState",null),So=(0,n.e)([(0,o.n)("esri.widgets.Attribution")],So);var Oo=So;let Vo=class extends(Di(n.p)){constructor(e){super(e),this._handles=new s.u,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add((0,r.d)(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){null!=e&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add((0,r.d)(this,"view.rotation",this._updateForRotation)):this._handles.add((0,r.d)(this,"view.camera",this._updateForCamera)))}};(0,n.e)([(0,o.y)({readOnly:!0})],Vo.prototype,"canShowNorth",null),(0,n.e)([(0,o.y)()],Vo.prototype,"orientation",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Vo.prototype,"state",null),(0,n.e)([(0,o.y)()],Vo.prototype,"view",void 0),Vo=(0,n.e)([(0,o.n)("esri.widgets.CompassViewModel")],Vo);var Ro=Vo;let No=class extends I.x{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass="esri-icon-locate-circled",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Ro}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i="disabled"===t,n="compass"==("rotation"===t?"rotation":"compass"),s=i?-1:0,r={"esri-disabled":i,"esri-interactive":!i},o={"esri-icon-compass":n,"esri-icon-dial":!n},{messages:a}=this;return(0,I.n)("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",r),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},(0,I.n)("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",o),styles:this._toRotationTransform(e)}),(0,I.n)("span",{class:"esri-icon-font-fallback-text"},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};(0,n.e)([(0,m.o)("viewModel.goToOverride")],No.prototype,"goToOverride",void 0),(0,n.e)([(0,o.y)()],No.prototype,"iconClass",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],No.prototype,"label",void 0),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Compass/t9n/Compass")],No.prototype,"messages",void 0),(0,n.e)([(0,m.o)("viewModel.view")],No.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Ro})],No.prototype,"viewModel",void 0),(0,n.e)([ft()],No.prototype,"_reset",null),No=(0,n.e)([(0,o.n)("esri.widgets.Compass")],No);var zo=No;let Bo=class extends n.p{constructor(e){super(e),this._handles=new s.u,this.navigationMode="pan",this.view=null}initialize(){this._handles.add((0,r.y)(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};(0,n.e)([(0,o.y)({readOnly:!0})],Bo.prototype,"state",null),(0,n.e)([(0,o.y)()],Bo.prototype,"navigationMode",void 0),(0,n.e)([(0,o.y)()],Bo.prototype,"view",void 0),Bo=(0,n.e)([(0,o.n)("esri.widgets.NavigationToggleViewModel")],Bo);var Ho=Bo;const Uo="esri-navigation-toggle__button esri-widget--button",$o="esri-navigation-toggle__button--active";let Wo=class extends I.x{constructor(e,t){super(e,t),this.iconClass="esri-icon-pan2",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Ho}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e="disabled"===this.get("viewModel.state"),t="pan"===this.get("viewModel.navigationMode"),i={"esri-disabled":e,"esri-navigation-toggle--horizontal":"horizontal"===this.layout},n={[$o]:t},s={[$o]:!t},r=e?-1:0,o=this.messages.toggle;return(0,I.n)("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:r,"aria-label":o,title:o},(0,I.n)("div",{class:this.classes(Uo,"esri-navigation-toggle__button--pan",n)},(0,I.n)("span",{class:"esri-icon-pan"})),(0,I.n)("div",{class:this.classes(Uo,"esri-navigation-toggle__button--rotate",s)},(0,I.n)("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};(0,n.e)([(0,o.y)()],Wo.prototype,"iconClass",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Wo.prototype,"label",void 0),(0,n.e)([(0,o.y)({value:"vertical"})],Wo.prototype,"layout",null),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Wo.prototype,"messages",void 0),(0,n.e)([(0,m.o)("viewModel.view")],Wo.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Ho})],Wo.prototype,"viewModel",void 0),(0,n.e)([ft()],Wo.prototype,"_toggle",null),Wo=(0,n.e)([(0,o.n)("esri.widgets.NavigationToggle")],Wo);var jo=Wo;let Go=class extends I.x{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={"esri-disabled":!this.enabled,"esri-interactive":this.enabled},i={[this.iconClass]:!!this.iconClass};return(0,I.n)("div",{bind:this,class:this.classes("esri-widget--button esri-widget",t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},(0,I.n)("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",i)}),(0,I.n)("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};(0,n.e)([(0,o.y)()],Go.prototype,"action",void 0),(0,n.e)([(0,o.y)()],Go.prototype,"enabled",void 0),(0,n.e)([(0,o.y)()],Go.prototype,"iconClass",void 0),(0,n.e)([(0,o.y)()],Go.prototype,"title",void 0),(0,n.e)([ft()],Go.prototype,"_triggerAction",null),Go=(0,n.e)([(0,o.n)("esri.widgets.IconButton")],Go);var qo=Go;let Ko=class extends n.p{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}};(0,n.e)([(0,o.y)({readOnly:!0})],Ko.prototype,"canZoomIn",null),(0,n.e)([(0,o.y)({readOnly:!0})],Ko.prototype,"canZoomOut",null),(0,n.e)([(0,o.y)()],Ko.prototype,"view",void 0),Ko=(0,n.e)([(0,o.n)("esri.widgets.Zoom.ZoomConditions2D")],Ko);var Zo=Ko;let Yo=class extends n.p{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};(0,n.e)([(0,o.y)({readOnly:!0})],Yo.prototype,"canZoomIn",null),(0,n.e)([(0,o.y)({readOnly:!0})],Yo.prototype,"canZoomOut",null),(0,n.e)([(0,o.y)()],Yo.prototype,"view",void 0),Yo=(0,n.e)([(0,o.n)("esri.widgets.Zoom.ZoomConditions3D")],Yo);var Xo=Yo;let Qo=class extends n.p{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new Zo({view:e}):"3d"===e.type&&(this._zoomConditions=new Xo({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,l.y)(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,l.y)(e.goTo({zoomFactor:.5}))}};(0,n.e)([(0,o.y)()],Qo.prototype,"_zoomConditions",void 0),(0,n.e)([(0,o.y)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Qo.prototype,"canZoomIn",void 0),(0,n.e)([(0,o.y)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Qo.prototype,"canZoomOut",void 0),(0,n.e)([(0,o.y)({readOnly:!0})],Qo.prototype,"state",null),(0,n.e)([(0,o.y)()],Qo.prototype,"view",null),Qo=(0,n.e)([(0,o.n)("esri.widgets.Zoom.ZoomViewModel")],Qo);var Jo=Qo;let ea=class extends I.x{constructor(e,t){super(e,t),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Jo}initialize(){this._zoomInButton=new qo({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new qo({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={"esri-zoom--horizontal":"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,(0,I.n)("div",{class:this.classes("esri-zoom esri-widget",t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};(0,n.e)([(0,o.y)()],ea.prototype,"iconClass",void 0),(0,n.e)([(0,o.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ea.prototype,"label",void 0),(0,n.e)([(0,o.y)({value:"vertical"})],ea.prototype,"layout",null),(0,n.e)([(0,o.y)(),(0,I.e)("esri/widgets/Zoom/t9n/Zoom")],ea.prototype,"messages",void 0),(0,n.e)([(0,m.o)("viewModel.view")],ea.prototype,"view",void 0),(0,n.e)([(0,o.y)({type:Jo})],ea.prototype,"viewModel",void 0),ea=(0,n.e)([(0,o.n)("esri.widgets.Zoom")],ea);var ta=ea;const ia="esri.views.ui.DefaultUI";a.n.getLogger(ia);let na=class extends To{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([(0,r.d)(this,"components",this._componentsWatcher.bind(this)),(0,r.d)(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(e,t,i,n){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,n)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_updateViewAwareWidgets(e){this.components.forEach((t=>{const i=this._find(t),n=i&&i.widget;(function(e){return e&&void 0!==e.view})(n)&&(n.view=e)}))}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.initialized&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);if(t)return new vo({id:e,node:t})}_createWidget(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}_createAttribution(){return new Oo({view:this.view})}_createCompass(){return new zo({view:this.view})}_createNavigationToggle(){return new jo({view:this.view})}_createZoom(){return new ta({view:this.view})}};(0,n.e)([(0,o.y)()],na.prototype,"components",void 0),na=(0,n.e)([(0,o.n)(ia)],na);var sa=na}}]);