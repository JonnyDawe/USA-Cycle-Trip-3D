(self.webpackChunk=self.webpackChunk||[]).push([[809],{60809:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Y});var i=r(78155),o=r(80987),s=r(82906),n=(r(34396),r(94449)),a=r(79506),l=r(80219),p=r(88903),u=r(4169),d=r(41290),y=r(20215),c=r(32769),f=r(36845),h=r(26779),m=r(93028),g=r(79578),w=r(52737),v=r(98548),F=r(51218),b=r(21793),I=r(13895),O=r(15576),R=r(28941),S=r(19438),x=r(15022),j=r(92758),P=r(2570),q=r(47365),T=r(72257),_=r(52957),U=r(78435),k=r(18143),C=r(99987),E=r(92858);r(20736),r(31531),r(40130),r(29126),r(6585),r(3621),r(63358),r(62121),r(81135),r(94527),r(17762),r(60816),r(61888),r(29832),r(31516),r(52109),r(5250),r(49878),r(84271),r(48643),r(73574),r(89710),r(30316),r(4618),r(65352),r(80657),r(97325),r(3629),r(83731),r(16408),r(78730),r(7571),r(93242),r(58404),r(16034),r(67079),r(91236),r(9612),r(76326),r(56416),r(53902),r(40481);let N=class extends((0,c.a)(o.f)){constructor(){super(...arguments),this.capabilities=(0,m.a)(!1,!1),this.type="wfs",this._updateCustomParameters=(0,y.B)((()=>{var e;const t=this.layer.customParameters;return null==(e=this._connection)?void 0:e.invoke("setCustomParameters",t)}))}load(e){var t;const r=null!=(t=(0,l.r)(e)&&e.signal)?t:null;return this.addResolvingPromise(this._startWorker({signal:r})),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return w.default.fromJSON(r)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke("queryFeatures",e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);const r=await this._connection.invoke("queryExtent",e?e.toJSON():null,t);return{count:r.count,extent:v.M.fromJSON(r.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke("querySnapping",e,t)}async refresh(e={}){await this.load(e);const{extent:t}=await this._connection.invoke("refresh",void 0,e);return this.sourceJSON.extent=t,{extent:t}}async _createLoadOptions(e){const{url:t,customParameters:r,name:i,namespaceUri:s,spatialReference:n,fields:a,geometryType:p,swapXY:u}=this.layer;if(!t)throw new y.s("wfs-layer:missing-url","WFSLayer must be created with a url");this.wfsCapabilities=this.wfsCapabilities||await(0,g.D)(t,{customParameters:r,...e});const d=["fields","geometryType","name","namespaceUri","spatialReference","swapXY"].some((e=>null==this.layer[e]))?await(0,g.X)(this.wfsCapabilities,i,s,{spatialReference:n,customParameters:r,signal:null==e?void 0:e.signal}):{...(0,g._)(a),geometryType:p,name:i,namespaceUri:s,spatialReference:n,swapXY:u},c=(0,l.f)((0,g.W)(this.wfsCapabilities.readFeatureTypes(),d.name,d.namespaceUri)),f=o.i.toJSON(d.geometryType);return{customParameters:r,featureType:c,fields:d.fields.map((e=>e.toJSON())),geometryField:d.geometryField,geometryType:f,getFeatureUrl:this.wfsCapabilities.operations.GetFeature.url,getFeatureOutputFormat:this.wfsCapabilities.operations.GetFeature.outputFormat,objectIdField:d.objectIdField,spatialReference:d.spatialReference.toJSON(),swapXY:d.swapXY}}async _startWorker(e){const[t,r]=await(0,y.A)([this._createLoadOptions(e),(0,h.p)("WFSSourceWorker",{...e,strategy:(0,l.c)("feature-layers-workers")?"dedicated":"local"})]),i=t.error||r.error||null,o=r.value||null;if(i)throw o&&o.close(),i;const s=t.value;this._connection=r.value;const{extent:n}=await this._connection.invoke("load",s,e);this.sourceJSON={extent:n,fields:s.fields,geometryType:s.geometryType,objectIdField:s.objectIdField,geometryField:s.geometryField,drawingInfo:(0,m.u)(s.geometryType),name:s.featureType.title,wfsInfo:{name:s.featureType.name,featureUrl:s.getFeatureUrl,maxFeatures:3e3,swapXY:s.swapXY,supportedSpatialReferences:s.featureType.supportedSpatialReferences,version:"2.0.0",wfsNamespace:s.featureType.namespaceUri}},this.handles.add((0,f.d)(this.layer,"customParameters",(()=>this._updateCustomParameters().catch((()=>{})))))}};(0,i.e)([(0,p.y)()],N.prototype,"capabilities",void 0),(0,i.e)([(0,p.y)({constructOnly:!0})],N.prototype,"layer",void 0),(0,i.e)([(0,p.y)()],N.prototype,"sourceJSON",void 0),(0,i.e)([(0,p.y)()],N.prototype,"type",void 0),(0,i.e)([(0,p.y)()],N.prototype,"wfsCapabilities",void 0),N=(0,i.e)([(0,p.n)("esri.layers.graphics.sources.WFSSource")],N);var D,J=N;const W=(0,T.l)();let X=D=class extends((0,b.e)((0,F.t)((0,x.c)((0,R.o)((0,S.s)((0,I.l)((0,O.w)((0,a.l)(d.b))))))))){constructor(e){super(e),this.capabilities=null,this.copyright=null,this.customParameters=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureReduction=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="WFS",this.maxFeatures=3e3,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new J({layer:this}),this.spatialReference=E.k.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title="WFS",this.type="wfs",this.url=null,this.version=void 0}static fromWFSLayerInfo(e){const{customParameters:t,fields:r,geometryField:i,geometryType:o,name:s,namespaceUri:n,objectIdField:a,spatialReference:l,swapXY:p,url:u,wfsCapabilities:d}=e;return new D({customParameters:t,fields:r,geometryField:i,geometryType:o,name:s,namespaceUri:n,objectIdField:a,spatialReference:l,swapXY:p,url:u,wfsCapabilities:d})}destroy(){var e;null==(e=this.source)||e.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WFS"]},e).then((()=>this.source.load(e))).then((()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo","spatialReference","name","namespaceUri"],"service"),(0,_.c)(this.renderer,this.fieldsIndex),(0,_.m)(this.timeInfo,this.fieldsIndex)}))),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}readFeatureReduction(e,t){return(0,P.u)(e,t)}writeWebSceneFeatureReduction(e,t,r,i){(0,P.c)(e,t,"layerDefinition.featureReduction",i)}writeFields(e,t,r){const i=e.filter((e=>e.name!==g.v));this.geometryField&&i.unshift(new q.y({name:this.geometryField,alias:this.geometryField,type:"geometry"})),(0,l.o)(r,i.map((e=>e.toJSON())),t)}get parsedUrl(){return this.url?(0,o.U)(this.url):null}set renderer(e){(0,_.c)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,C.a)(this,e)}createQuery(){const e=new k.b;e.returnGeometry=!0,e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:t,timeExtent:r}=this;return e.timeExtent=null!=t&&null!=r?r.offset(-t.value,t.unit):r||null,e}getFieldDomain(e,t){var r;return null==(r=this.getField(e))?void 0:r.domain}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(k.b.from(e)||this.createQuery(),t))).then((e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds(k.b.from(e)||this.createQuery(),t)))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(k.b.from(e)||this.createQuery(),t)))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(k.b.from(e)||this.createQuery(),t)))}refresh(){this.source.refresh().then((e=>{this.read(e,{origin:"service"}),super.refresh()}))}};(0,i.e)([(0,p.y)({readOnly:!0,aliasOf:"source.capabilities"})],X.prototype,"capabilities",void 0),(0,i.e)([(0,p.y)({type:String})],X.prototype,"copyright",void 0),(0,i.e)([(0,p.y)({readOnly:!0})],X.prototype,"createQueryVersion",null),(0,i.e)([(0,p.y)({json:{read:{source:"wfsInfo.customParameters"},write:{target:"wfsInfo.customParameters",ignoreOrigin:!0}}})],X.prototype,"customParameters",void 0),(0,i.e)([(0,p.y)({readOnly:!0})],X.prototype,"defaultPopupTemplate",null),(0,i.e)([(0,p.y)({type:String})],X.prototype,"definitionExpression",void 0),(0,i.e)([(0,p.y)({type:String})],X.prototype,"displayField",void 0),(0,i.e)([(0,p.y)({type:I.x})],X.prototype,"elevationInfo",void 0),(0,i.e)([(0,p.y)({types:{key:"type",base:j.p,typeMap:{selection:j.c,cluster:j.b}},json:{write:{target:"layerDefinition.featureReduction"}}})],X.prototype,"featureReduction",void 0),(0,i.e)([(0,u.e)("featureReduction",["layerDefinition.featureReduction"])],X.prototype,"readFeatureReduction",null),(0,i.e)([(0,i.o)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:P.s}})],X.prototype,"writeWebSceneFeatureReduction",null),(0,i.e)([(0,p.y)({readOnly:!0,json:{read:{source:"wfsInfo.featureUrl"},write:{target:"wfsInfo.featureUrl",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"featureUrl",void 0),(0,i.e)([(0,p.y)({type:[q.y],json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields",ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"fields"}}}}})],X.prototype,"fields",void 0),(0,i.e)([(0,i.o)("fields")],X.prototype,"writeFields",null),(0,i.e)([(0,p.y)(W.fieldsIndex)],X.prototype,"fieldsIndex",void 0),(0,i.e)([(0,p.y)({type:v.M,json:{origins:{service:{read:{source:"extent"}}}}})],X.prototype,"fullExtent",void 0),(0,i.e)([(0,p.y)()],X.prototype,"geometryField",void 0),(0,i.e)([(0,p.y)({type:o.i.apiValues,json:{read:{source:"layerDefinition.geometryType",reader:o.i.read},write:{target:"layerDefinition.geometryType",writer:o.i.write,ignoreOrigin:!0},origins:{service:{read:o.i.read}}}})],X.prototype,"geometryType",void 0),(0,i.e)([(0,p.y)({type:String})],X.prototype,"id",void 0),(0,i.e)([(0,p.y)(I.a)],X.prototype,"labelsVisible",void 0),(0,i.e)([(0,p.y)({type:[U.E],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:j.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],X.prototype,"labelingInfo",void 0),(0,i.e)([(0,p.y)(I.f)],X.prototype,"legendEnabled",void 0),(0,i.e)([(0,p.y)({type:["show","hide"]})],X.prototype,"listMode",void 0),(0,i.e)([(0,p.y)({type:String})],X.prototype,"objectIdField",void 0),(0,i.e)([(0,p.y)({type:["WFS"]})],X.prototype,"operationalLayerType",void 0),(0,i.e)([(0,p.y)({json:{read:{source:"wfsInfo.maxFeatures"},write:{target:"wfsInfo.maxFeatures",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"maxFeatures",void 0),(0,i.e)([(0,p.y)({readOnly:!0,json:{read:{source:"mode"},write:{target:"mode",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"mode",void 0),(0,i.e)([(0,p.y)({json:{read:{source:"wfsInfo.name"},write:{target:"wfsInfo.name",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"name",void 0),(0,i.e)([(0,p.y)({json:{read:{source:"wfsInfo.wfsNamespace"},write:{target:"wfsInfo.wfsNamespace",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"namespaceUri",void 0),(0,i.e)([(0,p.y)(W.outFields)],X.prototype,"outFields",void 0),(0,i.e)([(0,p.y)({readOnly:!0})],X.prototype,"parsedUrl",null),(0,i.e)([(0,p.y)(I.s)],X.prototype,"popupEnabled",void 0),(0,i.e)([(0,p.y)({type:s.M,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],X.prototype,"popupTemplate",void 0),(0,i.e)([(0,p.y)({types:n.a,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer",ignoreOrigin:!0}}})],X.prototype,"renderer",null),(0,i.e)([(0,p.y)({type:Boolean})],X.prototype,"screenSizePerspectiveEnabled",void 0),(0,i.e)([(0,p.y)({readOnly:!0})],X.prototype,"source",void 0),(0,i.e)([(0,p.y)({type:E.k,json:{read:{source:"layerDefinition.spatialReference"},write:{target:"layerDefinition.spatialReference",ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],X.prototype,"spatialReference",void 0),(0,i.e)([(0,p.y)({readOnly:!0,json:{read:{source:"wfsInfo.supportedSpatialReferences"},write:{target:"wfsInfo.supportedSpatialReferences",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"spatialReferences",void 0),(0,i.e)([(0,p.y)({json:{read:{source:"wfsInfo.swapXY"},write:{target:"wfsInfo.swapXY",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"swapXY",void 0),(0,i.e)([(0,p.y)({json:{read:{source:"title"},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"name"}}}}})],X.prototype,"title",void 0),(0,i.e)([(0,p.y)({json:{read:!1},readOnly:!0})],X.prototype,"type",void 0),(0,i.e)([(0,p.y)({type:String,json:{write:!0}})],X.prototype,"url",void 0),(0,i.e)([(0,p.y)({readOnly:!0,json:{read:{source:"wfsInfo.version"},write:{target:"wfsInfo.version",ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"version",void 0),(0,i.e)([(0,p.y)({aliasOf:"source.wfsCapabilities"})],X.prototype,"wfsCapabilities",void 0),X=D=(0,i.e)([(0,p.n)("esri.layers.WFSLayer")],X);const Y=X}}]);